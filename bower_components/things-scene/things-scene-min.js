!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}Object.defineProperty(exports,"__esModule",{value:!0});var _thingsScene=require("./src/things-scene"),scene=_interopRequireWildcard(_thingsScene);exports["default"]=scene,"undefined"!=typeof window&&(window.scene=scene),"undefined"!=typeof global&&(global.scene=scene)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/things-scene":106}],2:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function makeEaseOut(delta,options){return function(progress){return 1-delta(1-progress,options)}}function makeEaseInOut(delta,options){return function(progress){return.5>progress?delta(2*progress,options)/2:(2-delta(2*(1-progress),options))/2}}function animate(opts){var _opts$duration=opts.duration,duration=void 0===_opts$duration?1e3:_opts$duration,_opts$delay=opts.delay,delay=void 0===_opts$delay?10:_opts$delay,step=opts.step,delta=opts.delta,options=opts.options,ease=opts.ease;"string"==typeof delta&&(delta=_delta2["default"][delta]),"out"==ease?delta=makeEaseOut(delta,options):"inout"==ease&&(delta=makeEaseInOut(delta,options));var started=!1;return{start:function(){if(started)return this;started=!0;var started_at=new Date,id=setInterval(function(){var time_passed=new Date-started_at,progress=time_passed/duration;progress>1&&(progress=1),step(delta(progress,options)),1!=progress&&started||clearInterval(id)},delay);return this},stop:function(){return started=!1,this}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=animate;var _delta=require("./delta"),_delta2=_interopRequireDefault(_delta)},{"./delta":5}],3:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Animation=function(){function Animation(client,model){_classCallCheck(this,Animation),this.client=client,this.model=model,this.started=!1,this.init()}return _createClass(Animation,[{key:"init",value:function(){}},{key:"start",value:function(){if(!this.started){this.started=!0;var self=this;this.interval=setInterval(function(){self.play()},this.model.interval||100)}}},{key:"stop",value:function(){clearInterval(this.interval),this.started=!1}}]),Animation}();exports["default"]=Animation},{}],4:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function compile(client,model){var clazz=registry[model.type];return clazz?new clazz(client,model):null}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=compile;var _animation=require("./animation"),_rotation=(_interopRequireDefault(_animation),require("./rotation")),_rotation2=_interopRequireDefault(_rotation),_vibration=require("./vibration"),_vibration2=_interopRequireDefault(_vibration),registry={rotation:_rotation2["default"],vibration:_vibration2["default"]}},{"./animation":3,"./rotation":7,"./vibration":8}],5:[function(require,module,exports){"use strict";function linear(progress){return progress}function quad(progress){return Math.pow(progress,2)}function circ(progress){return 1-Math.sin(Math.acos(progress))}function back(progress,options){return Math.pow(progress,2)*((options.x+1)*progress-options.x)}function bounce(progress){for(var a=0,b=1;1;a+=b,b/=2)if(progress>=(7-4*a)/11)return-Math.pow((11-6*a-11*progress)/4,2)+Math.pow(b,2)}function elastic(progress,options){return Math.pow(2,10*(progress-1))*Math.cos(20*Math.PI*options.x/3*progress)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.linear=linear,exports.quad=quad,exports.circ=circ,exports.back=back,exports.bounce=bounce,exports.elastic=elastic,exports["default"]={linear:linear,quad:quad,circ:circ,back:back,bounce:bounce,elastic:elastic}},{}],6:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _compile=require("./compile");Object.defineProperty(exports,"compile",{enumerable:!0,get:function(){return _interopRequireDefault(_compile)["default"]}})},{"./compile":4}],7:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_animation=require("./animation"),_animation2=_interopRequireDefault(_animation),Rotation=function(_Animation){function Rotation(){return _classCallCheck(this,Rotation),_possibleConstructorReturn(this,Object.getPrototypeOf(Rotation).apply(this,arguments))}return _inherits(Rotation,_Animation),_createClass(Rotation,[{key:"init",value:function(){this.state={theta:this.client.get("rotation")||0}}},{key:"play",value:function(){this.state.theta+=.1,this.client.set({rotation:this.state.theta})}}]),Rotation}(_animation2["default"]);exports["default"]=Rotation},{"./animation":3}],8:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_animation=require("./animation"),_animation2=_interopRequireDefault(_animation),Vibration=function(_Animation){function Vibration(){return _classCallCheck(this,Vibration),_possibleConstructorReturn(this,Object.getPrototypeOf(Vibration).apply(this,arguments))}return _inherits(Vibration,_Animation),_createClass(Vibration,[{key:"init",value:function(){this.state={theta:this.client.get("rotation")||0,count:0,tilt:this.model.tilt||1,clockwise:!0,offset:0,step:.1}}},{key:"play",value:function(){var offset=this.state.count*this.state.step;Math.abs(offset)>Math.abs(this.state.tilt)&&(this.state.clockwise=!this.state.clockwise),this.state.clockwise?this.state.count++:this.state.count--,this.client.set({rotation:this.state.theta+offset})}}]),Vibration}(_animation2["default"]);exports["default"]=Vibration},{"./animation":3}],9:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_command=require("./command"),_command2=_interopRequireDefault(_command),CommandBounds=function(_Command){function CommandBounds(){return _classCallCheck(this,CommandBounds),_possibleConstructorReturn(this,Object.getPrototypeOf(CommandBounds).apply(this,arguments))}return _inherits(CommandBounds,_Command),_createClass(CommandBounds,[{key:"execute",value:function(){this.params.changes.forEach(function(change){return change.component.bounds=change.after})}},{key:"unexecute",value:function(){this.params.changes.forEach(function(change){return change.component.bounds=change.before})}}]),CommandBounds}(_command2["default"]);exports["default"]=CommandBounds},{"./command":13}],10:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function diet(changes){var diet_changes=[];return changes.forEach(function(change){if(!_utils.deepEquals(change.before,change.after)){var before_keys=Object.getOwnPropertyNames(change.before),after_keys=Object.getOwnPropertyNames(change.after);before_keys.forEach(function(key){-1===after_keys.indexOf(key)?change.after[key]=void 0:change.before[key]===change.after[key]&&(delete change.before[key],delete change.after[key])}),after_keys.forEach(function(key){-1===before_keys.indexOf(key)&&(change.before[key]=void 0)}),diet_changes.push(change)}}),diet_changes}function is_mergeable_change(before,after){var keys_before_before=Object.keys(before.before),keys_before_after=Object.keys(before.after),keys_after_before=Object.keys(after.before),keys_after_after=Object.keys(after.after),length=keys_before_before.length;if(length!==keys_before_after.length||length!==keys_after_before.length||length!==keys_after_after.length)return!1;for(var i=0;length>i;i++){var key=keys_before_before[i];if(key!==keys_before_after[i]||key!==keys_after_before[i]||key!==keys_after_after[i])return!1}return!0}function _merge(before,after){var changes_before=before.params.changes,changes_after=after.params.changes;if(changes_before.length!==changes_after.length)return null;for(var changes_merged=[],i=0;i<changes_before.length;i++){var change_before=changes_before[i],change_after=changes_after[i];if(change_before.component!==change_after.component)return null;if(!is_mergeable_change(change_before,change_after))return null;changes_merged.push({component:change_after.component,before:change_before.before,after:change_after.after})}return new CommandChange({changes:changes_merged})}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_command=require("./command"),_command2=_interopRequireDefault(_command),_utils=require("../core/utils"),CommandChange=function(_Command){function CommandChange(){return _classCallCheck(this,CommandChange),_possibleConstructorReturn(this,Object.getPrototypeOf(CommandChange).apply(this,arguments))}return _inherits(CommandChange,_Command),_createClass(CommandChange,[{key:"execute",value:function(){this.params.changes.forEach(function(change){return change.component.set(change.after)})}},{key:"unexecute",value:function(){this.params.changes.reverse().forEach(function(change){return change.component.set(change.before)})}},{key:"merge",value:function(before){return _merge(before,this)}}],[{key:"before",value:function(components){return components.map(function(component){return{component:component,before:_utils.deepClone(component.model)}})}},{key:"after",value:function(changes,commander){changes.forEach(function(change){return change.after=_utils.deepClone(change.component.model)});var diet_changes=diet(changes);0!=diet_changes.length&&commander.execute(new CommandChange({changes:diet_changes}),!1)}},{key:"around",value:function(components,commander,changeFunc,self){var changes=components.map(function(component){return{component:component,before:_utils.deepClone(component.model)}});changeFunc.call(self),changes.forEach(function(change){return change.after=_utils.deepClone(change.component.model)});var diet_changes=diet(changes);0!=diet_changes.length&&commander.execute(new CommandChange({changes:diet_changes}),!1)}}]),CommandChange}(_command2["default"]);exports["default"]=CommandChange},{"../core/utils":52,"./command":13}],11:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_command=require("./command"),_command2=_interopRequireDefault(_command),_core=require("../core"),core=_interopRequireWildcard(_core),_const=require("../const"),Const=_interopRequireWildcard(_const),CommandManager=function(){function CommandManager(params){_classCallCheck(this,CommandManager),this.reset()}return _createClass(CommandManager,[{key:"dispose",value:function(){this.reset()}},{key:"execute",value:function(command,doit){if(command instanceof _command2["default"]){doit!==!1&&command.execute();var now=Date.now();if(this.timestamp&&now<this.timestamp+2e3){var last_command=this.exq.length>0?this.exq[this.exq.length-1]:null,merged=null;last_command&&last_command.constructor===command.constructor&&(merged=command.merge(last_command)),merged?this.exq[this.exq.length-1]=merged:this.exq.push(command)}else this.exq.push(command);this.uxq=[],this.timestamp=now,this.exq.length>Const.MAX_UNDO_SIZE&&this.exq.splice(0,this.exq.length-Const.MAX_UNDO_SIZE),this.trigger("execute",command,!0,!1)}}},{key:"undo",value:function(){var command=this.exq.pop();command&&(command.unexecute(),this.uxq.push(command)),this.trigger("undo",this.undoable(),this.redoable())}},{key:"redo",value:function(){var command=this.uxq.pop();command&&(command.execute(),this.exq.push(command)),this.trigger("redo",this.undoable(),this.redoable())}},{key:"undoable",value:function(){return this.exq.length>0}},{key:"redoable",value:function(){return this.uxq.length>0}},{key:"reset",value:function(){this.exq=[],this.uxq=[],this.trigger("command-reset")}}]),CommandManager}();exports["default"]=CommandManager,core.mixin(CommandManager.prototype,core.event.withEvent)},{"../const":43,"../core":46,"./command":13}],12:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function calculate_bounds_on_root(component){if("model-layer"===component.get("type"))return component.bounds;var bounds=component.bounds,rotatePoint=component.rotatePoint,pointOnTop=rotatePoint;return pointOnTop=component.transcoordS2T(pointOnTop.x,pointOnTop.y),{left:pointOnTop.x-(rotatePoint.x-bounds.left),top:pointOnTop.y-(rotatePoint.y-bounds.top),width:bounds.width,height:bounds.height}}function calculate_bounds_on_container(component,container){if("model-layer"===container.get("type"))return component.bounds;var bounds=component.bounds,rotatePoint=component.rotatePoint,absolute_container_bounds=calculate_bounds_on_root(container),container_bounds=container.bounds,relative_rotate_point={x:rotatePoint.x-absolute_container_bounds.left+container_bounds.left,y:rotatePoint.y-absolute_container_bounds.top+container_bounds.top};return relative_rotate_point=container.transcoordP2S(relative_rotate_point.x,relative_rotate_point.y),{left:relative_rotate_point.x-(rotatePoint.x-bounds.left)-container_bounds.left,top:relative_rotate_point.y-(rotatePoint.y-bounds.top)-container_bounds.top,width:bounds.width,height:bounds.height}}function calculate_rotation_on_root(component){for(var rotation=0;component&&"model-layer"!==component.get("type");)rotation+=component.get("rotation")||0,component=component.parent;return rotation%(2*Math.PI)}function calculate_rotation_on_container(component,container){var rotation=component.get("rotation")||0,container_rotation=calculate_rotation_on_root(container);return(rotation-container_rotation)%(2*Math.PI)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_command=require("./command"),_command2=_interopRequireDefault(_command),CommandMigrate=function(_Command){function CommandMigrate(){return _classCallCheck(this,CommandMigrate),_possibleConstructorReturn(this,Object.getPrototypeOf(CommandMigrate).apply(this,arguments))}return _inherits(CommandMigrate,_Command),_createClass(CommandMigrate,[{key:"execute",value:function(){var changes=this.params.changes;changes.forEach(function(change){var component=change.component,to_container=change.to_container,from_container=change.from_container,to_index=change.to_index,from_index=change.from_index;if("undefined"==typeof from_container&&(from_container=change.from_container=component.parent,from_container&&(from_index=change.from_index=from_container.indexOf(component))),from_container){var bounds=calculate_bounds_on_root(component),rotation=calculate_rotation_on_root(component);from_container.removeComponent(component),component.bounds=bounds,component.set("rotation",rotation)}to_container&&(component.bounds=calculate_bounds_on_container(component,to_container),component.set("rotation",calculate_rotation_on_container(component,to_container)),"undefined"==typeof to_index?to_container.addComponent(component):to_container.insertComponentAt(component,to_index))})}},{key:"unexecute",value:function(){var changes=this.params.changes;changes.reverse().forEach(function(change){var component=change.component,to_container=change.to_container,from_container=change.from_container,from_index=(change.to_index,change.from_index);if(to_container){var bounds=calculate_bounds_on_root(component),rotation=calculate_rotation_on_root(component);to_container.removeComponent(component),component.bounds=bounds,component.set("rotation",rotation)}from_container&&(component.bounds=calculate_bounds_on_container(component,from_container),component.set("rotation",calculate_rotation_on_container(component,from_container)),from_container.insertComponentAt(component,from_index))})}}]),CommandMigrate}(_command2["default"]);exports["default"]=CommandMigrate},{"./command":13}],13:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Command=function(){function Command(params){_classCallCheck(this,Command),this.params=Object.assign({},params)}return _createClass(Command,[{key:"excute",value:function(){}},{key:"unexecute",value:function(){}},{key:"merge",value:function(before){return null}}]),Command}();exports["default"]=Command},{}],14:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),_rect=require("./rect"),_rect2=_interopRequireDefault(_rect),Barcode=function(_Rect){function Barcode(){return _classCallCheck(this,Barcode),_possibleConstructorReturn(this,Object.getPrototypeOf(Barcode).apply(this,arguments))}return _inherits(Barcode,_Rect),_createClass(Barcode,[{key:"_draw",value:function(ctx){var _model=this.model,symbol=_model.symbol,text=_model.text,showText=_model.showText,_model$scale_h=_model.scale_h,scale_h=void 0===_model$scale_h?3:_model$scale_h,_model$scale_w=_model.scale_w,scale_w=void 0===_model$scale_w?5:_model$scale_w,_model$left=_model.left,left=void 0===_model$left?0:_model$left,_model$top=_model.top,top=void 0===_model$top?0:_model$top,_model$width=_model.width,width=void 0===_model$width?0:_model$width,_model$height=_model.height,height=void 0===_model$height?270:_model$height,_model$rot=_model.rot,rot=void 0===_model$rot?"N":_model$rot,_model$alpha=(_model.rotation,_model.alpha),alpha=void 0===_model$alpha?1:_model$alpha,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden,alttext="N"==showText?" ":text;if(("R"!=rot||"I"!=rot||"B"!=rot)&&(rot="N"),ctx.beginPath(),ctx.globalAlpha=alpha,!this.__cache__.loaded){this.img=new Image;var self=this;this.img.onload=function(){if(!width||0>=width){var h=self.img.height,w=self.img.width,realWidth=w/h*height;self.set("width",realWidth)}self.invalidate(),self.__cache__.loaded=!0},this.img.src||(this.img.src=bwip.imageUrl({symbol:symbol,text:text,alttext:alttext,scale_h:scale_h,scale_w:scale_w,rotation:rot}))}hidden||(ctx.drawImage(this.img,left,top,width,height),ctx.stroke())}},{key:"drawText",value:function(context){}},{key:"controls",get:function(){}}]),Barcode}(_rect2["default"]);exports["default"]=Barcode,_component2["default"].register("barcode",Barcode)},{"./component":16,"./rect":37}],15:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),Cloud=function(_Component){function Cloud(){return _classCallCheck(this,Cloud),_possibleConstructorReturn(this,Object.getPrototypeOf(Cloud).apply(this,arguments))}return _inherits(Cloud,_Component),_createClass(Cloud,[{key:"_pre_draw",value:function(ctx){}},{key:"_draw",value:function(ctx){var _model=this.model,_model$alpha=(_model.lineWidth,_model.alpha),alpha=void 0===_model$alpha?1:_model$alpha,_model$hidden=(_model.lineDash,_model.hidden),hidden=void 0===_model$hidden?!1:_model$hidden,x=_model.x,y=_model.y;ctx.beginPath(),ctx.moveTo(x,y),ctx.bezierCurveTo(x-40,y+20,x-40,y+70,x+50,y+70),ctx.bezierCurveTo(x+80,y+100,x+150,y+100,x+170,y+70),ctx.bezierCurveTo(x+250,y+70,x+250,y+40,x+220,y+30),ctx.bezierCurveTo(x+260,y-40,x+200,y-50,x+170,y-30),ctx.bezierCurveTo(x+150,y-75,x+80,y-60,x+80,y-30),ctx.bezierCurveTo(x+30,y-75,x-20,y-60,x,y),ctx.closePath(),ctx.globalAlpha=alpha,hidden||(this.drawFill(ctx),this.drawStroke(ctx))}},{key:"path",get:function(){return[{x:this.x,y:this.y}]},set:function(path){}}]),Cloud}(_component2["default"]);exports["default"]=Cloud,_component2["default"].register("cloud",Cloud)},{"./component":16}],16:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;
var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_selector=require("../model/selector"),selector=_interopRequireWildcard(_selector),_core=require("../core"),core=_interopRequireWildcard(_core),_animation2=require("../animation"),_animation=_interopRequireWildcard(_animation2),_effect2=require("../effect"),_effect3=_interopRequireDefault(_effect2),_utils=require("../core/utils"),utils=_interopRequireWildcard(_utils),_memoize=require("../core/memoize"),memoize=_interopRequireWildcard(_memoize),_animate2=require("../animation/animate"),_animate3=_interopRequireDefault(_animate2),_union=require("./geometry/union"),_union2=_interopRequireDefault(_union),_fill=require("./drawer/fill"),_fill2=_interopRequireDefault(_fill),_stroke=require("./drawer/stroke"),_stroke2=_interopRequireDefault(_stroke),_text=require("./drawer/text"),_text2=_interopRequireDefault(_text),_effect4=require("./drawer/effect"),_effect5=_interopRequireDefault(_effect4),_path=require("./mutater/path"),_path2=_interopRequireDefault(_path),_bounds3=require("./mutater/bounds"),_bounds4=_interopRequireDefault(_bounds3),_transcoord=require("./geometry/transcoord"),registry={},NATURE={mutable:!1,resizable:!0,rotatable:!0},Component=function(){function Component(model,context){_classCallCheck(this,Component),this._app=context,this._model=model,memoize.reset(this)}return _createClass(Component,null,[{key:"register",value:function(type,clazz){return clazz?void(registry[type]=clazz):registry[type]}}]),_createClass(Component,[{key:"added",value:function(parent){}},{key:"removed",value:function(parent){}},{key:"dispose",value:function(){}},{key:"get",value:function(property){return this._model[property]}},{key:"set",value:function(props,propval){if("string"==typeof props)return this.set(_defineProperty({},props,propval));var after={},before={},changed=!1,props=utils.deepClone(props),self=this;return Object.getOwnPropertyNames(props).forEach(function(key){var before_val=self._model[key],after_val=props[key];utils.deepEquals(before_val,after_val)||(before[key]=before_val,after[key]=after_val,self._model[key]=after_val,changed=!0)}),changed&&(this.onchange&&this.onchange(after,before),this.trigger("change",before,after),memoize.reset(this)),this}},{key:"getContext",value:function(){return this._parent.getContext()}},{key:"contains",value:function(x,y){var _bounds=this.bounds,left=_bounds.left,top=_bounds.top,width=_bounds.width,height=_bounds.height;return x<Math.max(left+width,left)&&x>Math.min(left+width,left)&&y<Math.max(top+height,top)&&y>Math.min(top+height,top)}},{key:"findFirst",value:function(finder){for(var _len=arguments.length,others=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)others[_key-1]=arguments[_key];return finder.apply(void 0,[this].concat(others))?this:void 0}},{key:"findAll",value:function(s){if("string"==typeof s)return selector.select(s,this);for(var _len2=arguments.length,others=Array(_len2>1?_len2-1:0),_key2=1;_len2>_key2;_key2++)others[_key2-1]=arguments[_key2];return"function"==typeof s&&s.apply(void 0,[this].concat(others))?[this]:void 0}},{key:"capture",value:function(x,y){if(!this.capturable)return!1;var point=this.transcoordP2S(x,y);return this.contains(point.x,point.y)?this:void 0}},{key:"draw",value:function(context){context.save(),this._pre_draw(context),this._draw(context),this._post_draw(context),context.restore()}},{key:"_pre_draw",value:function(context){var rotatePoint=this.rotatePoint,scale=this.model.scale;context.translate(rotatePoint.x,rotatePoint.y),scale&&context.scale(scale.x,scale.y),context.rotate(this.get("rotation")),context.translate(-rotatePoint.x,-rotatePoint.y)}},{key:"_draw",value:function(){}},{key:"_post_draw",value:function(context){this._model.hidden||this.drawText(context)}},{key:"animate",value:function(opts){return this._animate&&this._animate.stop(),this._animate=_animate3["default"](opts),this._animate}},{key:"rotateTo",value:function(_ref,step){var x=_ref.x,y=_ref.y,rotatePoint=this.rotatePoint,rotation=Math.atan((rotatePoint.y-y)/(rotatePoint.x-x));rotation=rotatePoint.x>=x?rotation-.5*Math.PI:.5*Math.PI+rotation,step&&(rotation=Math.floor(rotation/step)*step),this.set("rotation",rotation)}},{key:"move",value:function(_ref2){var x=_ref2.x,y=_ref2.y,oldpath=this.path,towardx=x,towardy=y;this.path=oldpath.map(function(point){return{x:point.x+towardx,y:point.y+towardy}})}},{key:"symmetryX",value:function(x){"number"!=typeof x&&(x=this.center.x);var _model=this.model,rotation=_model.rotation,fillStyle=_model.fillStyle;if(this.set("rotation",2*Math.PI-rotation),fillStyle&&"gradient"===fillStyle.type&&"linear"===fillStyle.gradientType){var newStyle=utils.clone(fillStyle);newStyle.rotation=(Math.PI-parseFloat(fillStyle.rotation||0))%(2*Math.PI),this.set("fillStyle",newStyle)}this.path=this.path.map(function(point){return{x:2*x-point.x,y:point.y}})}},{key:"symmetryY",value:function(y){this.symmetryX(),this.set("rotation",(Math.PI+this.model.rotation)%(2*Math.PI)),y&&this.move({x:0,y:2*(y-this.center.y)})}},{key:"animation",value:function(model){return _animation.compile(this,model)}},{key:"effect",value:function(context,model){return _effect3["default"](this,context,model)}},{key:"invalidate",value:function(){this.parent&&this.parent.invalidate()}},{key:"getAlignPoint",value:function(){var x,y,_model2=this._model,_model2$textAlign=_model2.textAlign,textAlign=void 0===_model2$textAlign?"center":_model2$textAlign,_bounds2=(_model2.text,this.bounds),left=_bounds2.left,top=_bounds2.top,width=_bounds2.width;_bounds2.height;switch(textAlign){case"left":case"start":case"justify":x=left;break;case"right":case"end":x=left+width;break;case"center":default:x=left+width/2}return y=top,{x:x,y:y}}},{key:"serialize",value:function(){return JSON.stringify(this._model,null,2)}},{key:"nature",get:function(){return NATURE}},{key:"app",get:function(){return this._app||(this._app=this.parent.app),this._app}},{key:"model",get:function(){return this._model}},{key:"hierarchy",get:function(){return this._model}},{key:"root",get:function(){return this._root||(this._root=this.parent.root),this._root}},{key:"parent",get:function(){return this._parent},set:function(parent){this._parent=parent}},{key:"center",get:function(){var bounds=this.bounds;return{x:bounds.left+bounds.width/2,y:bounds.top+bounds.height/2}},set:function(point){var old_center=this.center,shift_x=point.x-old_center.x,shift_y=point.y-old_center.y;this.path=this.path.map(function(p){return{x:p.x+shift_x,y:p.y+shift_y}})}},{key:"bounds",get:function(){var left,right,top,bottom,path=this.path;left=right=path[0].x,top=bottom=path[0].y;for(var i=1;i<path.length;i++){var point=path[i];point.x<left?left=point.x:point.x>right&&(right=point.x),point.y<top?top=point.y:point.y>bottom&&(bottom=point.y)}return{left:left,top:top,width:right-left,height:bottom-top}},set:function(bounds){var old_bounds=this.bounds,scale={x:bounds.width/old_bounds.width,y:bounds.height/old_bounds.height};this.path=this.path.map(function(point){return{x:bounds.left+(point.x-old_bounds.left)*scale.x,y:bounds.top+(point.y-old_bounds.top)*scale.y}})}},{key:"path",get:function(){return console.log("ERROR","이 컴포넌트에 get path 가 구현되어있지 않음.",this),[]},set:function(path){console.log("ERROR","이 컴포넌트에 get path 가 구현되어있지 않음.",this)}},{key:"anchors",get:function(){return[]}},{key:"mutable",get:function(){return NATURE.mutable}},{key:"resizable",get:function(){return NATURE.resizable}},{key:"rotatable",get:function(){return NATURE.rotatable}},{key:"capturable",get:function(){return this.get("capturable")!==!1}},{key:"centerRotatable",get:function(){return this.get("centerRotate")!==!1}},{key:"font",get:function(){var _model3=this._model,_model3$fontSize=_model3.fontSize,fontSize=void 0===_model3$fontSize?15:_model3$fontSize,_model3$fontFamily=_model3.fontFamily,fontFamily=void 0===_model3$fontFamily?"serif":_model3$fontFamily,_model3$bold=_model3.bold,bold=void 0===_model3$bold?!1:_model3$bold,_model3$italic=_model3.italic,italic=void 0===_model3$italic?!1:_model3$italic,fonts=[];return bold&&fonts.push("bold"),italic&&fonts.push("italic"),fontSize&&fonts.push(fontSize+"px"),fontFamily&&fonts.push(fontFamily),fonts.join(" ")}},{key:"rotatePoint",get:function(){return this.centerRotatable?this.center:this.path[0]}},{key:"controls",get:function(){}}]),Component}();exports["default"]=Component,Component.union=_union2["default"],Component.transcoordR=_transcoord.transcoordR,Component.transcoordRR=_transcoord.transcoordRR,Object.assign(Component.prototype,{drawText:_text2["default"],drawEffect:_effect5["default"],drawFill:_fill2["default"],drawStroke:_stroke2["default"],mutateBounds:_bounds4["default"],mutatePath:_path2["default"],transcoordS2P:_transcoord.transcoordS2P,transcoordP2S:_transcoord.transcoordP2S,transcoordS2T:_transcoord.transcoordS2T,transcoordT2S:_transcoord.transcoordT2S,transcoordS2O:_transcoord.transcoordS2O,transcoordC2S:_transcoord.transcoordC2S,transcoordS2C:_transcoord.transcoordS2C}),["rotatePoint","font"].forEach(function(getter){return memoize.intercept(Component,getter,!1)}),["bounds","center"].forEach(function(getter){return memoize.intercept(Component,getter,!0)}),core.mixin(Component.prototype,core.event.withEvent)},{"../animation":6,"../animation/animate":2,"../core":46,"../core/memoize":49,"../core/utils":52,"../effect":54,"../model/selector":86,"./drawer/effect":20,"./drawer/fill":21,"./drawer/stroke":22,"./drawer/text":23,"./geometry/transcoord":25,"./geometry/union":26,"./mutater/bounds":32,"./mutater/path":33}],17:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_component=require("./component"),_component2=_interopRequireDefault(_component),_selector=require("../model/selector"),selector=_interopRequireWildcard(_selector),_memoize=require("../core/memoize"),memoize=_interopRequireWildcard(_memoize),EMPTY=[],Container=function(_Component){function Container(model,context){_classCallCheck(this,Container);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Container).call(this,model,context));return _this._components=[],_this._links=[],_this}return _inherits(Container,_Component),_createClass(Container,[{key:"addComponent",value:function(component){var oldContainer=component.parent;if(oldContainer){if(this===oldContainer)return;oldContainer.removeComponent(component)}var index=this._components.push(component)-1;component.parent=this,component.added(this),this.trigger("add",this,component,index),component.delegate_on(this),component.trigger("added",this,component,index)}},{key:"removeComponent",value:function(component){var idx=this._components.indexOf(component);-1!=idx&&(this._components.splice(idx,1),component.parent=null,component.removed(this),this.trigger("remove",this,component),component.trigger("removed",this,component),component.delegate_off(this))}},{key:"insertComponentAt",value:function(component,index){var oldContainer=component.parent;oldContainer&&oldContainer.removeComponent(component);var head=this._components.splice(0,index);this._components=head.concat(component,this._components),index=this._components.indexOf(component),component.parent=this,component.added(this),this.trigger("add",this,component,index),component.delegate_on(this),component.trigger("added",this,component,index)}},{key:"addLink",value:function(link){var oldContainer=link.parent;if(oldContainer){if(this===oldContainer)return;oldContainer.removeComponent(link)}var index=this._links.push(link)-1;link.parent=this,this.trigger("add",this,link,index),link.delegate_on(this),link.trigger("added",this,link,index)}},{key:"removeLink",value:function(link){var idx=this._links.indexOf(link);-1!=idx&&(this._links.splice(idx,1),link.parent=null,this.trigger("remove",this,link),link.trigger("removed",this,link),link.delegate_off(this))}},{key:"add",value:function(comp){var _this2=this;return comp instanceof Array?(comp.forEach(function(c){-1==_this2._components.indexOf(c)&&_this2.addComponent(c)}),this):this.add.call(this,[comp])}},{key:"remove",value:function(_remove){function remove(_x){return _remove.apply(this,arguments)}return remove.toString=function(){return _remove.toString()},remove}(function(comp){return comp instanceof Array?this._components?(comp.forEach(function(c){removeComponent(c)}),this):this:remove(this,[comp])})},{key:"getAt",value:function(index){return this._components?this._components[index]:void 0}},{key:"forEach",value:function(fn,context){this._components&&this._components.forEach(fn,context)}},{key:"indexOf",value:function(item){return(this._components||EMPTY).indexOf(item)}},{key:"size",value:function(){return(this._components||EMPTY).length}},{key:"moveChildAt",value:function(index,child){var oldIndex=this.indexOf(child);if(-1!=oldIndex){var head=this._components.splice(0,oldIndex),tail=this._components.splice(1);this._components=head.concat(tail),index=Math.max(0,index),index=Math.min(index,this._components.length),head=this._components.splice(0,index),this._components=head.concat(child,this._components)}}},{key:"moveChildForward",value:function(child){var index=this.indexOf(child);-1!=index&&index!=this.size()-1&&(this._components[index]=this._components[index+1],this._components[index+1]=child)}},{key:"moveChildBackward",value:function(child){var index=this.indexOf(child);-1!=index&&0!=index&&(this._components[index]=this._components[index-1],this._components[index-1]=child)}},{key:"moveChildToFront",value:function(child){var index=this.indexOf(child);if(-1!=index&&index!=this.size()-1){var head=this._components.splice(0,index),tail=this._components.splice(1);this._components=head.concat(tail,this._components)}}},{key:"moveChildToBack",value:function(child){var index=this.indexOf(child);if(-1!=index&&0!=index){var head=this._components.splice(0,index),tail=this._components.splice(0);this._components=this._components.concat(head,tail)}}},{key:"symmetryX",value:function(x){_get(Object.getPrototypeOf(Container.prototype),"symmetryX",this).call(this,x),this.components.map(function(component){component.symmetryX(0)})}},{key:"findAll",value:function(s){if("string"==typeof s)return selector.select(s,this);if("function"==typeof s){for(var found=[],_len=arguments.length,others=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)others[_key-1]=arguments[_key];for(var i=this.links.length-1;i>=0;i--){var _links$i,links=(_links$i=this.links[i]).findAll.apply(_links$i,[s].concat(others));links&&(found=found.concat(links))}for(var _i=this.components.length-1;_i>=0;_i--){var _components$_i,components=(_components$_i=this.components[_i]).findAll.apply(_components$_i,[s].concat(others));components&&(found=found.concat(components))}return s.apply(void 0,[this].concat(others))&&found.push(this),found}}},{key:"findFirst",value:function(finder){for(var _len2=arguments.length,others=Array(_len2>1?_len2-1:0),_key2=1;_len2>_key2;_key2++)others[_key2-1]=arguments[_key2];for(var i=this.links.length-1;i>=0;i--){var _links$i2,found=(_links$i2=this.links[i]).findFirst.apply(_links$i2,[finder].concat(others));if(null!=found)return found}for(var _i2=this.components.length-1;_i2>=0;_i2--){var _components$_i2,found=(_components$_i2=this.components[_i2]).findFirst.apply(_components$_i2,[finder].concat(others));if(null!=found)return found}return finder.apply(void 0,[this].concat(others))?this:null}},{key:"findById",value:function(id){return this.parent.findById(id)}},{key:"capture",value:function(x,y,ignoreSelfBounds){var point=this.transcoordP2S(x,y);if(!ignoreSelfBounds&&!this.contains(point.x,point.y))return!1;var bounds=this.bounds;point.x-=bounds.left,point.y-=bounds.top;for(var i=this.links.length-1;i>=0;i--){var found=this.links[i].capture(point.x,point.y);if(found)return found}for(var _i3=this.components.length-1;_i3>=0;_i3--){var found=this.components[_i3].capture(point.x,point.y);if(found)return found}return!ignoreSelfBounds&&this.capturable&&this}},{key:"_draw",value:function(context){var _model=this.model,_model$lineWidth=_model.lineWidth,lineWidth=void 0===_model$lineWidth?0:_model$lineWidth,_model$left=_model.left,left=void 0===_model$left?0:_model$left,_model$top=_model.top,top=void 0===_model$top?0:_model$top,width=_model.width,height=_model.height,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden,_model$alpha=_model.alpha,alpha=void 0===_model$alpha?1:_model$alpha,_model$innerBorder=_model.innerBorder,innerBorder=void 0===_model$innerBorder?!1:_model$innerBorder;context.beginPath(),innerBorder&&(top+=lineWidth/2,left+=lineWidth/2,width=width-lineWidth===0?1:width-lineWidth,height=height-lineWidth===0?1:height-lineWidth),context.rect(left,top,width,height),context.globalAlpha=alpha,hidden||(this.drawFill(context),this.drawStroke(context));var _model2=this.model,top=_model2.top,left=_model2.left;_model2.scale;context.translate(left,top),this.components.forEach(function(m){m.draw(context)}),this.links.forEach(function(m){m.draw(context)}),context.translate(-left,-top)}},{key:"components",get:function(){return this._components}},{key:"links",get:function(){return this._links}},{key:"hierarchy",get:function(){return delete this.model.components,delete this.model.links,this.components&&(this.model.components=this.components.map(function(c){return c.hierarchy})),this.links&&(this.model.links=this.links.map(function(l){return l.hierarchy})),this.variables&&(this.model.variables=this.model.variables),this.model}},{key:"path",get:function(){var _model3=this.model,_model3$left=_model3.left,left=void 0===_model3$left?0:_model3$left,_model3$top=_model3.top,top=void 0===_model3$top?0:_model3$top,_model3$width=_model3.width,width=void 0===_model3$width?0:_model3$width,_model3$height=_model3.height,height=void 0===_model3$height?0:_model3$height;return[{x:left,y:top},{x:left+width,y:top},{x:left+width,y:top+height},{x:left,y:top+height}]},set:function(path){var left_top=path[0],right_bottom=path[2],_model4=this.model;_model4.width,_model4.height;this.set({left:left_top.x,top:left_top.y,width:right_bottom.x-left_top.x,height:right_bottom.y-left_top.y})}}]),Container}(_component2["default"]);exports["default"]=Container,memoize.intercept(Container,"bounds",!1)},{"../core/memoize":49,"../model/selector":86,"./component":16}],18:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),Cube=function(_Component){function Cube(model){_classCallCheck(this,Cube);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Cube).call(this,model));return _this.vectors=[],_this.vectors.push(new Vector(model.fallLength,model.left,model.top,-model.length/2,-model.length/2,model.length/2)),_this.vectors.push(new Vector(model.fallLength,model.left,model.top,-model.length/2,model.length/2,model.length/2)),_this.vectors.push(new Vector(model.fallLength,model.left,model.top,model.length/2,-model.length/2,model.length/2)),_this.vectors.push(new Vector(model.fallLength,model.left,model.top,model.length/2,model.length/2,model.length/2)),_this.vectors.push(new Vector(model.fallLength,model.left,model.top,model.length/2,-model.length/2,-model.length/2)),_this.vectors.push(new Vector(model.fallLength,model.left,model.top,model.length/2,model.length/2,-model.length/2)),_this.vectors.push(new Vector(model.fallLength,model.left,model.top,-model.length/2,-model.length/2,-model.length/2)),_this.vectors.push(new Vector(model.fallLength,model.left,model.top,-model.length/2,model.length/2,-model.length/2)),_this}return _inherits(Cube,_Component),_createClass(Cube,[{key:"_draw",value:function(ctx){var _model=this.model,_model$angleX=(_model.length,_model.angleX),angleX=void 0===_model$angleX?.2:_model$angleX,_model$angleY=_model.angleY,angleY=void 0===_model$angleY?.3:_model$angleY,faces=(_model.color,_model.hidden,[]);faces[0]=new Face(ctx,this.vectors[0],this.vectors[1],this.vectors[3],this.vectors[2],"#6c6"),faces[1]=new Face(ctx,this.vectors[2],this.vectors[3],this.vectors[5],this.vectors[4],"#6cc"),faces[2]=new Face(ctx,this.vectors[4],this.vectors[5],this.vectors[7],this.vectors[6],"#cc6"),faces[3]=new Face(ctx,this.vectors[6],this.vectors[7],this.vectors[1],this.vectors[0],"#c6c"),faces[4]=new Face(ctx,this.vectors[1],this.vectors[3],this.vectors[5],this.vectors[7],"#666"),faces[5]=new Face(ctx,this.vectors[0],this.vectors[2],this.vectors[4],this.vectors[6],"#ccc"),faces.sort(function(a,b){return b.zIndex-a.zIndex}),faces.forEach(function(face){return face.draw()}),this.rotateX(angleX),this.rotateY(angleY)}},{key:"rotateX",value:function(angleX){var cos=Math.cos(angleX),sin=Math.sin(angleX);this.vectors.forEach(function(obj){var y1=obj.y*cos-obj.z*sin,z1=obj.z*cos+obj.y*sin;obj.y=y1,obj.z=z1})}},{key:"rotateY",value:function(angleY){var cos=Math.cos(angleY),sin=Math.sin(angleY);this.vectors.forEach(function(obj){var x1=obj.x*cos-obj.z*sin,z1=obj.z*cos+obj.x*sin;obj.x=x1,obj.z=z1})}},{key:"path",get:function(){var _model2=this.model,left=_model2.left,top=_model2.top,length=_model2.length;return[{x:left,y:top},{x:left+length,y:top+length}]},set:function(path){var left_top=path[0],right_bottom=path[1];this.set({left:left_top.x,top:left_top.y,length:right_bottom.x-left_top.x})}}]),Cube}(_component2["default"]);exports["default"]=Cube;var Vector=function(fallLength,left,top,x,y,z){this.x=x,this.y=y,this.z=z;var fallLength=fallLength,centerX=left,centerY=top;this._get2d=function(){var scale=fallLength/(fallLength+this.z),x=centerX+this.x*scale,y=centerY+this.y*scale;return{x:x,y:y}}},Face=function(ctx,vector1,vector2,vector3,vector4,color){this.v1=vector1,this.v2=vector2,this.v3=vector3,this.v4=vector4,this.color=color,this.zIndex=this.v1.z+this.v2.z+this.v3.z+this.v4.z,this.draw=function(){ctx.beginPath(),ctx.moveTo(this.v1._get2d().x,this.v1._get2d().y),ctx.lineTo(this.v2._get2d().x,this.v2._get2d().y),ctx.lineTo(this.v3._get2d().x,this.v3._get2d().y),ctx.lineTo(this.v4._get2d().x,this.v4._get2d().y),ctx.lineTo(this.v1._get2d().x,this.v1._get2d().y),ctx.stroke(),ctx.closePath(),ctx.fillStyle=this.color,hidden||this.drawFill(ctx)}};_component2["default"].register("cube",Cube)},{"./component":16}],19:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),_ellipse=require("./ellipse"),_ellipse2=_interopRequireDefault(_ellipse),controlHandler={ondragmove:function(point,index,component){var _component$model=(component.controls,component.model),cx=_component$model.cx,rx=_component$model.rx,transcoorded=component.transcoordP2S(point.x,point.y),ratio=(transcoorded.x-cx)/rx*100;ratio=ratio>=100||-100>=ratio?100:Math.abs(ratio),component.set({ratio:ratio})}},Donut=function(_Ellipse){function Donut(){return _classCallCheck(this,Donut),_possibleConstructorReturn(this,Object.getPrototypeOf(Donut).apply(this,arguments))}return _inherits(Donut,_Ellipse),_createClass(Donut,[{key:"_draw",value:function(ctx){var _model=this.model,_model$ratio=_model.ratio,ratio=void 0===_model$ratio?50:_model$ratio,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden,cx=_model.cx,cy=_model.cy,rx=_model.rx,ry=_model.ry,startAngle=(_model.rotation,_model.startAngle),endAngle=_model.endAngle,anticlockwise=_model.anticlockwise;ctx.beginPath(),ctx.ellipse(cx,cy,Math.abs(rx),Math.abs(ry),0,startAngle||0,endAngle||2*Math.PI,anticlockwise),ctx.moveTo(cx+rx/100*ratio,cy),ctx.ellipse(cx,cy,Math.abs(rx/100*ratio),Math.abs(ry/100*ratio),0,startAngle||0,endAngle||2*Math.PI,!0),hidden||(this.drawFill(ctx),this.drawStroke(ctx))}},{key:"contains",value:function(x,y){var _model2=this.model,cx=_model2.cx,cy=_model2.cy,rx=_model2.rx,ry=_model2.ry,ratio=_model2.ratio,normx=(x-cx)/(2*rx-.5),normy=(y-cy)/(2*ry-.5),ratiox=(x-cx)/(rx/100*ratio*2-.5),ratioy=(y-cy)/(ry/100*ratio*2-.5),result=!1;return.25>normx*normx+normy*normy&&ratiox*ratiox+ratioy*ratioy>.25&&(result=!result),result}},{key:"controls",get:function(){var _model3=this.model,cx=_model3.cx,cy=_model3.cy,rx=_model3.rx,ratio=_model3.ratio;return[{x:cx+rx/100*ratio,y:cy,handler:controlHandler}]}}]),Donut}(_ellipse2["default"]);exports["default"]=Donut,_component2["default"].register("donut",Donut)},{"./component":16,"./ellipse":24}],20:[function(require,module,exports){"use strict";function effect(context){var _this=this;this._model.effects&&this._model.effects.forEach(function(effect){_this.effect(context,effect)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=effect},{}],21:[function(require,module,exports){"use strict";function fill(context){var _this=this,_model=this.model,fillStyle=_model.fillStyle,alpha=_model.alpha;if(context.globalAlpha=alpha,fillStyle)if("string"==typeof fillStyle)context.fillStyle=fillStyle,context.fill();else if("object"==("undefined"==typeof fillStyle?"undefined":_typeof(fillStyle)))if("gradient"==fillStyle.type)!function(){context.translate(_this.center.x,_this.center.y);var grd=void 0,_bounds=_this.bounds,width=_bounds.width,height=_bounds.height;if("linear"==fillStyle.gradientType){var degree180=3.141592653589793,fRotation=fillStyle.rotation;if(fRotation>=.436332&&1.13446>=fRotation||fRotation>=2.00713&&2.70526>=fRotation||fRotation>=3.57792&&4.27606>=fRotation||fRotation>=5.14872&&5.84685>=fRotation){var diagonal=Math.sqrt(Math.pow((width-4)/2,2)+Math.pow((height-4)/2,2));diagonal-=diagonal-(width+height)/3,grd=context.createLinearGradient(diagonal*Math.cos(fRotation+degree180),diagonal*Math.sin(fRotation+degree180),diagonal*Math.cos(fRotation),diagonal*Math.sin(fRotation))}else grd=context.createLinearGradient((width-4)/2*Math.cos(fRotation+degree180),(height-4)/2*Math.sin(fRotation+degree180),(width-4)/2*Math.cos(fRotation),(height-4)/2*Math.sin(fRotation))}else if("radial"==fillStyle.gradientType){var length=.95*Math.sqrt(Math.pow((width-4)/2,2)+Math.pow((height-4)/2,2));switch(fillStyle.center){case"center":grd=context.createRadialGradient(0,0,0,0,0,length);break;case"left-top":grd=context.createRadialGradient(-width/2,-height/2,0,-width/2,-height/2,2*length);break;case"right-top":grd=context.createRadialGradient(width/2,-height/2,0,width/2,-height/2,2*length);break;case"left-bottom":grd=context.createRadialGradient(-width/2,height/2,0,-width/2,height/2,2*length);
break;case"right-bottom":grd=context.createRadialGradient(width/2,height/2,0,width/2,height/2,2*length);break;default:grd=context.createRadialGradient(0,0,0,0,0,length)}}fillStyle.colorStops.forEach(function(v){grd.addColorStop(v.position,v.color)}),context.fillStyle=grd,context.fill(),context.translate(-_this.center.x,-_this.center.y)}();else if("pattern"==fillStyle.type&&fillStyle.image){var bounds=this.bounds,offsetX=fillStyle.offsetX||0,offsetY=fillStyle.offsetY||0,alignX=0,alignY=0;switch(fillStyle.align){case"center":alignX=bounds.width/2-(fillStyle.width?fillStyle.width/2:0),alignY=bounds.height/2+(fillStyle.height?fillStyle.height/2:0);break;case"left-top":break;case"left-bottom":alignY=fillStyle.height?bounds.height%fillStyle.height:bounds.height;break;case"right-top":alignX=fillStyle.width?bounds.width%fillStyle.width:bounds.width;break;case"right-bottom":alignX=fillStyle.width?bounds.width%fillStyle.width:bounds.width,alignY=fillStyle.height?bounds.height%fillStyle.height:bounds.height;break;case"left":alignY=bounds.height/2+(fillStyle.height?fillStyle.height/2:0);break;case"right":alignX=fillStyle.width?bounds.width%fillStyle.width:bounds.width,alignY=bounds.height/2+(fillStyle.height?fillStyle.height/2:0);break;case"top":alignX=bounds.width/2-(fillStyle.width?fillStyle.width/2:0);break;case"bottom":alignX=bounds.width/2-(fillStyle.width?fillStyle.width/2:0),alignY=fillStyle.height?bounds.height%fillStyle.height:bounds.height}var translateX=bounds.left+offsetX+alignX,translateY=bounds.top+offsetY+alignY;context.translate(translateX,translateY),(!this._pattern_image||this._cache_pattern_image!==fillStyle.image||this._cache_pattern_width!==fillStyle.width||this._cache_pattern_height!==fillStyle.height||fillStyle.fitPattern&&(this._cache_bound_height!==bounds.height||this._cache_bound_width!==bounds.width)||this._cache_fitPattern!==fillStyle.fitPattern)&&!function(){_this._cache_pattern_image=fillStyle.image,_this._cache_pattern_width=fillStyle.width,_this._cache_pattern_height=fillStyle.height,_this._cache_bound_height=bounds.height,_this._cache_bound_width=bounds.width,_this._cache_fitPattern=fillStyle.fitPattern,_this._pattern_image_origin=new Image,_this._pattern_image_origin.src=fillStyle.image;var self=_this;_this._pattern_image_origin.onload=function(){if(!fillStyle.width&&!fillStyle.height&&!fillStyle.fitPattern)return self._pattern_image=self._pattern_image_origin,void self.invalidate();var offscreen_canvas=document.createElement("canvas"),temp_context=offscreen_canvas.getContext("2d"),width=fillStyle.width||this.width,height=fillStyle.height||this.height;fillStyle.fitPattern&&(width=self.model.width,height=self.model.height),offscreen_canvas.width=width,offscreen_canvas.height=height,temp_context.drawImage(this,0,0,this.width,this.height,0,0,width,height),self._pattern_image=offscreen_canvas,self.invalidate()}}(),this._pattern_image&&(context.fillStyle=context.createPattern(this._pattern_image,"repeat"),context.fill()),context.translate(-translateX,-translateY)}}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};exports["default"]=fill},{}],22:[function(require,module,exports){"use strict";function stroke(context){var _model=this.model,strokeStyle=_model.strokeStyle,lineDash=_model.lineDash,lineWidth=_model.lineWidth,lineCap=_model.lineCap;if(strokeStyle&&0!=lineWidth){if(lineCap&&(context.lineCap=lineCap),lineDash){var isRound="round"==lineCap?!0:!1;switch(lineDash){case"solid":lineDash=[1,0];break;case"round-dot":lineDash=isRound?[0,2*lineWidth]:[lineWidth,lineWidth];break;case"square-dot":lineDash=isRound?[lineWidth,2*lineWidth]:[2*lineWidth,lineWidth];break;case"dash":lineDash=isRound?[3*lineWidth,2.5*lineWidth]:[4*lineWidth,1.5*lineWidth];break;case"dash-dot":lineDash=isRound?[3*lineWidth,3*lineWidth,0,3*lineWidth]:[4*lineWidth,2*lineWidth,lineWidth,2*lineWidth];break;case"long-dash":lineDash=isRound?[5*lineWidth,4*lineWidth]:[6*lineWidth,3*lineWidth];break;case"long-dash-dot":lineDash=isRound?[5*lineWidth,3*lineWidth,0,3*lineWidth]:[6*lineWidth,2*lineWidth,lineWidth,2*lineWidth];break;case"long-dash-dot-dot":lineDash=isRound?[5*lineWidth,2*lineWidth,0,2*lineWidth,0,2*lineWidth]:[6*lineWidth,lineWidth,lineWidth,lineWidth,lineWidth,lineWidth]}context.setLineDash(lineDash)}context.strokeStyle=strokeStyle,context.lineWidth=lineWidth,context.stroke()}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=stroke},{}],23:[function(require,module,exports){"use strict";function text(context){function calcUnitSpec(){this.__cache__.widthDictionary||(this.__cache__.widthDictionary=charSizeDictionary(context,customText));var widthDictionary=this.__cache__.widthDictionary;switch(this.widthDictionary=widthDictionary,charWidth=calcCharWidth(widthDictionary,customText)||height,textType){case"F":case"f":charWidth||(this.model.charWidth=charWidth*(scaleX||1));break;case"W":case"w":(!charWidth||fontSize>0)&&(this.model.charWidth=charWidth*(scaleX||1));break;default:this.model.charWidth=charWidth*(scaleX||1)}}var _this=this,_model=this.model,type=_model.type,top=(_model.left,_model.top),width=_model.width,height=_model.height,charWidth=_model.charWidth,charHeight=_model.charHeight,_model$fontColor=(_model.rotation,_model.fontColor),fontColor=void 0===_model$fontColor?"black":_model$fontColor,_model$textAlign=_model.textAlign,textAlign=void 0===_model$textAlign?"center":_model$textAlign,fontSize=(_model.textBaseline,_model.fontSize),_model$text=_model.text,text=void 0===_model$text?"":_model$text,_model$alpha=_model.alpha,alpha=void 0===_model$alpha?1:_model$alpha,textType=_model.textType,_model$lineMargin=(_model.maxLines,_model.lineMargin),lineMargin=void 0===_model$lineMargin?0:_model$lineMargin,underLine=(_model.bold,_model.italic,_model.underLine),strike=_model.strike,_model$textCase=_model.textCase,textCase=void 0===_model$textCase?"":_model$textCase,_model$paddingLeft=_model.paddingLeft,paddingLeft=void 0===_model$paddingLeft?0:_model$paddingLeft,_model$paddingRight=_model.paddingRight,paddingRight=void 0===_model$paddingRight?0:_model$paddingRight,_model$paddingTop=_model.paddingTop,paddingTop=void 0===_model$paddingTop?0:_model$paddingTop,_model$paddingBottom=_model.paddingBottom,paddingBottom=void 0===_model$paddingBottom?0:_model$paddingBottom;"text"!==type&&(height||(height=this.bounds.height),width||(width=this.bounds.width));var matches=text.match(/#{(\S*)}/gi);matches&&matches.forEach(function(variable){var property=variable.substr(2,variable.length-3);text=text.replace(variable,_this.model[property])}),context.fillStyle=fontColor,context.globalAlpha=alpha,context.textAlign="justify"===textAlign?"left":textAlign,context.textBaseline="middle",width=width-paddingLeft-paddingRight;var scale,scaleX,scaleY,customText=getCasedText(text,textCase),point=this.getAlignPoint();switch(textType){case"F":case"f":if(width>0||height>0){if(height=height-paddingTop-paddingBottom,!(customText&&customText.length>0))return;context.font=getFontScale(this,context,width,height,customText)}else charHeight=charHeight||height,charWidth=charWidth||height,context.font=getFontScale(this,context,charWidth,charHeight);scale=this.__cache__.scale||{},scaleX=scale.x||1,scaleY=scale.y||1,context.save(),context.font="15px serif",calcUnitSpec.call(this),context.restore(),(!height||0>=height)&&this.set("height",context.measureText("M").width*scaleY),(!width||0>=width)&&this.set("width",context.measureText(customText).width*scaleX),context.scale(scaleX,scaleY);var offsetX=point.x/scaleX,offsetY=(point.y+height/2+paddingTop)/scaleY;offsetX+=shiftX(this,scaleX),context.fillText(customText,offsetX,offsetY),underLine&&(offsetY+=charHeight/2,textLine(context,offsetX,offsetY,width/scaleX)),strike&&(offsetY+=charHeight,textLine(context,offsetX,offsetY,width/scaleX)),charHeight||(this.model.charHeight=context.measureText("M").width*(scaleY||1));break;case"W":case"w":var texts,rowQty,_ret=function(){fontSize&&!_this.__cache__.scale?(context.font=_this.font,calcUnitSpec.call(_this)):(context.font=getFontScale(_this,context,charWidth,charHeight),scale=_this.__cache__.scale||{},scaleX=scale.x||1,scaleY=scale.y||1,context.scale(scaleX,scaleY),context.save(),context.font="15px serif",calcUnitSpec.call(_this,scaleX),context.restore()),texts=[],rowQty=calcWrapText(_this,context,customText,texts),height||_this.set("height",(_this.model.charHeight+lineMargin)*rowQty),(!charHeight||fontSize>0)&&(_this.model.charHeight=context.measureText("M").width*(scaleY||1));var ty=shiftY(_this,rowQty);return texts.forEach(function(obj){var text=obj.text,x=obj.x,y=obj.y;context.fillText(text,x/(scaleX||1),(y+ty)/(scaleY||1))}),"break"}();if("break"===_ret)break;default:context.font=this.font,this.model.charHeight=context.measureText("M").width*(scaleY||1);var _ty=shiftY(this),_offsetX=point.x,_offsetY=point.y+_ty;switch(textAlign){case"left":_offsetX+=paddingLeft;break;case"right":_offsetX-=paddingRight;break;case"center":_offsetX+=(paddingLeft-paddingRight)/2;break;case"justify":_offsetX+=paddingLeft}if("justify"===textAlign){var texts=[];makeJustifyLine(context,texts,customText,width,_offsetX,_offsetY),texts.forEach(function(obj){var text=obj.text,x=obj.x,y=obj.y;context.fillText(text,x,y)})}else context.fillText(customText,_offsetX,_offsetY);var textWidth=context.measureText(customText).width;if(underLine){var _offsetY2=top+_ty+charHeight/2;textLine(context,point.x,_offsetY2,textWidth)}if(strike){var _offsetY3=top+_ty;textLine(context,point.x,_offsetY3,textWidth)}calcUnitSpec.call(this)}}function calcWrapText(component,context,text,texts){var lines=text.trim().split("\n"),words=[];if(lines.length>1){var tmp=[];lines.forEach(function(line,i){tmp.push(line),i===lines.length-1||tmp.push("\n")}),tmp.forEach(function(line,i){var wordArr=line.split(" ");wordArr.forEach(function(w,idx){words.push(w)})})}else words=text.split(" ");var lineSeq=makeTexts(component,context,words,texts);return lineSeq}function makeTexts(component,context,words,texts){function pushText(text){0!==text.length&&(texts.push({text:text.trim(),x:offsetX,y:offsetY}),(maxLines>lineSeq||!maxLines)&&(offsetY+=lineHeight,lineSeq++))}var _component$model=component.model,width=_component$model.width,maxLines=(_component$model.left,_component$model.top,_component$model.fontSize,_component$model.charHeight,_component$model.maxLines),_component$model$line=_component$model.lineMargin,lineMargin=void 0===_component$model$line?0:_component$model$line,_component$model$text=_component$model.textAlign,textAlign=void 0===_component$model$text?"center":_component$model$text,_component$model$padd=(_component$model.textBaseline,_component$model.paddingLeft),paddingLeft=void 0===_component$model$padd?0:_component$model$padd,_component$model$padd2=_component$model.paddingRight,paddingRight=void 0===_component$model$padd2?0:_component$model$padd2;_component$model.paddingTop,_component$model.paddingBottom;width=width?width:component.bounds.width,width=width-paddingLeft-paddingRight;var offset=component.getAlignPoint(context),offsetX=offset.x,offsetY=offset.y+lineMargin/2,scale=component.__cache__.scale||{},scaleX=scale.x||1,scaleY=scale.y||1;offsetX+=shiftX(component,scaleX);var line="",lineHeight=context.measureText("M").width*scaleY+lineMargin/scaleY,lineSeq=0;return words.forEach(function(word,i){if("\n"===word)return pushText(line),void(line="");if(context.measureText(word).width>=width/scaleX){line.length>0&&pushText(line);for(var beforeIdx=0,tmp="",_i=0;_i<word.length;_i++)tmp=word.substring(beforeIdx,_i+1),context.measureText(tmp).width>width/scaleX&&(pushText(word.substring(beforeIdx,_i)),beforeIdx=_i);return context.measureText(tmp).width>width/scaleX&&(pushText(word.substring(beforeIdx,word.length-1)),beforeIdx=word.length-1,tmp=word.substring(beforeIdx)),void(line=tmp)}var tmpLine=i===words.length-1?line+word:line+word+" ",tmpWidth=context.measureText(tmpLine).width;if(tmpWidth>width/scaleX){if("justify"===textAlign){if(0===line.length)return;makeJustifyLine(context,texts,line,width,offsetX,offsetY,scaleX),(maxLines>lineSeq||!maxLines)&&(offsetY+=lineHeight,lineSeq++)}else pushText(line);line=word+" "}else line=tmpLine}),line.length>0&&pushText(line),lineSeq}function makeJustifyLine(context,texts,line,width,offsetX,offsetY){var scaleX=arguments.length<=6||void 0===arguments[6]?1:arguments[6],words=line.split(" "),wordCount=words.length,string=line.replace(/\s+/g,""),realWidth=context.measureText(string).width,spaceWidth=width-realWidth*scaleX,specWidth=0;if(wordCount>1)specWidth=spaceWidth/(wordCount-1);else{var chars=[],word=words[0];if(word.length>1){for(var i=0;i<word.length;i++)chars.push(word[i]);return void makeJustifyLine(context,texts,chars.join(" "),width,offsetX,offsetY)}}var ww=offsetX/scaleX;words.forEach(function(w,idx){texts.push({text:w,x:ww*scaleX+specWidth*idx,y:offsetY}),ww+=context.measureText(w).width})}function getFontScale(component,context,width,height){var text=arguments.length<=4||void 0===arguments[4]?"M":arguments[4];if(component.__cache__.font)return component.__cache__.font;var _component$model2=component.model,bold=_component$model2.bold,italic=_component$model2.italic,_component$model2$fon=_component$model2.fontFamily,fontFamily=void 0===_component$model2$fon?"serif":_component$model2$fon,fonts=[],hfontSize=calcFontSize(context,fontFamily,height),wfontSize=calcFontSize(context,fontFamily,width,text);if(wfontSize>0&&hfontSize>0){if(fonts=[],bold&&fonts.push("bold"),italic&&fonts.push("italic"),wfontSize>hfontSize){fonts.push(wfontSize+"px"),fontFamily&&fonts.push(fontFamily),context.font=fonts.join(" ");var h=context.measureText("M").width,sy=height/h}else{fonts.push(hfontSize+"px"),fontFamily&&fonts.push(fontFamily),context.font=fonts.join(" ");var w=context.measureText(text).width,sx=width/w}component.__cache__.scale={x:sx,y:sy}}return component.__cache__.font=fonts.join(" "),component.__cache__.font}function calcFontSize(context,fontFamily,spec){var text=arguments.length<=3||void 0===arguments[3]?"M":arguments[3];if(spec){for(var fontSize=0,size=0;spec>size;){var fonts=[];fontSize++,fonts.push(fontSize+"px"),fonts.push(fontFamily),context.font=fonts.join(" "),size=context.measureText(text).width}return fontSize}}function getCasedText(text,textCase){var tranText;switch(textCase.toUpperCase()){case"U":tranText=text.toUpperCase();break;case"L":tranText=text.toLowerCase();break;default:tranText=text}return tranText}function textLine(context,offsetX,offsetY,width){context.moveTo(offsetX,offsetY),context.lineTo(offsetX+width,offsetY),context.stroke()}function shiftX(component){var scaleX=arguments.length<=1||void 0===arguments[1]?1:arguments[1],_component$model3=component.model,_component$model3$tex=_component$model3.textAlign,textAlign=void 0===_component$model3$tex?"center":_component$model3$tex,_component$model3$pad=_component$model3.paddingLeft,paddingLeft=void 0===_component$model3$pad?0:_component$model3$pad,_component$model3$pad2=_component$model3.paddingRight,paddingRight=void 0===_component$model3$pad2?0:_component$model3$pad2,tx=0;switch(textAlign){case"left":case"justify":tx+=paddingLeft/scaleX;break;case"right":tx-=paddingRight/scaleX;break;case"center":tx+=(paddingLeft-paddingRight)/scaleX/2}return tx}function shiftY(component){var lineSeq=arguments.length<=1||void 0===arguments[1]?1:arguments[1],_component$model4=component.model,type=_component$model4.type,height=(_component$model4.top,_component$model4.height),charHeight=_component$model4.charHeight,_component$model4$tex=_component$model4.textBaseline,textBaseline=void 0===_component$model4$tex?"middle":_component$model4$tex,_component$model4$lin=_component$model4.lineMargin,lineMargin=void 0===_component$model4$lin?0:_component$model4$lin,_component$model4$pad=_component$model4.paddingTop,paddingTop=void 0===_component$model4$pad?0:_component$model4$pad,_component$model4$pad2=_component$model4.paddingBottom,paddingBottom=void 0===_component$model4$pad2?0:_component$model4$pad2;"text"===type||height||(height=component.bounds.height);var textsHeight=(charHeight+lineMargin)*lineSeq,ty=0;switch(textBaseline){case"top":case"hanging":ty=paddingTop+charHeight/2;break;case"bottom":case"alphabetic":ty=height-textsHeight+charHeight/2-paddingBottom;break;case"middle":var height=height-paddingTop-paddingBottom;ty=1===lineSeq?height/2:(height-textsHeight)/2+charHeight/2+paddingTop}return ty}function charSizeDictionary(context,text){var letters=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],symbol=[",",":","&"],map=new Map;if(letters.forEach(function(c){map.set(c,context.measureText(c).width);var upper=c.toUpperCase();map.set(upper,context.measureText(upper).width)}),symbol.forEach(function(s){map.set(s,context.measureText(s).width)}),!text)return map;for(var i=0;i<text.length;i++){var char=text[i];map.get(char)||map.set(char,context.measureText(char).width)}return map}function calcCharWidth(map,text){for(var sum=0,i=0;i<text.length;i++){var char=text[i],_width=map.get(char)||0;sum+=_width}return text||text.length>0?sum/text.length:void 0}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=text},{}],24:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),Ellipse=function(_Component){function Ellipse(){return _classCallCheck(this,Ellipse),_possibleConstructorReturn(this,Object.getPrototypeOf(Ellipse).apply(this,arguments))}return _inherits(Ellipse,_Component),_createClass(Ellipse,[{key:"_draw",value:function(context){var _model=this.model,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden,cx=_model.cx,cy=_model.cy,rx=_model.rx,ry=_model.ry,startAngle=(_model.rotation,_model.startAngle),endAngle=_model.endAngle,anticlockwise=_model.anticlockwise;context.beginPath(),context.ellipse(cx,cy,Math.abs(rx),Math.abs(ry),0,startAngle||0,endAngle||2*Math.PI,anticlockwise),hidden||(this.drawFill(context),this.drawStroke(context))}},{key:"contains",value:function(x,y){var _model2=this.model,cx=_model2.cx,cy=_model2.cy,rx=_model2.rx,ry=_model2.ry,normx=(x-cx)/(2*rx-.5),normy=(y-cy)/(2*ry-.5);return.25>normx*normx+normy*normy}},{key:"path",get:function(){var _model3=this.model,cx=_model3.cx,cy=_model3.cy,rx=_model3.rx,ry=_model3.ry;return[{x:cx-rx,y:cy-ry},{x:cx+rx,y:cy-ry},{x:cx+rx,y:cy+ry},{x:cx-rx,y:cy+ry}]},set:function(path){var left_top=path[0],right_bottom=path[2];this.set({cx:left_top.x+(right_bottom.x-left_top.x)/2,cy:left_top.y+(right_bottom.y-left_top.y)/2,rx:(right_bottom.x-left_top.x)/2,ry:(right_bottom.y-left_top.y)/2})}}]),Ellipse}(_component2["default"]);exports["default"]=Ellipse,_component2["default"].register("ellipse",Ellipse)},{"./component":16}],25:[function(require,module,exports){"use strict";function transcoordR(x,y){var rotatePoint=arguments.length<=2||void 0===arguments[2]?{x:0,y:0}:arguments[2],rotation=arguments.length<=3||void 0===arguments[3]?0:arguments[3],scale=arguments.length<=4||void 0===arguments[4]?{x:1,y:1}:arguments[4];return x-=rotatePoint.x,y-=rotatePoint.y,{x:(x*Math.cos(-rotation)-y*Math.sin(-rotation)+rotatePoint.x)/scale.x,y:(x*Math.sin(-rotation)+y*Math.cos(-rotation)+rotatePoint.y)/scale.y}}function transcoordRR(x,y){var rotatePoint=arguments.length<=2||void 0===arguments[2]?{x:0,y:0}:arguments[2],rotation=arguments.length<=3||void 0===arguments[3]?0:arguments[3],scale=arguments.length<=4||void 0===arguments[4]?{x:1,y:1}:arguments[4];return x-=rotatePoint.x,y-=rotatePoint.y,{x:(x*Math.cos(rotation)-y*Math.sin(rotation)+rotatePoint.x)*scale.x,y:(x*Math.sin(rotation)+y*Math.cos(rotation)+rotatePoint.y)*scale.y}}function transcoordP2S(x,y,rotatePoint){if(!this.parent)return{x:x,y:y};var _model=this.model,_model$rotation=_model.rotation,rotation=void 0===_model$rotation?0:_model$rotation,_model$scale=_model.scale,scale=void 0===_model$scale?{x:1,y:1}:_model$scale;if(this.canvas){x*=this.app.DPPX,y*=this.app.DPPX;var translate=this.model.translate,_point=transcoordR(x,y,translate,rotation,scale);return translate&&(_point.x-=translate.x/(scale?scale.x:1),_point.y-=translate.y/(scale?scale.y:1)),_point}rotatePoint=rotatePoint||this.rotatePoint;var point=transcoordR(x,y,rotatePoint,rotation,scale);return{x:point.x+(rotatePoint.x-rotatePoint.x/scale.x),y:point.y+(rotatePoint.y-rotatePoint.y/scale.y)}}function transcoordS2P(x,y,rotatePoint){if(!this.parent)return{x:x,y:y};var _model2=this.model,_model2$rotation=_model2.rotation,rotation=void 0===_model2$rotation?0:_model2$rotation,_model2$scale=_model2.scale,scale=void 0===_model2$scale?{x:1,y:1}:_model2$scale;if(this.canvas){var translate=this.model.translate,_point2=transcoordRR(x,y,{x:0,y:0},rotation,scale);return translate&&(_point2.x+=translate.x,_point2.y+=translate.y),_point2.x/=this.app.DPPX,_point2.y/=this.app.DPPX,_point2}rotatePoint=rotatePoint||this.rotatePoint;var point=transcoordRR(x,y,rotatePoint,rotation,scale);return{x:point.x-(rotatePoint.x-rotatePoint.x/scale.x),y:point.y-(rotatePoint.y-rotatePoint.y/scale.y)}}function transcoordS2T(x,y,top){for(var _this=this,top=top||this.root.model_layer,ancestors=[],parent=this.parent;parent&&parent!==top;parent=parent.parent)ancestors.push(parent);var point=this.transcoordS2P(x,y);return ancestors.forEach(function(parent){var scale=parent.model.scale,bounds=_this.parent.bounds;if(scale){var rotatePoint=parent.rotatePoint;point.x+=(rotatePoint.x-bounds.left)*scale.x,point.y+=(rotatePoint.y-bounds.top)*scale.y}else point.x+=bounds.left,point.y+=bounds.top;point=parent.transcoordS2P(point.x,point.y)}),point}function transcoordT2S(x,y,top){for(var top=top||this.root.model_layer,ancestors=[],parent=this.parent;parent&&parent!==top;parent=parent.parent)ancestors.splice(0,0,parent);var point={x:x,y:y};ancestors.forEach(function(parent){var scale=parent.model.scale;point=parent.transcoordP2S(point.x,point.y);var bounds=parent.bounds;if(scale){var rotatePoint=parent.rotatePoint;point.x-=(rotatePoint.x-bounds.left)/scale.x,point.y-=(rotatePoint.y-bounds.top)/scale.y}else point.x-=bounds.left,point.y-=bounds.top});var _model3=this.model,_model3$scale=(_model3.rotation,_model3.scale);return this.transcoordP2S(point.x,point.y)}function transcoordS2O(x,y,to){var top=this.root.model_layer,point=this.transcoordS2T(x,y,top);return to.transcoordT2S(point.x,point.y,top)}function transcoordC2S(x,y,top){if(!top)for(top=this;top&&!top.canvas;)top=top.parent;x*=this.app.DPPX,y*=this.app.DPPX;var _top$model=top.model,translate=_top$model.translate,scale=_top$model.scale,rotation=_top$model.rotation,point=transcoordR(x,y,translate,rotation,scale);return translate&&(point.x-=translate.x/(scale?scale.x:1),point.y-=translate.y/(scale?scale.y:1)),top===this?point:this.transcoordT2S(point.x,point.y,top)}function transcoordS2C(x,y,top){if(!top)for(top=this;top&&!top.canvas;)top=top.parent;if(top!==this)var point=this.transcoordS2T(x,y,top);else var point={x:x,y:y};var _top$model2=top.model,translate=_top$model2.translate,rotation=_top$model2.rotation,scale=_top$model2.scale;return point=transcoordRR(point.x,point.y,{x:0,y:0},rotation,scale),translate&&(point.x+=translate.x,point.y+=translate.y),point.x/=this.app.DPPX,point.y/=this.app.DPPX,point}Object.defineProperty(exports,"__esModule",{value:!0}),exports.transcoordR=transcoordR,exports.transcoordRR=transcoordRR,exports.transcoordP2S=transcoordP2S,exports.transcoordS2P=transcoordS2P,exports.transcoordS2T=transcoordS2T,exports.transcoordT2S=transcoordT2S,exports.transcoordS2O=transcoordS2O,exports.transcoordC2S=transcoordC2S,exports.transcoordS2C=transcoordS2C},{}],26:[function(require,module,exports){"use strict";function union(boundsList){var left,top,right,bottom;return boundsList.forEach(function(bounds){void 0===left?(left=bounds.left,top=bounds.top,right=bounds.left+bounds.width,bottom=bounds.top+bounds.height):(left=Math.min(bounds.left,left),top=Math.min(bounds.top,top),right=Math.max(bounds.left+bounds.width,right),bottom=Math.max(bounds.top+bounds.height,bottom))}),{left:left,top:top,width:right-left,height:bottom-top}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=union},{}],27:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_container=require("../components/container"),_container2=_interopRequireDefault(_container),_component=require("./component"),_component2=_interopRequireDefault(_component),Group=function(_Container){function Group(){return _classCallCheck(this,Group),_possibleConstructorReturn(this,Object.getPrototypeOf(Group).apply(this,arguments))}return _inherits(Group,_Container),_createClass(Group,[{key:"capture",value:function(x,y){if(!this.parent.canvas){var _captured=_get(Object.getPrototypeOf(Group.prototype),"capture",this).call(this,x,y,!0);return _captured&&_captured!==this&&_captured}for(var i=0;i<this.root.selected.length;i++){for(var item=this.root.selected[i];item!==this&&(item instanceof Group||item.parent instanceof Group);)item=item.parent;if(item===this){var _captured2=_get(Object.getPrototypeOf(Group.prototype),"capture",this).call(this,x,y,!0);return _captured2&&_captured2!==this&&_captured2}}var captured=_get(Object.getPrototypeOf(Group.prototype),"capture",this).call(this,x,y,!0);return captured&&captured!==this&&this}},{key:"calculateBounds",value:function(){var union=_component2["default"].union(this.components.map(function(component){return component.bounds}));if(void 0!==union.left){var bounds=this.bounds;(0!==union.left||0!==union.right||union.width!==bounds.width||union.height!==bounds.height)&&(this.components.forEach(function(component){var cbounds=component.bounds;component.bounds={left:cbounds.left-union.left,top:cbounds.top-union.top,width:cbounds.width,height:cbounds.height}}),this._model.left=bounds.left+union.left,this._model.top=bounds.top+union.top,this._model.width=union.width,this._model.height=union.height,delete this.__cache__.path,delete this.__cache__.bounds,this.parent instanceof Group&&this.parent.calculateBounds())}}},{key:"bounds",set:function(bounds){var old_bounds=this.bounds,scale={x:bounds.width/old_bounds.width,y:bounds.height/old_bounds.height};this.path=this.path.map(function(point){return{x:bounds.left+(point.x-old_bounds.left)*scale.x,y:bounds.top+(point.y-old_bounds.top)*scale.y}}),this.components&&this.components.forEach(function(comp){if(comp.mutable)comp.mutatePath(null,function(path_in_parent){return path_in_parent.map(function(point){return{x:point.x*scale.x,y:point.y*scale.y}})});else{var _bounds=comp.bounds,center=comp.center,delta_center={x:center.x*(1-scale.x),y:center.y*(1-scale.y)},delta_width=_bounds.width*(1-scale.x),delta_height=_bounds.height*(1-scale.y),delta_left=-(delta_center.x-delta_width/2),delta_top=-(delta_center.y-delta_height/2);comp.bounds={left:_bounds.left+delta_left,top:_bounds.top+delta_top,width:_bounds.width*scale.x,height:_bounds.height*scale.y}}})},get:function(){return _get(Object.getPrototypeOf(Group.prototype),"bounds",this)}}]),Group}(_container2["default"]);exports["default"]=Group,_component2["default"].register("group",Group)},{"../components/container":17,"./component":16}],28:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function getColorData(ctx,width,height){try{var img=ctx.getImageData(0,0,width,height)}catch(e){return console.log("Get Image Data Error: "+e.message),null}for(var data=img.data,i=0;width*height*4>i;i+=4){var red=data[i],green=data[i+1],blue=data[i+2],gray=parseInt((red+green+blue)/3);img.data[i]=gray,img.data[i+1]=gray,img.data[i+2]=gray}return img}function getOffscreenCanvas(width,height){var canvas=document.createElement("canvas");return canvas.width=width,canvas.height=height,
canvas}function getGrfData(imageInfo){for(var data=imageInfo.data,width=imageInfo.width,height=imageInfo.height,imgData=[],y=0;height>y;y++)for(var x=0;width>x;x++){var pixelStart=4*(width*y+x),luminance=.299*data[pixelStart]+.587*data[pixelStart+1]+.114*data[pixelStart+2];luminance>127?(imgData[pixelStart]=255,imgData[pixelStart+1]=255,imgData[pixelStart+2]=255,imgData[pixelStart+3]=255):(imgData[pixelStart]=0,imgData[pixelStart+1]=0,imgData[pixelStart+2]=0,imgData[pixelStart+3]=255)}return imgData}function getImageGrf(data,width,height){for(var GRFVal=function(nibble){var nibbleMap={0:"0000",1:"0001",2:"0010",3:"0011",4:"0100",5:"0101",6:"0110",7:"0111",8:"1000",9:"1001",A:"1010",B:"1011",C:"1100",D:"1101",E:"1110",F:"1111"};for(var key in nibbleMap)if(nibbleMap[key]==nibble)return key;return""},grfData="",bytesPerLine=Math.ceil(width/8),y=0;height>y;y++){for(var nibble="",bytes=0,x=0;width>x;x++){var point=4*(width*y+x);nibble+=0===data[point+1]?"1":"0",nibble.length>7&&(grfData+=GRFVal(nibble.substring(0,4))+GRFVal(nibble.substring(4,8)),nibble="",bytes++)}if(nibble.length>0){for(;nibble.length<8;)nibble+="0";grfData+=GRFVal(nibble.substring(0,4))+GRFVal(nibble.substring(4,8)),nibble="",bytes++}for(;bytesPerLine>bytes;)grfData+=GRFVal("0000")+GRFVal("0000"),bytes++;grfData+="\n"}return bytesPerLine*height+","+bytesPerLine+","+grfData}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),_rect=require("./rect"),_rect2=_interopRequireDefault(_rect),ImageView=function(_Rect){function ImageView(model){return _classCallCheck(this,ImageView),_possibleConstructorReturn(this,Object.getPrototypeOf(ImageView).call(this,model))}return _inherits(ImageView,_Rect),_createClass(ImageView,[{key:"_draw",value:function(ctx){var _model=this.model,left=_model.left,top=_model.top,width=_model.width,height=_model.height,_model$isGray=_model.isGray,isGray=void 0===_model$isGray?!1:_model$isGray,_model$isGrf=_model.isGrf,isGrf=void 0===_model$isGrf?!1:_model$isGrf,_model$alpha=_model.alpha,alpha=void 0===_model$alpha?1:_model$alpha,src=_model.src,imageGrf=_model.imageGrf;ctx.beginPath(),ctx.globalAlpha=alpha,this.img=this.img||new Image;var me=this;this.img.onload=function(){isGray&&delete me.__cache__.grayImg,me._loaded=!0,me.invalidate()},this._src!=src&&(this._loaded=!1,this._src=src,this.img.src=src,imageGrf=null);try{this.img.crossOrigin="Anonymous"}catch(e){console.log(e.message)}if(isGray){var imageCanvas=getOffscreenCanvas(width,height),imgCtx=imageCanvas.getContext("2d");if(imgCtx.drawImage(this.img,0,0,width,height),this._loaded&&(this.__cache__.grayImg=this.__cache__.grayImg||getColorData(imgCtx,width,height),this.__cache__.grayImg)){var grayCanvas=getOffscreenCanvas(width,height),grayCtx=grayCanvas.getContext("2d");grayCtx.putImageData(this.__cache__.grayImg,0,0),ctx.drawImage(grayCanvas,left,top,width,height)}}else ctx.drawImage(this.img,left,top,width,height);if(ctx.stroke(),isGrf&&this._loaded&&!imageGrf){try{var imageInfo=ctx.getImageData(left+30,top+30,width,height)}catch(e){return console.log("Get Image Data Error: "+e.message),null}if(imageInfo){var data=getGrfData(imageInfo);imageGrf=getImageGrf(data,width,height),this.set("imageGrf",imageGrf)}}}},{key:"controls",get:function(){}}]),ImageView}(_rect2["default"]);exports["default"]=ImageView,_component2["default"].register("image-view",ImageView)},{"./component":16,"./rect":37}],29:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _component=require("./component");Object.defineProperty(exports,"Component",{enumerable:!0,get:function(){return _interopRequireDefault(_component)["default"]}});var _container=require("./container");Object.defineProperty(exports,"Container",{enumerable:!0,get:function(){return _interopRequireDefault(_container)["default"]}});var _rootContainer=require("./root-container");Object.defineProperty(exports,"RootContainer",{enumerable:!0,get:function(){return _interopRequireDefault(_rootContainer)["default"]}});var _line=require("./line");Object.defineProperty(exports,"Line",{enumerable:!0,get:function(){return _interopRequireDefault(_line)["default"]}});var _ellipse=require("./ellipse");Object.defineProperty(exports,"Ellipse",{enumerable:!0,get:function(){return _interopRequireDefault(_ellipse)["default"]}});var _rect=require("./rect");Object.defineProperty(exports,"Rect",{enumerable:!0,get:function(){return _interopRequireDefault(_rect)["default"]}});var _polygon=require("./polygon");Object.defineProperty(exports,"Polygon",{enumerable:!0,get:function(){return _interopRequireDefault(_polygon)["default"]}});var _polyline=require("./polyline");Object.defineProperty(exports,"Polyline",{enumerable:!0,get:function(){return _interopRequireDefault(_polyline)["default"]}});var _ruler=require("./ruler");Object.defineProperty(exports,"Ruler",{enumerable:!0,get:function(){return _interopRequireDefault(_ruler)["default"]}});var _imageView=require("./image-view");Object.defineProperty(exports,"ImageView",{enumerable:!0,get:function(){return _interopRequireDefault(_imageView)["default"]}});var _text=require("./text");Object.defineProperty(exports,"Text",{enumerable:!0,get:function(){return _interopRequireDefault(_text)["default"]}});var _group=require("./group");Object.defineProperty(exports,"Group",{enumerable:!0,get:function(){return _interopRequireDefault(_group)["default"]}});var _path=require("./path");Object.defineProperty(exports,"Path",{enumerable:!0,get:function(){return _interopRequireDefault(_path)["default"]}});var _barcode=require("./barcode");Object.defineProperty(exports,"Barcode",{enumerable:!0,get:function(){return _interopRequireDefault(_barcode)["default"]}});var _triangle=require("./triangle");Object.defineProperty(exports,"Triangle",{enumerable:!0,get:function(){return _interopRequireDefault(_triangle)["default"]}});var _cloud=require("./cloud");Object.defineProperty(exports,"Cloud",{enumerable:!0,get:function(){return _interopRequireDefault(_cloud)["default"]}});var _donut=require("./donut");Object.defineProperty(exports,"Donut",{enumerable:!0,get:function(){return _interopRequireDefault(_donut)["default"]}});var _star=require("./star");Object.defineProperty(exports,"Star",{enumerable:!0,get:function(){return _interopRequireDefault(_star)["default"]}});var _movieClip=require("./movie-clip");Object.defineProperty(exports,"MovieClip",{enumerable:!0,get:function(){return _interopRequireDefault(_movieClip)["default"]}});var _cube=require("./cube");Object.defineProperty(exports,"Cube",{enumerable:!0,get:function(){return _interopRequireDefault(_cube)["default"]}})},{"./barcode":14,"./cloud":15,"./component":16,"./container":17,"./cube":18,"./donut":19,"./ellipse":24,"./group":27,"./image-view":28,"./line":30,"./movie-clip":31,"./path":34,"./polygon":35,"./polyline":36,"./rect":37,"./root-container":38,"./ruler":39,"./star":40,"./text":41,"./triangle":42}],30:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),EPSILON=5,LINEWIDTH=2,WING_FACTOR=Math.sqrt(3),Line=function(_Component){function Line(){return _classCallCheck(this,Line),_possibleConstructorReturn(this,Object.getPrototypeOf(Line).apply(this,arguments))}return _inherits(Line,_Component),_createClass(Line,[{key:"_drawEndPoint",value:function(ctx,x1,y1,x2,y2,lineWidth,beginType,endType,beginSize,endSize){var theta=Math.atan2(y2-y1,x2-x1);beginType&&this._drawArrow(ctx,beginType,x1,y1,theta,lineWidth,beginSize),endType&&this._drawArrow(ctx,endType,x2,y2,theta+Math.PI,lineWidth,endSize)}},{key:"_drawArrow",value:function(ctx,type,x,y,theta,lineWidth,size){switch(ctx.beginPath(),ctx.translate(x,y),ctx.rotate(theta),type){case"oval":ctx.ellipse(0,0,size.X,size.Y,0,0,2*Math.PI),ctx.fill(),context.scale(1,1/arc_scale_y);break;case"diamond":ctx.moveTo(-size.X,0),ctx.lineTo(0,-size.Y),ctx.lineTo(size.X,0),ctx.lineTo(0,size.Y),ctx.fill();break;case"arrow":ctx.moveTo(0,0),ctx.lineTo(WING_FACTOR*size.X,-size.Y),ctx.lineTo(WING_FACTOR*size.X,size.Y),ctx.fill();break;case"sharp-arrow":ctx.moveTo(0,0),ctx.lineTo(WING_FACTOR*size.X,-size.Y),ctx.lineTo(-size.X/1.5+WING_FACTOR*size.X,0),ctx.lineTo(WING_FACTOR*size.X,size.Y),ctx.fill();break;case"open-arrow":ctx.moveTo(WING_FACTOR*size.X+lineWidth,-size.Y),ctx.lineTo(lineWidth,0),ctx.lineTo(WING_FACTOR*size.X+lineWidth,size.Y),ctx.stroke()}ctx.rotate(-theta),ctx.translate(-x,-y),ctx.closePath()}},{key:"_draw",value:function(ctx){var _model=this.model,_model$lineWidth=_model.lineWidth,lineWidth=void 0===_model$lineWidth?LINEWIDTH:_model$lineWidth,x1=_model.x1,y1=_model.y1,x2=_model.x2,y2=_model.y2,_model$strokeStyle=_model.strokeStyle,strokeStyle=void 0===_model$strokeStyle?"#000000":_model$strokeStyle,_model$alpha=_model.alpha,alpha=void 0===_model$alpha?1:_model$alpha,_model$lineCap=_model.lineCap,lineCap=void 0===_model$lineCap?!1:_model$lineCap,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden,_model$begin=_model.begin,begin=void 0===_model$begin?"none":_model$begin,_model$end=_model.end,end=void 0===_model$end?"none":_model$end,_model$beginSize=_model.beginSize,beginSize=void 0===_model$beginSize?1:_model$beginSize,_model$endSize=_model.endSize,endSize=void 0===_model$endSize?1:_model$endSize;"none"==begin&&"none"==end||hidden||(beginSize=this.sizes(beginSize),endSize=this.sizes(endSize),lineWidth=parseInt(lineWidth),ctx.lineCap=lineCap,ctx.lineWidth=lineWidth,ctx.strokeStyle=strokeStyle,ctx.fillStyle=strokeStyle,this._drawEndPoint(ctx,x1,y1,x2,y2,lineWidth,begin,end,beginSize,endSize)),ctx.beginPath();var theta=Math.atan2(y2-y1,x2-x1),diff=1.5*lineWidth;begin.endsWith("arrow")&&(x1+=Math.cos(theta)*diff,y1+=Math.sin(theta)*diff),end.endsWith("arrow")&&(x2-=Math.cos(theta)*diff,y2-=Math.sin(theta)*diff),ctx.globalAlpha=alpha,ctx.moveTo(x1,y1),ctx.lineTo(x2,y2),hidden||(this.drawStroke(ctx),ctx.lineCap=lineCap),ctx.closePath()}},{key:"sizes",value:function(size){var length={},lineWidth=1.2*this.model.lineWidth;switch(size){case"size1":length.X=lineWidth,length.Y=lineWidth;break;case"size2":length.X=1.5*lineWidth,length.Y=lineWidth;break;case"size3":length.X=2*lineWidth,length.Y=lineWidth;break;case"size4":length.X=lineWidth,length.Y=1.5*lineWidth;break;case"size5":length.X=1.5*lineWidth,length.Y=1.5*lineWidth;break;case"size6":length.X=2*lineWidth,length.Y=1.5*lineWidth;break;case"size7":length.X=lineWidth,length.Y=2*lineWidth;break;case"size8":length.X=1.5*lineWidth,length.Y=2*lineWidth;break;case"size9":length.X=2*lineWidth,length.Y=2*lineWidth;break;default:length.X=1.5*lineWidth,length.Y=1.5*lineWidth}return length}},{key:"contains",value:function(x,y){var _model2=this.model,x1=_model2.x1,y1=_model2.y1,x2=_model2.x2,y2=_model2.y2,_model2$lineWidth=_model2.lineWidth,lineWidth=void 0===_model2$lineWidth?LINEWIDTH:_model2$lineWidth,epsilon=EPSILON+lineWidth;if(Math.abs(x1-x2)>epsilon&&Math.abs(y1-y2)>epsilon){var m=(y2-y1)/(x2-x1),b=y1-m*x1;if(Math.abs(y-(m*x+b))>epsilon)return!1}var minx,maxx,miny,maxy;return x1>x2?(maxx=x1,minx=x2):(maxx=x2,minx=x1),y1>y2?(maxy=y1,miny=y2):(maxy=y2,miny=y1),x>maxx+EPSILON?!1:minx-EPSILON>x?!1:y>maxy+EPSILON?!1:miny-EPSILON>y?!1:!0}},{key:"resizable",get:function(){return!1}},{key:"mutable",get:function(){return!0}},{key:"rotatable",get:function(){return!1}},{key:"path",get:function(){var _model3=this.model,x1=_model3.x1,y1=_model3.y1,x2=_model3.x2,y2=_model3.y2;return[{x:x1,y:y1},{x:x2,y:y2}]},set:function(path){var from=path[0],to=path[1];this.set({x1:from.x,y1:from.y,x2:to.x,y2:to.y})}}]),Line}(_component2["default"]);exports["default"]=Line,_component2["default"].register("line",Line)},{"./component":16}],31:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),_rect=require("./rect"),_rect2=_interopRequireDefault(_rect),MovieClip=function(_Rect){function MovieClip(model){_classCallCheck(this,MovieClip);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(MovieClip).call(this,model));return _this.video=document.createElement("video"),_this.video.style.visibility="hidden",_this.video.src=model.src,_this.video.autoplay="autoplay",_this.video.controls="controls",_this.info={src:model.src,fps:1e3/30},_this}return _inherits(MovieClip,_Rect),_createClass(MovieClip,[{key:"_draw",value:function(ctx){var me=this,_model=this.model,top=_model.top,left=_model.left,width=(_model.position,_model.width),height=_model.height;this.targetElement=this.root.target_element,this.targetElement.appendChild(this.video),this.video.addEventListener("play",function(){var $this=this;!function loop(){$this.paused||$this.ended||(ctx.drawImage($this,left,top,width,height),setTimeout(loop,me.info.fps))}()},0)}},{key:"play",value:function(){this.video.play()}},{key:"pause",value:function(){this.video.pause()}},{key:"controls",get:function(){}}]),MovieClip}(_rect2["default"]);exports["default"]=MovieClip,_component2["default"].register("movie-clip",MovieClip)},{"./component":16,"./rect":37}],32:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function mutateBounds(logic,context){var bounds=this.bounds,rotatePoint=this.rotatePoint,rotation=this.get("rotation"),scale=this.get("scale");if(logic){var new_bounds=logic.call(context,bounds);new_bounds&&(bounds=new_bounds)}var _bounds=bounds,left=_bounds.left,top=_bounds.top,width=_bounds.width,height=_bounds.height,coords=[{x:left,y:top},{x:left+width,y:top+height}];coords=coords.map(function(point){return _component2["default"].transcoordRR(point.x,point.y,rotatePoint,rotation,scale)});var left_top=coords[0],right_bottom=coords[1];rotatePoint=this.centerRotatable?{x:(left_top.x+right_bottom.x)/2,y:(left_top.y+right_bottom.y)/2}:this.model.rotatePoint||{x:left_top.x,y:left_top.y},coords=coords.map(function(point){return _component2["default"].transcoordR(point.x,point.y,rotatePoint,rotation,scale)}),left_top=coords[0],right_bottom=coords[1],this.bounds={left:left_top.x,top:left_top.y,width:right_bottom.x-left_top.x,height:right_bottom.y-left_top.y}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=mutateBounds;var _component=require("../component"),_component2=_interopRequireDefault(_component)},{"../component":16}],33:[function(require,module,exports){"use strict";function mutatePath(beforeLogic,afterLogic,context){var _this=this,path=this.path,rotatePoint=this.rotatePoint;this.get("rotation"),this.get("scale");beforeLogic&&(path=beforeLogic.call(context,path));var path_in_parent=path.map(function(point){return _this.transcoordS2P(point.x,point.y)});if(afterLogic){var path=afterLogic.call(context,path_in_parent);path&&(path_in_parent=path)}var left,right,top,bottom,vcenter={x:0,y:0},path=path_in_parent.map(function(point){return _this.transcoordP2S(point.x,point.y,vcenter)});left=right=path[0].x,top=bottom=path[0].y;for(var i=1;i<path.length;i++){var point=path[i];point.x<left?left=point.x:point.x>right&&(right=point.x),point.y<top?top=point.y:point.y>bottom&&(bottom=point.y)}rotatePoint=this.centerRotatable?this.model.rotatePoint||{x:(left+right)/2,y:(top+bottom)/2}:this.model.rotatePoint||{x:left,y:top},rotatePoint=this.transcoordS2P(rotatePoint.x,rotatePoint.y,vcenter),this.path=path_in_parent.map(function(point){return _this.transcoordP2S(point.x,point.y,rotatePoint)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=mutatePath},{}],34:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),Path=function(_Component){function Path(){return _classCallCheck(this,Path),_possibleConstructorReturn(this,Object.getPrototypeOf(Path).apply(this,arguments))}return _inherits(Path,_Component),_createClass(Path,[{key:"_draw",value:function(ctx){var _model=this.model,_model$alpha=_model.alpha,alpha=void 0===_model$alpha?1:_model$alpha,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden,_model$path=_model.path,path=void 0===_model$path?[]:_model$path;_model.rotation;if(!(path.length<=1)){ctx.beginPath(),ctx.globalAlpha=alpha,ctx.moveTo(path[0].x,path[0].y);for(var i=1;i<path.length;i++)ctx.lineTo(path[i].x,path[i].y);ctx.closePath(),hidden||this.drawStroke(ctx)}}},{key:"contains",value:function(x,y){var path=this.model.path,result=!1;return path.forEach(function(p,idx){var j=(idx+path.length+1)%path.length,x1=p.x,y1=p.y,x2=path[j].x,y2=path[j].y;y1>y!=y2>y&&(x2-x1)*(y-y1)/(y2-y1)+x1>x&&(result=!result)}),result}},{key:"path",get:function(){return this.model.path},set:function(path){this.set("path",path)}}]),Path}(_component2["default"]);exports["default"]=Path,_component2["default"].register("path",Path)},{"./component":16}],35:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),controlHandler={ondragstart:function(point,index,component){component.mutatePath(null,function(path){path.splice(index+1,0,point)})},ondragmove:function(point,index,component){component.mutatePath(null,function(path){path[index+1]=point})},ondragend:function(point,index,component){}},Polygon=function(_Component){function Polygon(){return _classCallCheck(this,Polygon),_possibleConstructorReturn(this,Object.getPrototypeOf(Polygon).apply(this,arguments))}return _inherits(Polygon,_Component),_createClass(Polygon,[{key:"_draw",value:function(ctx){var _model=this.model,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden,_model$path=_model.path,path=void 0===_model$path?[]:_model$path;_model.rotation;if(!(path.length<=1)){ctx.beginPath(),ctx.moveTo(path[0].x,path[0].y);for(var i=1;i<path.length;i++)ctx.lineTo(path[i].x,path[i].y);ctx.closePath(),hidden||(this.drawFill(ctx),this.drawStroke(ctx))}}},{key:"contains",value:function(x,y){var path=this.model.path,result=!1;return path.forEach(function(p,idx){var j=(idx+path.length+1)%path.length,x1=p.x,y1=p.y,x2=path[j].x,y2=path[j].y;y1>y!=y2>y&&(x2-x1)*(y-y1)/(y2-y1)+x1>x&&(result=!result)}),result}},{key:"mutable",get:function(){return!0}},{key:"path",get:function(){return this.model.path},set:function(path){this.set("path",path)}},{key:"controls",get:function(){var path=this.path;return path.map(function(p1,i){var p2=path[i+1>=path.length?0:i+1];return{x:(p1.x+p2.x)/2,y:(p1.y+p2.y)/2,handler:controlHandler}})}}]),Polygon}(_component2["default"]);exports["default"]=Polygon,_component2["default"].register("polygon",Polygon)},{"./component":16}],36:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),controlHandler={ondragstart:function(point,index,component){component.mutatePath(null,function(path){path.splice(index+1,0,point)})},ondragmove:function(point,index,component){component.mutatePath(null,function(path){path[index+1]=point})},ondragend:function(point,index,component){}},Polyline=function(_Component){function Polyline(){return _classCallCheck(this,Polyline),_possibleConstructorReturn(this,Object.getPrototypeOf(Polyline).apply(this,arguments))}return _inherits(Polyline,_Component),_createClass(Polyline,[{key:"_draw",value:function(ctx){var _model=this.model,_model$alpha=_model.alpha,alpha=void 0===_model$alpha?1:_model$alpha,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden,_model$path=_model.path,path=void 0===_model$path?[]:_model$path;_model.rotation;if(!(path.length<=1)){ctx.beginPath(),ctx.globalAlpha=alpha,ctx.moveTo(path[0].x,path[0].y);for(var i=1;i<path.length;i++)ctx.lineTo(path[i].x,path[i].y);hidden||this.drawStroke(ctx)}}},{key:"contains",value:function(x,y){var path=this.model.path,result=!1;return path.forEach(function(p,idx){var j=(idx+path.length+1)%path.length,x1=p.x,y1=p.y,x2=path[j].x,y2=path[j].y;y1>y!=y2>y&&(x2-x1)*(y-y1)/(y2-y1)+x1>x&&(result=!result)}),result}},{key:"mutable",get:function(){return!0}},{key:"path",get:function(){return this.model.path},set:function(path){this.set("path",path)}},{key:"controls",get:function(){for(var path=this.path,controls=[],i=0;i<path.length-1;i++){var p1=path[i],p2=path[i+1];controls.push({x:(p1.x+p2.x)/2,y:(p1.y+p2.y)/2,handler:controlHandler})}return controls}}]),Polyline}(_component2["default"]);exports["default"]=Polyline,_component2["default"].register("polyline",Polyline)},{"./component":16}],37:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function roundSet(round,width,height){var max=width>height?height/width*100:100;return round>=max?round=max:0>=round&&(round=0),round}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),_memoize=require("../core/memoize"),memoize=_interopRequireWildcard(_memoize),controlHandler={ondragmove:function(point,index,component){var _component$model=(component.controls,component.model),left=_component$model.left,width=(_component$model.top,_component$model.width),height=_component$model.height,transcoorded=component.transcoordP2S(point.x,point.y),round=(transcoorded.x-left)/(width/2)*100;round=roundSet(round,width,height),component.set({round:round})}},Rect=function(_Component){function Rect(){return _classCallCheck(this,Rect),_possibleConstructorReturn(this,Object.getPrototypeOf(Rect).apply(this,arguments))}return _inherits(Rect,_Component),_createClass(Rect,[{key:"_draw",value:function(ctx){var _model=this.model,_model$lineWidth=_model.lineWidth,lineWidth=void 0===_model$lineWidth?5:_model$lineWidth,left=_model.left,top=_model.top,width=_model.width,height=_model.height,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden,_model$innerBorder=_model.innerBorder,innerBorder=void 0===_model$innerBorder?!1:_model$innerBorder,_model$round=_model.round,round=void 0===_model$round?0:_model$round;if(ctx.beginPath(),innerBorder&&(top+=lineWidth/2,left+=lineWidth/2,width=width-lineWidth===0?1:width-lineWidth,height=height-lineWidth===0?1:height-lineWidth),round=roundSet(round,width,height),round>0){var tmpRound=round/100*(width/2);ctx.moveTo(left+tmpRound,top),ctx.lineTo(left+width-tmpRound,top),ctx.quadraticCurveTo(left+width,top,left+width,top+tmpRound),ctx.lineTo(left+width,top+height-tmpRound),ctx.quadraticCurveTo(left+width,top+height,left+width-tmpRound,top+height),ctx.lineTo(left+tmpRound,top+height),ctx.quadraticCurveTo(left,top+height,left,top+height-tmpRound),ctx.lineTo(left,top+tmpRound),ctx.quadraticCurveTo(left,top,left+tmpRound,top)}else ctx.rect(left,top,width,height);hidden||(this.drawFill(ctx),
this.drawStroke(ctx))}},{key:"contains",value:function(x,y){var _model2=this.model,left=_model2.left,top=_model2.top,width=_model2.width,height=_model2.height;return x<Math.max(left+width,left)&&x>Math.min(left+width,left)&&y<Math.max(top+height,top)&&y>Math.min(top+height,top)}},{key:"path",get:function(){var _model3=this.model,left=_model3.left,top=_model3.top,width=_model3.width,height=_model3.height;return[{x:left,y:top},{x:left+width,y:top},{x:left+width,y:top+height},{x:left,y:top+height}]},set:function(path){var left_top=path[0],right_bottom=path[2];this.set({left:left_top.x,top:left_top.y,width:right_bottom.x-left_top.x,height:right_bottom.y-left_top.y})}},{key:"controls",get:function(){var _model4=this.model,left=_model4.left,top=_model4.top,width=_model4.width,round=_model4.round,height=_model4.height;return round=void 0==round?0:roundSet(round,width,height),[{x:left+width/2*(round/100),y:top,handler:controlHandler}]}}]),Rect}(_component2["default"]);exports["default"]=Rect,memoize.intercept(Rect,"path",!1),_component2["default"].register("rect",Rect)},{"../core/memoize":49,"./component":16}],38:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function onresize(){roots.forEach(function(p){p.resize()})}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_container=require("../components/container"),_container2=_interopRequireDefault(_container),_model=require("../model"),Model=_interopRequireWildcard(_model),_style=require("../style"),Style=_interopRequireWildcard(_style),_event=require("../event"),Event=_interopRequireWildcard(_event),_eventMap=require("../event-map"),EventMap=_interopRequireWildcard(_eventMap),_utils=require("../core/utils"),Utils=_interopRequireWildcard(_utils),roots=[];"undefined"!=typeof window&&window.addEventListener("resize",onresize);var RootContainer=function(_Container){function RootContainer(model,context){_classCallCheck(this,RootContainer);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(RootContainer).call(this,{type:"root",scale:{x:1,y:1}}));_this._app=context,_this.eventEngine=new Event.Engine(_this),_this.indexMap={},_this.target_element=model.target_element,_this._selected=[],_this.style=model.style,_this.content_model=model.model,_this.assist_layers=model.layers.map(function(layer){var compiled=Model.compile(layer,_this.app);return compiled.target=_this.target_element,_this.addComponent(compiled),compiled}),model.handlers&&model.handlers.forEach(function(eventMapName){_this.eventEngine.add({},EventMap.EventMap.get(eventMapName))}),roots.push(_this);var self=_this;return _this._onevent=function(e){self.onevent(e)},"undefined"!=typeof document&&(_this._ua_event_handler=new Event.UAEventHandler(_this,_this.target_element)),_this.invalidate(),_this}return _inherits(RootContainer,_Container),_createClass(RootContainer,[{key:"dispose",value:function(){this._ua_event_handler.dispose(),this.components.forEach(function(m){return m.dispose()}),this._app.dispose();var index=roots.indexOf(this);index>=0&&roots.splice(index,1)}},{key:"addIndex",value:function(id,component){this.indexMap[id]=component}},{key:"removeIndex",value:function(id,component){delete this.indexMap[id]}},{key:"findById",value:function(id){return this.indexMap[id]}},{key:"resize",value:function(){this.components.forEach(function(c){c.resize&&c.resize()}),this.invalidate()}},{key:"draw",value:function(){this.components.forEach(function(m){return m.draw()})}},{key:"contains",value:function(x,y){return!0}},{key:"invalidate",value:function(){this.draw()}},{key:"_addTraverse",value:function(component){var _this2=this;component.components&&component.components.forEach(function(child){return _this2._addTraverse(child)});var id=component.model.id;id&&this.addIndex(id,component);var eventMap=Utils.merge({},component.eventMap,component.model.eventMap);this.eventEngine.add(component,eventMap)}},{key:"_removeTraverse",value:function(component){var _this3=this;component.components&&component.components.forEach(function(child){return _this3._removeTraverse(child)});var id=component.model.id;id&&this.removeIndex(id,component),this.eventEngine.remove(component)}},{key:"onadded",value:function(container,component){this._addTraverse(component),this.invalidate()}},{key:"onremoved",value:function(container,component){this._removeTraverse(component),this.invalidate()}},{key:"onchanged",value:function(before,after,hint){before.id&&this.removeIndex(before.id,hint.origin),after.id&&this.addIndex(after.id,hint.origin)}},{key:"app",get:function(){return this._app}},{key:"appClass",set:function(clazz){this._app=new clazz}},{key:"root",get:function(){return this}},{key:"content_model",get:function(){return this._content_model},set:function(model){this._content_model=model,this.model_layer&&(this.model_layer.despose(),this.indexMap={},this.model_layer=null),model&&(this.indexMap={},this._content_model.type="model-layer",this.model_layer=Model.compile(model,this.app),this.model_layer.target=this.target_element,this.addComponent(this.model_layer))}},{key:"selected",get:function(){return this._selected},set:function(after){var before=this._selected;this._selected=after,this.trigger("selected",before,after)}},{key:"style",get:function(){return this._style},set:function(style){this._style=style,this._compiled_style=Style.compile(style)}},{key:"components",get:function(){var components=[];return this.model_layer&&components.push(this.model_layer),this.assist_layers?components.concat(this.assist_layers):components}},{key:"eventMap",get:function(){return{"(root)":{"(child)":{added:this.onadded,removed:this.onremoved,change:this.onchanged}}}}}]),RootContainer}(_container2["default"]);exports["default"]=RootContainer},{"../components/container":17,"../core/utils":52,"../event":62,"../event-map":57,"../model":85,"../style":88}],39:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),_rect=require("./rect"),_rect2=_interopRequireDefault(_rect),Ruler=function(_Rect){function Ruler(){return _classCallCheck(this,Ruler),_possibleConstructorReturn(this,Object.getPrototypeOf(Ruler).apply(this,arguments))}return _inherits(Ruler,_Rect),_createClass(Ruler,[{key:"_draw",value:function(ctx){var _model=this.model,_model$lineWidth=_model.lineWidth,lineWidth=void 0===_model$lineWidth?1:_model$lineWidth,_model$fillStyle=_model.fillStyle,fillStyle=void 0===_model$fillStyle?"lightgray":_model$fillStyle,_model$font=_model.font,font=void 0===_model$font?"15px Arial":_model$font,left=_model.left,top=_model.top,origin=(_model.rotation,_model.origin),width=(_model.margin,_model.width),height=_model.height,_model$side=(_model.unit,_model.side),side=void 0===_model$side?"bottom":_model$side,_model$strokeStyle=_model.strokeStyle,strokeStyle=void 0===_model$strokeStyle?"#000000":_model$strokeStyle,_model$scale=_model.scale,scale=void 0===_model$scale?1:_model$scale;ctx.translate(left,top),ctx.beginPath();var clip_bound=Math.round(lineWidth/2);ctx.rect(-clip_bound,-clip_bound,width+2*clip_bound,height+2*clip_bound),ctx.clip(),ctx.beginPath(),ctx.rect(0,0,width,height),fillStyle&&(ctx.fillStyle=fillStyle,ctx.fill()),ctx.lineWidth=lineWidth,ctx.strokeStyle=strokeStyle,ctx.stroke(),ctx.beginPath(),ctx.font=font;var top_side="bottom"!==side,end_pos=top_side?0:height,ypos_mm=4*height/5,ypos_5m=2*height/3,ypos_cm=1*height/2,ypos_txt=3*height/5;top_side&&(ypos_mm=height-ypos_mm,ypos_5m=height-ypos_5m,ypos_cm=height-ypos_cm,ypos_txt=height-1.5*height/5);for(var ppm=this.app.PPM*scale,idx=Math.ceil(origin/ppm),pos=Math.ceil(idx*ppm),end=origin+width;end>pos;){if(idx%10==0){ctx.moveTo(pos-origin,ypos_cm),ctx.lineTo(pos-origin,end_pos);var text=(idx/10).toString(),metrics=ctx.measureText(text);ctx.strokeText(text,pos-origin-metrics.width-6,ypos_txt)}else idx%5==0?(ctx.moveTo(pos-origin,ypos_5m),ctx.lineTo(pos-origin,end_pos)):(ctx.moveTo(pos-origin,ypos_mm),ctx.lineTo(pos-origin,end_pos));pos=Math.ceil(++idx*ppm)}ctx.stroke()}},{key:"controls",get:function(){}}]),Ruler}(_rect2["default"]);exports["default"]=Ruler,_component2["default"].register("ruler",Ruler)},{"./component":16,"./rect":37}],40:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),_ellipse=require("./ellipse"),_ellipse2=_interopRequireDefault(_ellipse),controlHandler={ondragmove:function(point,index,component){var _component$model=(component.controls,component.model),cy=_component$model.cy,ry=_component$model.ry,transcoorded=component.transcoordP2S(point.x,point.y),ratio=(transcoorded.y-cy)/ry*100+100;ratio>=100?ratio=100:0>=ratio&&(ratio=0),component.set({ratio:ratio})}},Star=function(_Ellipse){function Star(){return _classCallCheck(this,Star),_possibleConstructorReturn(this,Object.getPrototypeOf(Star).apply(this,arguments))}return _inherits(Star,_Ellipse),_createClass(Star,[{key:"_draw",value:function(ctx){var _model=this.model,_model$ratio=_model.ratio,ratio=void 0===_model$ratio?30:_model$ratio,_model$wing=_model.wing,wing=void 0===_model$wing?5:_model$wing,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden,cx=_model.cx,cy=_model.cy,rx=_model.rx,ry=_model.ry;_model.rotation,_model.startAngle,_model.endAngle,_model.anticlockwise;if(ctx.beginPath(),!(3>wing)){var RADIAN=1.5707963267948966,a=2*Math.PI/wing,xRatio=rx-ratio/100*rx,yRatio=ry-ratio/100*ry;ctx.save(),ctx.translate(cx,cy),ctx.moveTo(rx*Math.cos(-RADIAN),ry*Math.sin(-RADIAN)),ctx.lineTo((rx-xRatio)*(Math.cos(a-RADIAN)+Math.cos(0-RADIAN))/2,(ry-yRatio)*(Math.sin(a-RADIAN)+Math.sin(0-RADIAN))/2);for(var i=1;wing>i;i++)ctx.lineTo(rx*Math.cos(a*i-RADIAN),ry*Math.sin(a*i-RADIAN)),ctx.lineTo((rx-xRatio)*(Math.cos(a*(i+1)-RADIAN)+Math.cos(a*i-RADIAN))/2,(ry-yRatio)*(Math.sin(a*(i+1)-RADIAN)+Math.sin(a*i-RADIAN))/2);ctx.closePath(),ctx.restore(),hidden||(this.drawFill(ctx),this.drawStroke(ctx))}}},{key:"controls",get:function(){var _model2=this.model,cx=_model2.cx,cy=_model2.cy,ry=_model2.ry,ratio=_model2.ratio;return[{x:cx,y:cy-ry+ry*(ratio/100),handler:controlHandler}]}}]),Star}(_ellipse2["default"]);exports["default"]=Star,_component2["default"].register("star",Star)},{"./component":16,"./ellipse":24}],41:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),_rect=require("./rect"),_rect2=_interopRequireDefault(_rect),Text=function(_Rect){function Text(){return _classCallCheck(this,Text),_possibleConstructorReturn(this,Object.getPrototypeOf(Text).apply(this,arguments))}return _inherits(Text,_Rect),_createClass(Text,[{key:"_draw",value:function(ctx){}},{key:"controls",get:function(){}}]),Text}(_rect2["default"]);exports["default"]=Text,_component2["default"].register("text",Text)},{"./component":16,"./rect":37}],42:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("./component"),_component2=_interopRequireDefault(_component),_memoize=require("../core/memoize"),memoize=_interopRequireWildcard(_memoize),Triangle=function(_Component){function Triangle(){return _classCallCheck(this,Triangle),_possibleConstructorReturn(this,Object.getPrototypeOf(Triangle).apply(this,arguments))}return _inherits(Triangle,_Component),_createClass(Triangle,[{key:"_draw",value:function(ctx){var _model=this.model,x1=_model.x1,y1=_model.y1,x2=_model.x2,y2=_model.y2,x3=_model.x3,y3=_model.y3,_model$hidden=_model.hidden,hidden=void 0===_model$hidden?!1:_model$hidden;ctx.beginPath(),ctx.moveTo(x1,y1),ctx.lineTo(x2,y2),ctx.lineTo(x3,y3),ctx.closePath(),hidden||(this.drawFill(ctx),this.drawStroke(ctx))}},{key:"contains",value:function(x,y){for(var _model2=this.model,x1=_model2.x1,y1=_model2.y1,x2=_model2.x2,y2=_model2.y2,x3=_model2.x3,y3=_model2.y3,path=[x1,y1,x2,y2,x3,y3],result=!1,i=0;i<path.length;i+=2){var j=(i+2)%path.length,_x=path[i],_y=path[i+1],_x2=path[j],_y2=path[j+1];_y>y!=_y2>y&&(_x2-_x)*(y-_y)/(_y2-_y)+_x>x&&(result=!result)}return result}},{key:"mutable",get:function(){return!0}},{key:"path",get:function(){var _model3=this.model,x1=_model3.x1,y1=_model3.y1,x2=_model3.x2,y2=_model3.y2,x3=_model3.x3,y3=_model3.y3;return[{x:x1,y:y1},{x:x2,y:y2},{x:x3,y:y3}]},set:function(path){this.set({x1:path[0].x,y1:path[0].y,x2:path[1].x,y2:path[1].y,x3:path[2].x,y3:path[2].y})}}]),Triangle}(_component2["default"]);exports["default"]=Triangle,memoize.intercept(Triangle,"path",!1),_component2["default"].register("triangle",Triangle)},{"../core/memoize":49,"./component":16}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.MODE_VIEW=0,exports.MODE_EDIT=1,exports.MODE_SHIFT=2,exports.MAX_UNDO_SIZE=30,exports.EVENTS=["mousemove","mouseenter","mouseleave","mouseup","mousedown","mouseout","click","touchstart","touchmove","touchend","dragstart","dragmove","dragend","dblclick","keydown","keyup"]},{}],44:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function withList(){for(var key in list)this[key]=list[key]}function withStack(){for(var key in list)this[key]=list[key]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Stack=exports.List=void 0,exports.withList=withList,exports.withStack=withStack;var _list=require("./list"),list=_interopRequireWildcard(_list),_stack=require("./stack"),stack=_interopRequireWildcard(_stack),List=exports.List=function List(){_classCallCheck(this,List)},Stack=exports.Stack=function Stack(){_classCallCheck(this,Stack)};List.prototype=list,Stack.prototype=stack},{"./list":47,"./stack":51}],45:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function eventApi(obj,action,name,rest){if(!name)return!0;if("object"==("undefined"==typeof name?"undefined":_typeof(name))){for(var key in name){var val=name[key];obj[action].apply(obj,[key,val])}return!1}if(eventSplitter.test(name)){var names=name.split(eventSplitter);return names.forEach(function(val){return obj[action].apply(obj,[val].concat(rest))}),!1}return!0}function triggerEvents(listeners,args){listeners.forEach(function(listener){return listener.callback.apply(listener.ctx,args)})}function delegateEvents(delegators,args){delegators.forEach(function(delegator){return Event.delegate.apply(delegator,args)})}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj},_utils=require("./utils"),utils=_interopRequireWildcard(_utils),_collection=require("./collection"),eventSplitter=/\s+/,METHODS=["on","off","once","delegate_on","delegate_off","trigger","listenTo"],Event={withEvent:function(){var _this=this;METHODS.forEach(function(method){return _this[method]=Event[method]})},on:function(name,callback,context){if(!eventApi(this,"on",name,[callback,context])||!callback)return this;this._listeners||(this._listeners={});var events=this._listeners[name]||(this._listeners[name]=[]);return events.push({callback:callback,context:context,ctx:context||this}),this},once:function once(name,callback,context){if(!eventApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=utils.once(function(){self.off(name,once),callback.apply(self,arguments)});once._callback=callback,this.on(name,once,context)},off:function(name,callback,context){if(!this._listeners||!eventApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._listeners=void 0,this;var names;names=name?[name]:Object.keys(this._listeners);for(var i=0;i<names.length;i++){var _name=names[i],events=this._listeners[_name];if(events){var retain=[];if(this._listeners[_name]=retain,callback||context)for(var j=0;j<events.length;j++){var ev=events[j];(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev)}retain.length||delete this._listeners[_name]}}return this},delegate_on:function(delegator){return this._delegators||(this._delegators=new _collection.List),this._delegators.append(delegator),this},delegate_off:function(delegator){return this._delegators?(this._delegators.remove(delegator),this):this},delegate:function(){if(this._delegators&&this._delegators.size()>0&&delegateEvents(this._delegators,arguments),!this._listeners)return this;var event_idx=arguments.length-1,event=Object.assign({},arguments[event_idx]);event.deliverer=this,arguments[event_idx]=event;var listeners=this._listeners[event.name],listenersForAll=this._listeners["(all)"];return listeners&&triggerEvents(listeners,arguments),listenersForAll&&triggerEvents(listenersForAll,arguments),this},trigger:function(name){var args=[].slice.call(arguments,1);if(args.push({origin:this,name:name,deliverer:this}),this._delegators&&this._delegators.size()>0&&delegateEvents(this._delegators,args),!this._listeners)return this;if(!eventApi(this,"trigger",name,args))return this;var listeners=this._listeners[name],listenersForAll=this._listeners["(all)"];return listeners&&triggerEvents(listeners,args),listenersForAll&&triggerEvents(listenersForAll,args),this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;callback||"object"!=("undefined"==typeof name?"undefined":_typeof(name))||(callback=this),obj&&(listeningTo={},listeningTo[obj._listenId]=obj);for(var id in listeningTo){var _obj=listeningTo[id];_obj.off(name,callback,this),(remove||utils.isEmpty(_obj._events))&&delete this._listeningTo[id]}return this}},listenMethods={listenTo:"on",listenToOnce:"once"};for(var method in listenMethods){var implementation=listenMethods[method];Event[method]=function(obj,name,callback){this._listeningTo||(this._listeningTo={});var listeningTo=this._listeningTo;obj._listenId||(obj._listenId=utils.uniqueId("l"));var id=obj._listenId;return listeningTo[id]=obj,callback||"object"!=("undefined"==typeof name?"undefined":_typeof(name))||(callback=this),obj[implementation](name,callback,this),this}}exports["default"]=Event},{"./collection":44,"./utils":52}],46:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _logger=require("./logger");Object.defineProperty(exports,"logger",{enumerable:!0,get:function(){return _interopRequireDefault(_logger)["default"]}});var _event=require("./event");Object.defineProperty(exports,"event",{enumerable:!0,get:function(){return _interopRequireDefault(_event)["default"]}});var _mixin=require("./mixin");Object.defineProperty(exports,"mixin",{enumerable:!0,get:function(){return _interopRequireDefault(_mixin)["default"]}})},{"./event":45,"./logger":48,"./mixin":50}],47:[function(require,module,exports){"use strict";function insertAt(index,item){if(!this.__collection__)return this;var index=this.__collection__.indexOf(item);return-1==index&&this.__collection__.splice(index,0,item),this}function append(item){return this.__collection__||(this.__collection__=[]),-1==this.__collection__.indexOf(item)&&this.__collection__.push(item),this}function prepend(item){return this.__collection__||(this.__collection__=[]),-1==this.__collection__.indexOf(item)&&this.__collection__.unshift(item),this}function remove(item){if(!this.__collection__)return this;var index=this.__collection__.indexOf(item);return index>=0&&this.__collection__.splice(index,1),this}function getAt(index){return this.__collection__?this.__collection__[index]:void 0}function forEach(fn,context){this.__collection__&&this.__collection__.forEach(fn,context)}function indexOf(item){return this.__collection__?this.__collection__.indexOf(item):void 0}function size(){return this.__collection__?this.__collection__.length:0}function clear(){this.__collection__=[]}function moveForward(item){var index=this.indexOf(item);-1!=index&&0!=index&&(this.__collection__[index]=this.__collection__[index-1],this.__collection__[index-1]=item)}function moveBackward(item){var index=this.indexOf(item);-1!=index&&index!=this.size()-1&&(this.__collection__[index]=this.__collection__[index+1],this.__collection__[index+1]=item)}function moveToHead(item){var index=this.indexOf(item);if(-1!=index&&0!=index){var head=this.__collection__.splice(0,index),tail=this.__collection__.splice(1);this.__collection__=this.__collection__.concat(head,tail)}}function moveToTail(item){var index=this.indexOf(item);if(-1!=index&&index!=this.size()-1){var head=this.__collection__.splice(0,index),tail=this.__collection__.splice(1);this.__collection__=head.concat(tail,this.__collection__)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.insertAt=insertAt,exports.append=append,exports.prepend=prepend,exports.remove=remove,exports.getAt=getAt,exports.forEach=forEach,exports.indexOf=indexOf,exports.size=size,exports.clear=clear,exports.moveForward=moveForward,exports.moveBackward=moveBackward,exports.moveToHead=moveToHead,exports.moveToTail=moveToTail},{}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ERROR=("undefined"==typeof window?{}:window,"[ERROR]"),WARN="[WARN]",DEBUG="[DEBUG]",log=function(level){for(var _console,_len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)args[_key-1]=arguments[_key];return(_console=console).log.apply(_console,[level].concat(args))};exports.error=function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_len2>_key2;_key2++)args[_key2]=arguments[_key2];return log.apply(void 0,[ERROR].concat(args))},exports.warn=function(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_len3>_key3;_key3++)args[_key3]=arguments[_key3];return log.apply(void 0,[WARN].concat(args))},exports.debug=function(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_len4>_key4;_key4++)args[_key4]=arguments[_key4];return log.apply(void 0,[DEBUG].concat(args))}},{}],49:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function intercept(clazz,property,needClone){var old=clazz.prototype.__lookupGetter__(property);needClone?clazz.prototype.__defineGetter__(property,function(){return void 0===this.__cache__[property]&&(this.__cache__[property]=old.call(this)),utils.clone(this.__cache__[property])}):clazz.prototype.__defineGetter__(property,function(){return void 0===this.__cache__[property]&&(this.__cache__[property]=old.call(this)),this.__cache__[property]})}function reset(obj){obj.__cache__={}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.intercept=intercept,exports.reset=reset;var _utils=require("./utils"),utils=_interopRequireWildcard(_utils)},{"./utils":52}],50:[function(require,module,exports){"use strict";function mixin(base,mixins){if(mixins instanceof Array)mixins.forEach(function(mxn){return mixin(base,mxn)});else{if(base.mixedIn=base.hasOwnProperty("mixedIn")?base.mixedIn:[],base.mixingIn=base.hasOwnProperty("mixingIn")?base.mixingIn:[],base.mixedIn.indexOf(mixins)>=0)return base;if(base.mixingIn.indexOf(mixins)>=0)throw new Error("found cyclic dependencies between "+base.mixingIn);base.mixingIn.push(mixins),mixins.call(base),base.mixingIn.pop(),base.mixedIn.push(mixins)}return base}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=mixin},{}],51:[function(require,module,exports){"use strict";function push(item){throw new Error("Not Implemented Yet")}function pop(item){throw new Error("Not Implemented Yet")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.push=push,exports.pop=pop},{}],52:[function(require,module,exports){"use strict";function deepClone(object){return JSON.parse(JSON.stringify(object));
}function deepEquals(x,y){return JSON.stringify(x)===JSON.stringify(y)}function merge(){var target=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];"object"!=("undefined"==typeof target?"undefined":_typeof(target))&&(target={});for(var _len=arguments.length,extenders=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)extenders[_key-1]=arguments[_key];return extenders.forEach(function(other){var _loop=function(key){"object"!=_typeof(other[key])?target[key]=other[key]:other[key].length>0?target[key]=other[key].map(function(item){var v=void 0;return v="object"!=_typeof(other[key])?item:merge({},item)}):target[key]=merge(target[key],other[key])};for(var key in other)_loop(key)}),target}function shallow_merge(){for(var result={},_len2=arguments.length,extenders=Array(_len2),_key2=0;_len2>_key2;_key2++)extenders[_key2]=arguments[_key2];return extenders.forEach(function(other){for(var key in other)result[key]=other[key]}),result}function push(base,extra,protect){if(!base||!extra)return base;for(var key in extra){if(base[key]&&protect)throw new Error('utils.push attempted to overwrite "'+key+'" while running in protected mode');"object"==_typeof(base[key])&&"object"==_typeof(extra[key])?push(base[key],extra[key]):base[key]=extra[key]}return base}function once(func){var ran=!1,result=null;return function(){return ran?result:(result=func.apply(void 0,arguments),ran=!0,result)}}function uniqueId(prefix){return""+(prefix||"")+ ++idCounter}function clone(obj){return obj&&"object"==("undefined"==typeof obj?"undefined":_typeof(obj))?(obj instanceof Array&&obj.slice(),shallow_merge(obj)):obj}function isEmpty(val){if(void 0===val)return!0;if("function"==typeof val||"number"==typeof val||"boolean"==typeof val||"[object Date]"===Object.prototype.toString.call(val))return!1;if(null==val||0===val.length)return!0;if("object"==("undefined"==typeof val?"undefined":_typeof(val))){var r=!0;for(var f in val)r=!1;return r}return!1}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};exports.deepClone=deepClone,exports.deepEquals=deepEquals,exports.merge=merge,exports.shallow_merge=shallow_merge,exports.push=push,exports.once=once,exports.uniqueId=uniqueId,exports.clone=clone,exports.isEmpty=isEmpty;var idCounter=0},{}],53:[function(require,module,exports){"use strict";function gradation(client,ctx,model){var subType=(model.type,model.subType),from=model.from,to=model.to,colors=model.colors;switch(subType){case"linear":var grad=ctx.createLinearGradient(from.x,from.y,to.x,to.y);break;case"radial":var grad=ctx.createRadialGradient(from.x,from.y,from.r,to.x,to.y,to.r);break;default:var grad=ctx.createLinearGradient(from.x,from.y,to.x,to.y)}colors&&(colors.forEach(function(obj){grad.addColorStop(obj.endPoint,obj.color)}),ctx.fillStyle=grad,ctx.fill())}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=gradation},{}],54:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function effect(client,context,model){var effect=registry[model.type];effect&&effect(client,context,model)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=effect;var _gradation=require("./gradation"),_gradation2=_interopRequireDefault(_gradation),_shadow=require("./shadow"),_shadow2=_interopRequireDefault(_shadow),registry={gradation:_gradation2["default"],shadow:_shadow2["default"]}},{"./gradation":53,"./shadow":55}],55:[function(require,module,exports){"use strict";function outerGlow(client,ctx,model){var _model$offsetX=model.offsetX,offsetX=void 0===_model$offsetX?0:_model$offsetX,_model$offsetY=model.offsetY,offsetY=void 0===_model$offsetY?0:_model$offsetY,_model$alpha=model.alpha,alpha=void 0===_model$alpha?.99:_model$alpha,_model$blur=model.blur,blur=void 0===_model$blur?20:_model$blur,_model$color=model.color,color=void 0===_model$color?"black":_model$color;return ctx.shadowOffsetX=offsetX,ctx.shadowOffsetY=offsetY,ctx.alpha=alpha,ctx.shadowBlur=blur,ctx.shadowColor=color,ctx.fill(),!0}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=outerGlow},{}],56:[function(require,module,exports){"use strict";function register(name,eventMap){registry[name]=eventMap}function unregister(name){delete registry[name]}function get(name){return registry[name]}Object.defineProperty(exports,"__esModule",{value:!0});var registry={};exports["default"]={register:register,unregister:unregister,get:get}},{}],57:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventMap=void 0;var _eventMap=require("./event-map");Object.defineProperty(exports,"EventMap",{enumerable:!0,get:function(){return _interopRequireDefault(_eventMap)["default"]}});var _textEditor=require("./text-editor"),_moveHandler=(_interopRequireDefault(_textEditor),require("./move-handler"));_interopRequireDefault(_moveHandler)},{"./event-map":56,"./move-handler":58,"./text-editor":59}],58:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function calcOffsetInTouchEvent(e){var touch=e.touches[0];return{offsetX:touch.pageX-touch.target.offsetLeft,offsetY:touch.pageY-touch.target.offsetTop}}function ondragstart(e,hint){var deliverer=(hint.origin,hint.deliverer),selected=deliverer.selected;if(0!=selected.length){var point=selected[0].transcoordC2S(e.offsetX,e.offsetY);point=selected[0].transcoordS2P(point.x,point.y),this.last_pos=point,this.direction=DIR_NOT_YET,e.altKey?(deliverer.selected=selected.map(function(component){var clone=_duplicate2["default"](component);return component.parent.addComponent(clone),clone}),this.duplicates=deliverer.selected.map(function(component){return{component:component,to_container:component.parent}})):this.changes=_commandChange2["default"].before(selected)}}function ondragmove(e,hint){var deliverer=(hint.origin,hint.deliverer),selected=deliverer.selected;if(0!=selected.length){var point=selected[0].transcoordC2S(e.offsetX,e.offsetY),_selected$0$transcoor=selected[0].transcoordS2P(point.x,point.y),x=_selected$0$transcoor.x,y=_selected$0$transcoor.y;e.shiftKey?this.direction==DIR_ANY&&(this.direction=DIR_NOT_YET):this.direction=DIR_ANY;var diffx=x-this.last_pos.x,diffy=y-this.last_pos.y;if(this.direction==DIR_NOT_YET){if(200>diffx*diffx+diffy*diffy)return;Math.abs(diffx)>Math.abs(diffy)?this.direction=DIR_HORIZONTAL:this.direction=DIR_VERTICAL}this.direction==DIR_HORIZONTAL?diffy=0:this.direction==DIR_VERTICAL&&(diffx=0),selected.forEach(function(component){if(component instanceof _group2["default"]&&selected.length>1)for(var i=0;i<selected.length;i++){var sel=selected[i];if(component!==sel){if(component.parent===sel.parent)break;return!0}}component.move({x:diffx,y:diffy})}),selected.forEach(function(component){component.parent&&component.parent.calculateBounds&&component.parent.calculateBounds()}),point=selected[0].transcoordC2S(e.offsetX,e.offsetY),this.last_pos=selected[0].transcoordS2P(point.x,point.y)}}function ondragend(e,hint){var deliverer=(hint.origin,hint.deliverer),selected=deliverer.selected;if(0!=selected.length){if(this.changes)_commandChange2["default"].after(this.changes,deliverer.app.commander);else if(this.duplicates){var command=new _commandMigrate2["default"]({changes:this.duplicates});deliverer.app.commander.execute(command,!1)}this.last_pos=null,this.changes=null}}function ontouchstart(e,hint){var origin=hint.origin,deliverer=hint.deliverer,selected=deliverer.selected,_calcOffsetInTouchEve=calcOffsetInTouchEvent(e),_deliverer$transcoord=(_calcOffsetInTouchEve.offsetX,_calcOffsetInTouchEve.offsetY,deliverer.transcoordC2S(e.offsetX,e.offsetY)),x=_deliverer$transcoord.x,y=_deliverer$transcoord.y,idx=selected.indexOf(origin);-1==idx&&(selected=[origin]),this.last_pos={x:x,y:y}}function ontouchmove(e,hint){var _this=this,deliverer=(hint.origin,hint.deliverer),selected=deliverer.selected,_calcOffsetInTouchEve2=calcOffsetInTouchEvent(e),_deliverer$transcoord2=(_calcOffsetInTouchEve2.offsetX,_calcOffsetInTouchEve2.offsetY,deliverer.transcoordC2S(e.offsetX,e.offsetY)),x=_deliverer$transcoord2.x,y=_deliverer$transcoord2.y;selected.forEach(function(comp){comp.move({x:x-_this.last_pos.x,y:y-_this.last_pos.y})}),this.last_pos={x:x,y:y}}function ontouchend(e,hint){this.last_pos=null}function onkeydown(e,hint){var t={};switch(e.which){case 37:t.x=-1,t.y=0;break;case 38:t.x=0,t.y=-1;break;case 39:t.x=1,t.y=0;break;case 40:t.x=0,t.y=1;break;default:return}var deliverer=(hint.origin,hint.deliverer),selected=deliverer.selected;_commandChange2["default"].around(selected,deliverer.app.commander,function(){selected.forEach(function(component){component.move(t)})})}var _eventMap=require("./event-map"),_eventMap2=_interopRequireDefault(_eventMap),_duplicate=require("../model/duplicate"),_duplicate2=_interopRequireDefault(_duplicate),_group=require("../components/group"),_group2=_interopRequireDefault(_group),_commandChange=require("../command/command-change"),_commandChange2=_interopRequireDefault(_commandChange),_commandMigrate=require("../command/command-migrate"),_commandMigrate2=_interopRequireDefault(_commandMigrate),DIR_NOT_YET=0,DIR_ANY=2,DIR_HORIZONTAL=3,DIR_VERTICAL=4;_eventMap2["default"].register("move-handler",{"model-layer":{"(child)":{dragstart:ondragstart,dragmove:ondragmove,dragend:ondragend,touchstart:ontouchstart,touchmove:ontouchmove,touchend:ontouchend}},"(root)":{"(self)":{keydown:onkeydown}}})},{"../command/command-change":10,"../command/command-migrate":12,"../components/group":27,"../model/duplicate":84,"./event-map":56}],59:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function ondblclick(e,hint){function refreshTextsAlign(text){var lineSeq=calcLines(dictionary,text,width,scaleValue),totalHeight=lineSeq*lineHeight/DPPX;spanAdjust(component,span,input,point,totalHeight)}var component=hint.origin,_component$model=(hint.deliverer,component.model),_component$model$text=_component$model.text,text=void 0===_component$model$text?"":_component$model$text,_component$model$rota=_component$model.rotation,rotation=void 0===_component$model$rota?0:_component$model$rota,bold=_component$model.bold,italic=_component$model.italic,textType=_component$model.textType,fontFamily=_component$model.fontFamily,_component$model$font=_component$model.fontSize,fontSize=void 0===_component$model$font?15:_component$model$font,_component$model$text2=_component$model.textAlign,textAlign=void 0===_component$model$text2?"center":_component$model$text2,_component$model$line=(_component$model.textBaseline,_component$model.lineMargin),lineMargin=void 0===_component$model$line?0:_component$model$line,charHeight=(_component$model.charWidth,_component$model.charHeight),_component$model$padd=_component$model.paddingTop,paddingTop=void 0===_component$model$padd?0:_component$model$padd,_component$model$padd2=_component$model.paddingBottom,paddingBottom=void 0===_component$model$padd2?0:_component$model$padd2,_component$model$padd3=_component$model.paddingLeft,paddingLeft=void 0===_component$model$padd3?0:_component$model$padd3,_component$model$padd4=_component$model.paddingRight,paddingRight=void 0===_component$model$padd4?0:_component$model$padd4,_component$bounds=component.bounds,left=_component$bounds.left,top=_component$bounds.top,width=_component$bounds.width,height=_component$bounds.height,input=document.createElement("textarea");Const.EVENTS.forEach(function(event){input.addEventListener(event,function(e){e.stopPropagation()})});var lineHeight,dictionary=component.widthDictionary||{},DPPX=component.app.DPPX,point=component.transcoordS2C(left,top);"F"===textType?(fontSize=15,lineHeight=dictionary.get("M")):lineHeight=charHeight+lineMargin;for(var scaleValue=1,parent=component.parent;parent;){rotation+=parent.get("rotation")||0;var scale=parent.get("scale");scale&&(scaleValue*=Math.min(scale.x,scale.y)||1),parent=parent.parent}fontSize*=scaleValue,left*=scaleValue,top*=scaleValue,width*=scaleValue,height*=scaleValue,paddingTop*=scaleValue,paddingBottom*=scaleValue,paddingLeft*=scaleValue,paddingRight*=scaleValue,lineMargin*=scaleValue,lineHeight*=scaleValue,input.value="W"===textType?text:text.replace(/\s+/g," "),input.orgText=text,component.set("text",""),input.style.fontFamily=fontFamily,input.style.fontSize=fontSize/DPPX+"px",input.style.position="relative",input.style.lineHeight=lineHeight/DPPX+"px",input.style.overflow="hidden",input.style.resize="none",input.style.outline="none",input.style.border=0,input.style.backgroundColor="transparent";var rowQty=calcLines(dictionary,input.value,width,scaleValue),contextHeight=rowQty*lineHeight;width=width-paddingLeft-paddingRight;var span=document.createElement("span");switch(span.style.position="absolute",span.style.width=width/DPPX+"px",spanAdjust(component,span,input,point,contextHeight),input.style.width=width/DPPX+"px",input.style.display="inline-block",bold&&(input.style.fontWeight="bold"),italic&&(input.style.fontStyle="italic"),textAlign){case"left":case"start":case"justify":input.style.textAlign="left";break;case"right":case"end":input.style.textAlign="right";break;case"center":input.style.textAlign="center"}var rotate="rotate("+rotation+"rad)";["-webkit-","-moz-","-ms-","-o-",""].forEach(function(prefix){span.style[prefix+"transform"]=rotate,span.style[prefix+"transform-origin"]="0 0"});var targetElement=component.root.target_element;span.appendChild(input),targetElement.appendChild(span),input.select();var event;document.createEvent?(event=document.createEvent("HTMLEvents"),event.initEvent("blur",!0,!1)):(event=document.createEventObject(),event.eventType="blur"),input.onkeydown=function(e){var pressedValue=(e.target.value,String.fromCharCode(e.keyCode));switch(e.code){case"Escape":event.skipUpdate=!0,document.createEvent?input.dispatchEvent(event):input.fireEvent(event.eventType,event);break;case"Enter":refreshTextsAlign(input.value+"\n");break;default:refreshTextsAlign(input.value+pressedValue)}};var blurListener=function blurListener(e){if(input.removeEventListener("blur",blurListener,!1),targetElement.removeChild(span),e.skipUpdate)return void component.set("text",input.orgText);var text=input.value;component.app.commander.execute(new _commandChange2["default"]({changes:[{component:component,before:{text:input.orgText||""},after:{text:text}}]}))};input.addEventListener("blur",blurListener,!1)}function calcLines(dictionary,text,width,scaleValue){var lines=text.split("\n"),words=[];if(lines.length>1){var tmp=[];lines.forEach(function(line,i){tmp.push(line),i===lines.length-1||tmp.push("\n")}),tmp.forEach(function(line,i){var wordArr=line.split(" ");wordArr.forEach(function(w,idx){words.push(w)})})}else words=text.split(" ");var line="",lineSeq=0;return words.forEach(function(word,i){if("\n"===word)return lineSeq++,void(line="");if(textWidth(dictionary,word,scaleValue)>=width){line.length>0&&lineSeq++;for(var beforeIdx=0,_tmp="",_i=0;_i<word.length;_i++)_tmp=word.substring(beforeIdx,_i+1),textWidth(dictionary,_tmp,scaleValue)>=width&&(lineSeq++,beforeIdx=_i);return textWidth(dictionary,_tmp,scaleValue)>=width&&(beforeIdx=word.length-1,lineSeq++,_tmp=word.substring(beforeIdx)),void(line=_tmp)}var tmpLine=i===words.length-1?line+word:line+word+" ",tmpWidth=textWidth(dictionary,tmpLine,scaleValue);tmpWidth>=width?(lineSeq++,line=word+" "):line=tmpLine}),lineSeq++,lineSeq}function textWidth(dictionary,texts){for(var scaleValue=arguments.length<=2||void 0===arguments[2]?1:arguments[2],width=0,i=0;i<texts.length;i++){var char=texts[i];width+=dictionary.get(char)||dictionary.get("M")}return width*scaleValue}function spanAdjust(component,span,input,point,contextHeight){for(var _component$model2=component.model,type=_component$model2.type,_component$model2$tex=_component$model2.textBaseline,textBaseline=void 0===_component$model2$tex?"middle":_component$model2$tex,height=_component$model2.height,_component$model2$pad=_component$model2.paddingTop,paddingTop=void 0===_component$model2$pad?0:_component$model2$pad,_component$model2$pad2=_component$model2.paddingBottom,paddingBottom=void 0===_component$model2$pad2?0:_component$model2$pad2,_component$model2$pad3=_component$model2.paddingLeft,paddingLeft=void 0===_component$model2$pad3?0:_component$model2$pad3,_component$model2$pad4=_component$model2.paddingRight,paddingRight=void 0===_component$model2$pad4?0:_component$model2$pad4,parent=component.parent,scaleValue=1;parent;){var scale=parent.get("scale");scale&&(scaleValue*=Math.min(scale.x,scale.y)||1),parent=parent.parent}height*=scaleValue,paddingTop*=scaleValue,paddingBottom*=scaleValue,paddingLeft*=scaleValue,paddingRight*=scaleValue;var DPPX=component.app.DPPX;switch(paddingTop/=DPPX,paddingBottom/=DPPX,paddingLeft/=DPPX,paddingRight/=DPPX,height/=DPPX,contextHeight/=DPPX,"text"===type||height||(height=component.bounds.height/DPPX),height=height-paddingTop-paddingBottom,span.style.marginLeft=point.x+"px",span.style.marginTop=point.y+"px",textBaseline){case"top":case"hanging":span.style.paddingTop=paddingTop+"px",span.style.paddingBottom=paddingBottom+"px",input.style.height=height+"px";break;case"bottom":case"alphabetic":var _remain=height-contextHeight;span.style.paddingBottom=paddingBottom+"px",0>_remain?(span.style.paddingTop=paddingTop+"px",input.style.height=height+"px"):(span.style.paddingTop=_remain+paddingTop+"px",input.style.height=contextHeight+"px");break;case"middle":case"default":var remain=height-contextHeight;span.style.paddingBottom=paddingBottom+"px",0>remain?(span.style.paddingTop=paddingTop+"px",input.style.height=height+"px"):(span.style.paddingTop=remain/2+paddingTop+"px",input.style.height=contextHeight+remain/2+"px")}span.style.paddingLeft=paddingLeft+"px",span.style.paddingRight=paddingRight+"px",input.style.margin="0px"}var _const=require("../const"),Const=_interopRequireWildcard(_const),_eventMap=require("./event-map"),_eventMap2=_interopRequireDefault(_eventMap),_commandChange=require("../command/command-change"),_commandChange2=_interopRequireDefault(_commandChange);_eventMap2["default"].register("text-editor",{"model-layer":{"(child)":{dblclick:ondblclick}}})},{"../command/command-change":10,"../const":43,"./event-map":56}],60:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_eventPump=require("./event-pump"),_eventPump2=_interopRequireDefault(_eventPump),_selector=require("../model/selector"),ComponentSelector=_interopRequireWildcard(_selector),EventEngine=function(){function EventEngine(root){_classCallCheck(this,EventEngine),this.eventMaps=[],this.root=root,root.eventMap&&this.add(root,root.eventMap)}return _createClass(EventEngine,[{key:"stop",value:function(){this.eventMaps.forEach(function(map){return map.eventPump.stop()})}},{key:"add",value:function(listener,handlerMap){var _this=this;if(this.root){var _loop=function(selector){var handlers=handlerMap[selector];if("(self)"===selector&&"undefined"==typeof listener.on)throw new Error("(self) selector not available when deliverer is not a event handlable object.");var targets=ComponentSelector.select(selector,_this.root,listener);targets.forEach(function(target){var eventPump=new _eventPump2["default"](target);eventPump.on(listener,handlers),eventPump.start(),_this.eventMaps.push({eventPump:eventPump,listener:listener,handlerMap:handlerMap,target:target})})};for(var selector in handlerMap)_loop(selector)}}},{key:"remove",value:function(listener,handlerMap){for(var maps=this.eventMaps.slice(0),i=0;i<maps.length;i++){var item=maps[i];item.listener!==listener||handlerMap&&item.handlerMap!==handlerMap||(this.eventMaps.splice(i,1),item.eventPump.dispose())}}},{key:"clear",value:function(){var maps=this.eventMaps.slice(0);maps.forEach(function(map){return map.eventPump.dispose()}),this.eventMaps=[]}},{key:"dispose",value:function(){this.stop(),this.clear()}},{key:"root",set:function(root){this._root=root},get:function(){return this._root}}]),EventEngine}();exports["default"]=EventEngine},{"../model/selector":86,"./event-pump":61}],61:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function control(root,listener,handlers,event,args){for(var selector in handlers){var event_map=handlers[selector];if(Selector.match(selector,event.origin,listener,root))for(var event_name in event_map){var handler=event_map[event_name];event_name==event.name&&(event.listener=listener,handler.apply(listener,args))}}}function event_handler_fn(){var args=arguments,e=args[args.length-1],event_pump=this.event_pump;event_pump.listeners.forEach(function(listener){control(event_pump.deliverer,listener.listener,listener.cloned_handlers,e,args)})}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_selector=require("../model/selector"),Selector=_interopRequireWildcard(_selector),EventPump=function(){function EventPump(deliverer){if(_classCallCheck(this,EventPump),"undefined"==typeof deliverer.on)throw new Error("Deliverer should be a event handlable object.");this.deliverer=deliverer,this.listeners=[]}return _createClass(EventPump,[{key:"start",value:function(){this.deliverer.on("(all)",event_handler_fn,{event_pump:this})}},{key:"stop",value:function(){this.deliverer.off("(all)",event_handler_fn)}},{key:"on",value:function(listener,handlers){var cloned_handlers=Object.assign({},handlers),selectors=Object.keys(cloned_handlers);selectors.forEach(function(selector){if(0==selector.indexOf("?")){var handler=cloned_handlers[selector],variable=selector.substr(1),value=listener.get(variable);delete cloned_handlers[selector],value?cloned_handlers[value]=handler:console.log("EventPump#on","variable #{selector} is not evaluated on listener")}}),this.listeners.push({listener:listener,handlers:handlers,cloned_handlers:cloned_handlers})}},{key:"off",value:function(listener,handlers){for(var i=0;i<this.listeners.length;i++){var item=this.listeners[i];item.listener!==listener||handlers&&item.handlers!==handlers||this.listeners.splice(i,1)}}},{key:"clear",value:function(){this.listeners=[]}},{key:"dispose",value:function(){this.stop(),this.clear()}}]),EventPump}();exports["default"]=EventPump},{"../model/selector":86}],62:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _eventEngine=require("./event-engine");Object.defineProperty(exports,"Engine",{enumerable:!0,get:function(){return _interopRequireDefault(_eventEngine)["default"]}});var _uaEventHandler=require("./ua-event-handler");Object.defineProperty(exports,"UAEventHandler",{enumerable:!0,get:function(){return _interopRequireDefault(_uaEventHandler)["default"]}})},{"./event-engine":60,"./ua-event-handler":63}],63:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function overide_event(e,over){var xe=new _Event({type:over.type||e.type,offsetX:over.offsetX||e.offsetX,offsetY:over.offsetY||e.offsetY,altKey:over.altKey||e.altKey,ctrlKey:over.ctrlKey||e.ctrlKey,shiftKey:over.shiftKey||e.shiftKey,metaKey:over.metaKey||e.metaKey});return xe}function find_target(container,e){return container.capture(e.offsetX,e.offsetY)}function find_target_touch(container,e){return container.capture(e.touches[0].pageX-e.touches[0].target.offsetLeft,e.touches[0].pageY-e.touches[0].target.offsetTop)}function trigger(target,type,base_event){target.trigger(type,overide_event(base_event,{type:type}))}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../components/component"),_container=(_interopRequireDefault(_component),require("../components/container")),_const=(_interopRequireDefault(_container),require("../const")),Const=_interopRequireWildcard(_const),STATUS={NORMAL:0,DRAGGABLE:1,DRAGGING:2},_Event=function(){function _Event(e){_classCallCheck(this,_Event),this._type=e.type,this._offsetX=e.offsetX,this._offsetY=e.offsetY,this._ctrlKey=e.ctrlKey,this._altKey=e.altKey,this._shiftKey=e.shiftKey,this._metaKey=e.metaKey}return _createClass(_Event,[{key:"type",get:function(){return this._type}},{key:"offsetX",get:function(){return this._offsetX}},{key:"offsetY",get:function(){return this._offsetY}},{key:"altKey",get:function(){return this._altKey}},{key:"ctrlKey",get:function(){return this._ctrlKey}},{key:"shiftKey",get:function(){return this._shiftKey}},{key:"metaKey",get:function(){return this._metaKey}}]),_Event}(),UAEventHandler=function(){function UAEventHandler(container,html_element){var _this=this;_classCallCheck(this,UAEventHandler),this.container=container,this.html_element=html_element,this.status=STATUS.NORMAL,this.last_target=null,this._eventHandler=this.onevent.bind(this),Const.EVENTS.map(function(type){return html_element.addEventListener(type,_this._eventHandler)}),html_element.setAttribute("contenteditable","true")}return _createClass(UAEventHandler,[{key:"dispose",value:function(){var _this2=this;Const.EVENTS.forEach(function(type){return _this2.html_element.removeEventListener(type,_this2._eventHandler)})}},{key:"onevent",value:function(e){return this["on"+e.type](e)}},{key:"ondragstart",value:function(e){}},{key:"ondragend",value:function(e){}},{key:"onclick",value:function(e){var target=find_target(this.container,e);return target.trigger(e.type,e),this.last_target=null,!1}},{key:"ondblclick",value:function(e){var target=find_target(this.container,e);return target.trigger(e.type,e),this.last_target=null,!1}},{key:"onkeydown",value:function(e){return this.container.trigger(e.type,e),!1}},{key:"onkeyup",value:function(e){return this.container.trigger(e.type,e),!1}},{key:"onmousemove",value:function(e){switch(this.status){case STATUS.DRAGGABLE:this.status=STATUS.DRAGGING,trigger(this.last_target,"dragstart",e),trigger(this.last_target,"dragmove",e);break;case STATUS.DRAGGING:trigger(this.last_target,"dragmove",e);break;default:var target=find_target(this.container,e);this.last_target!=target&&(this.last_target&&trigger(this.last_target,"mouseleave",e),target&&trigger(target,"mouseenter",e)),target.trigger(e.type,e),this.last_target=target}return!1}},{key:"onmousedown",value:function(e){var target=find_target(this.container,e);return this.last_target=target,this.status=STATUS.DRAGGABLE,target.trigger(e.type,e),!1}},{key:"onmouseup",value:function(e){switch(this.status){case STATUS.DRAGGING:trigger(this.last_target,"dragend",e);break;default:var target=find_target(this.container,e);trigger(target,e.type,e)}return this.last_target=null,this.status=STATUS.NORMAL,!1}},{key:"onmouseenter",value:function(e){}},{key:"onmouseleave",value:function(e){}},{key:"onmouseout",value:function(e){switch(this.status){case STATUS.DRAGGING:trigger(this.last_target,"dragend",e);break;default:this.last_target&&trigger(this.last_target,e.type,e)}return this.last_target=null,this.status=STATUS.NORMAL,!1}},{key:"ontouchstart",value:function(e){var target=find_target_touch(this.container,e);return target&&target.trigger("touchstart",e),this.last_target=target,e.preventDefault(),!1}},{key:"ontouchmove",value:function(e){return this.last_target&&this.last_target.trigger("touchmove",e),e.preventDefault(),!1}},{key:"ontouchend",value:function(e){return this.last_target&&this.last_target.trigger("touchend",e),this.last_target=null,e.preventDefault(),!1}}]),UAEventHandler}();exports["default"]=UAEventHandler},{"../components/component":16,"../components/container":17,"../const":43}],64:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function calcOriginRectCoord(translate,width,height){return{left:-translate.x,top:-translate.y,width:HRULER_LEFT,height:RULER_HEIGHT}}function calcHRulerCoord(translate,width,height,ruler){return{left:HRULER_LEFT-translate.x,top:HRULER_TOP-translate.y,origin:HRULER_ORIGIN-translate.x,width:width-HRULER_LEFT,height:RULER_HEIGHT
}}function calcVRulerCoord(translate,width,height,ruler){var center={x:-translate.x+VRULER_LEFT+RULER_HEIGHT/2,y:-translate.y+VRULER_TOP+(height-VRULER_TOP)/2},right_top=_component2["default"].transcoordRR(-translate.x+VRULER_LEFT,-translate.y+VRULER_TOP,center,VRULER_ROTATE);return{left:right_top.x-(height-VRULER_TOP),top:right_top.y,origin:VRULER_ORIGIN-translate.y,width:height-VRULER_TOP,height:RULER_HEIGHT}}function calcBounds(layout){var translate=layout.get("translate");return{left:-translate.x,top:-translate.y,width:layout.canvas.width,height:layout.canvas.height}}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_component=require("../components/component"),_component2=_interopRequireDefault(_component),_layer=require("./layer"),_layer2=_interopRequireDefault(_layer),_ruler=require("../components/ruler"),_ruler2=_interopRequireDefault(_ruler),_rect=require("../components/rect"),_rect2=_interopRequireDefault(_rect),HRULER_LEFT=30,HRULER_TOP=0,HRULER_ORIGIN=30,VRULER_LEFT=0,VRULER_TOP=30,VRULER_ORIGIN=30,VRULER_ROTATE=90*Math.PI/180,RULER_UNIT="m",RULER_MARGIN=0,RULER_FONT="13px Verdana",RULER_HEIGHT=30,RULER_COLOR="#f4f4f4",RULER_STROKE="#999",GuideLayer=function(_Layer){function GuideLayer(model,context){_classCallCheck(this,GuideLayer);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(GuideLayer).call(this,model,context));return _this.appScale={x:1,y:1},_this.set("capturable",!1),_this.hruler=new _ruler2["default"]({left:HRULER_LEFT,top:HRULER_TOP,origin:HRULER_ORIGIN,margin:RULER_MARGIN,height:RULER_HEIGHT,unit:RULER_UNIT,rotation:0,font:RULER_FONT,fillStyle:RULER_COLOR,strokeStyle:RULER_STROKE,capturable:!1}),_this.vruler=new _ruler2["default"]({left:0,top:0,origin:VRULER_ORIGIN,margin:RULER_MARGIN,height:RULER_HEIGHT,unit:RULER_UNIT,rotation:VRULER_ROTATE,font:RULER_FONT,side:"top",fillStyle:RULER_COLOR,strokeStyle:RULER_STROKE,capturable:!1}),_this.origin_rect=new _rect2["default"]({left:-HRULER_ORIGIN,top:-VRULER_ORIGIN,width:HRULER_ORIGIN,height:VRULER_ORIGIN,fillStyle:RULER_COLOR,strokeStyle:RULER_STROKE,lineWidth:1}),_this.addComponent(_this.hruler),_this.addComponent(_this.vruler),_this.addComponent(_this.origin_rect),_this}return _inherits(GuideLayer,_Layer),_createClass(GuideLayer,[{key:"added",value:function(parent){var model_base=this.root.model_layer,translate=Object.assign({},model_base.get("translate"));translate.x<HRULER_LEFT&&(translate.x+=HRULER_LEFT),translate.y<VRULER_TOP&&(translate.y+=VRULER_TOP),model_base.set("translate",translate),translate=model_base.get("translate");var _canvas=this.canvas,width=_canvas.width,height=_canvas.height;this.set("translate",translate),this.hruler.set(calcHRulerCoord(translate,width,height,this.hruler)),this.vruler.set(calcVRulerCoord(translate,width,height,this.vruler)),this.origin_rect.set(calcOriginRectCoord(translate,width,height));var scale=model_base.get("scale");scale&&(this.appScale=scale,this.hruler.set("scale",scale.x),this.vruler.set("scale",scale.y)),this.screen_coord=calcBounds(this)}},{key:"resize",value:function(){_get(Object.getPrototypeOf(GuideLayer.prototype),"resize",this).call(this);var _canvas2=this.canvas,width=_canvas2.width,height=_canvas2.height;this.hruler.set(calcHRulerCoord(this.model.translate,width,height,this.hruler)),this.vruler.set(calcVRulerCoord(this.model.translate,width,height,this.vruler)),this.origin_rect.set(calcOriginRectCoord(this.model.translate,width,height)),this.screen_coord=calcBounds(this)}},{key:"_draw",value:function(ctx){if(this.components.forEach(function(m){ctx.save(),m.draw(ctx),ctx.restore()}),this.guide){var _guide=this.guide,x=_guide.x,y=_guide.y,_screen_coord=this.screen_coord,top=_screen_coord.top,left=_screen_coord.left,width=_screen_coord.width,height=_screen_coord.height;ctx.beginPath(),ctx.moveTo(x,top),ctx.lineTo(x,top+height),ctx.moveTo(left,y),ctx.lineTo(left+width,y),ctx.lineWidth=1,ctx.strokeStyle="tomato",ctx.setLineDash([2,3]),ctx.font="15px tahoma",ctx.fillStyle="#333";var screen_coord=this.transcoordS2C(x,y,this.root.model_layer);ctx.textBaseline=screen_coord.y>200?"bottom":"top",ctx.textAlign=screen_coord.x>200?"right":"left";var yMargin=screen_coord.y>200?-5:5,xMargin=screen_coord.x>200?-5:5,scaled_x=Math.round(x/this.appScale.x),scaled_y=Math.round(y/this.appScale.y);ctx.fillText(" "+scaled_x+", "+scaled_y+" ",x+xMargin,y+yMargin),ctx.stroke()}}},{key:"contains",value:function(x,y){return!0}},{key:"onmousedown_origin",value:function(e,hint){var model_base=this.root.model_layer;model_base.set("translate",{x:HRULER_ORIGIN,y:VRULER_ORIGIN})}},{key:"onchange_model_base",value:function(before,after,desc){if(after.scale&&(this.appScale=after.scale,this.hruler.set("scale",after.scale.x),this.vruler.set("scale",after.scale.y)),after.translate){this.set({translate:{x:after.translate.x,y:after.translate.y}});var translate=this.model.translate,_canvas3=this.canvas,width=_canvas3.width,height=_canvas3.height;this.hruler.set(calcHRulerCoord(translate,width,height,this.hruler)),this.vruler.set(calcVRulerCoord(translate,width,height,this.vruler)),this.origin_rect.set(calcOriginRectCoord(translate,width,height)),this.screen_coord=calcBounds(this)}this.invalidate()}},{key:"onmousemove",value:function(e,obj){e.target&&"CANVAS"!==e.target.tagName?this.guide=null:this.guide=this.transcoordC2S(e.offsetX,e.offsetY)}},{key:"ontouchstart",value:function(e,obj){var first_touch=e.touches[0];this.guide=this.transcoordC2S(first_touch.pageX-first_touch.target.offsetLeft,first_touch.pageY-first_touch.target.offsetTop)}},{key:"ontouchmove",value:function(e,obj){var first_touch=e.touches[0];this.guide=this.transcoordC2S(first_touch.pageX-first_touch.target.offsetLeft,first_touch.pageY-first_touch.target.offsetTop)}},{key:"ontouchend",value:function(e,obj){this.guide=void 0}},{key:"guide",get:function(){return this._guide},set:function(guide){this._guide=guide,this.invalidate()}},{key:"eventMap",get:function(){return{"(root)":{"(child)":{mousemove:this.onmousemove,dragmove:this.onmousemove,touchstart:this.ontouchstart,touchmove:this.ontouchmove,touchend:this.ontouchend},"model-layer":{change:this.onchange_model_base}},"(self)":{"(child)":{mousedown:this.onmousedown_origin}}}}}]),GuideLayer}(_layer2["default"]);exports["default"]=GuideLayer,_component2["default"].register("guide-layer",GuideLayer)},{"../components/component":16,"../components/rect":37,"../components/ruler":39,"./layer":66}],65:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _modelLayer=require("./model-layer");Object.defineProperty(exports,"ModelLayer",{enumerable:!0,get:function(){return _interopRequireDefault(_modelLayer)["default"]}});var _guideLayer=require("./guide-layer");Object.defineProperty(exports,"ShiftLayer",{enumerable:!0,get:function(){return _interopRequireDefault(_guideLayer)["default"]}});var _shiftLayer=require("./shift-layer");Object.defineProperty(exports,"GuideLayer",{enumerable:!0,get:function(){return _interopRequireDefault(_shiftLayer)["default"]}});var _selectionLayer=require("./selection-layer");Object.defineProperty(exports,"SelectionLayer",{enumerable:!0,get:function(){return _interopRequireDefault(_selectionLayer)["default"]}});var _modelingLayer=require("./modeling-layer");Object.defineProperty(exports,"ModelingLayer",{enumerable:!0,get:function(){return _interopRequireDefault(_modelingLayer)["default"]}});var _mapOverlayLayer=require("./map-overlay-layer");Object.defineProperty(exports,"MapOverlayLayer",{enumerable:!0,get:function(){return _interopRequireDefault(_mapOverlayLayer)["default"]}})},{"./guide-layer":64,"./map-overlay-layer":67,"./model-layer":68,"./modeling-layer":74,"./selection-layer":75,"./shift-layer":76}],66:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_container=require("../components/container"),_container2=_interopRequireDefault(_container),Layer=function(_Container){function Layer(model,context){_classCallCheck(this,Layer);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Layer).call(this,model,context));return model.translate=model.translate||{x:0,y:0},_this}return _inherits(Layer,_Container),_createClass(Layer,[{key:"resize",value:function(){if(this.canvas){var target=this.canvas.parentNode;this.canvas.setAttribute("width",target.offsetWidth*this.app.DPPX),this.canvas.setAttribute("height",target.offsetHeight*this.app.DPPX),this.canvas.style.width=target.offsetWidth+"px",this.canvas.style.height=target.offsetHeight+"px"}}},{key:"dispose",value:function(){window.removeEventListener("resize",this._onresize),this.target.removeChild(this.canvas),this.canvas=null}},{key:"getContext",value:function(){return this.canvas&&this.canvas.getContext("2d")}},{key:"draw",value:function(context){var context=context||this.getContext();context&&_get(Object.getPrototypeOf(Layer.prototype),"draw",this).call(this,context)}},{key:"_pre_draw",value:function(context){var _model=this.model,translate=_model.translate,scale=_model.scale,rotation=_model.rotation;context.clearRect(0,0,context.canvas.width,context.canvas.height),translate&&context.translate(translate.x,translate.y),scale&&context.scale(scale.x,scale.y),rotation&&context.rotate(rotation)}},{key:"contains",value:function(x,y){return!1}},{key:"invalidate",value:function(){if(this._is_dirty!==!0){this._is_dirty=!0;var self=this;setTimeout(function(){self.draw(),self._is_dirty=!1})}}},{key:"move",value:function(toward){var translate=this.get("translate")||{x:0,y:0};this.set({translate:{x:translate.x+toward.x,y:translate.y+toward.y}})}},{key:"target",get:function(){return this._target},set:function(target){this._target&&this._target.removeChild(this.canvas),this._target=target,this.canvas||(this.canvas="undefined"==typeof document?new Canvas(screen.width,screen.height):document.createElement("canvas")),this.model.width&&target.setAttribute("width",this.model.width),this.model.height&&target.setAttribute("height",this.model.height),"undefined"==typeof document?target.canvas=this.canvas:(this.canvas.setAttribute("width",target.offsetWidth*this.app.DPPX),this.canvas.setAttribute("height",target.offsetHeight*this.app.DPPX),this.canvas.style.width=target.offsetWidth+"px",this.canvas.style.height=target.offsetHeight+"px",this.canvas.style.position="absolute",target.appendChild(this.canvas))}},{key:"selected",get:function(){return this.root.selected},set:function(sels){this.root.selected=sels}},{key:"rotatePoint",get:function(){return{x:0,y:0}}}]),Layer}(_container2["default"]);exports["default"]=Layer},{"../components/container":17}],67:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../components/component"),_component2=_interopRequireDefault(_component),_layer=require("./layer"),_layer2=_interopRequireDefault(_layer),_const=require("../const"),Const=_interopRequireWildcard(_const),MapOverayLayer=function(_Layer){function MapOverayLayer(){return _classCallCheck(this,MapOverayLayer),_possibleConstructorReturn(this,Object.getPrototypeOf(MapOverayLayer).apply(this,arguments))}return _inherits(MapOverayLayer,_Layer),_createClass(MapOverayLayer,[{key:"added",value:function(parent){var model_base=this.root.model_layer,translate=model_base.get("translate");this.set("translate",translate)}},{key:"_draw",value:function(ctx){ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"contains",value:function(x,y){return!(!event||this.app.mode!=Const.MODE_SHIFT)}},{key:"onkeydown",value:function(e){32==e.keyCode&&void 0===this.before_mode&&(this.before_mode=this.app.mode,this.app.mode=Const.MODE_SHIFT)}},{key:"onkeyup",value:function(e){32==e.keyCode&&(void 0!=this.before_mode&&(this.app.mode=this.before_mode),delete this.before_mode)}},{key:"ondragstart",value:function(e){this.last_position=this.transcoordC2S(e.offsetX,e.offsetY)}},{key:"ondragmove",value:function(e){console.log("dragmove",this.app.map);var map=this.app.map,bounds=(map.getProjection(),map.getBounds()),ne=bounds.getNorthEast(),lat=ne.lat();console.log("lat",lat),bounds=new google.maps.LatLngBounds(new google.maps.LatLng(lat+.1,ne.lng()),bounds.getSouthWest()),map.fitBounds(bounds);var model_base=this.root.model_layer,_transcoordC2S=this.transcoordC2S(e.offsetX,e.offsetY),x=_transcoordC2S.x,y=_transcoordC2S.y;model_base.move({x:x-this.last_position.x,y:y-this.last_position.y}),this.last_position=this.transcoordC2S(e.offsetX,e.offsetY)}},{key:"eventMap",get:function(){return{"(root)":{"(self)":{keydown:this.onkeydown,keyup:this.onkeyup}},"(self)":{"(self)":{dragstart:this.ondragstart,dragmove:this.ondragmove}}}}}]),MapOverayLayer}(_layer2["default"]);exports["default"]=MapOverayLayer,_component2["default"].register("map-overlay-layer",MapOverayLayer)},{"../components/component":16,"../const":43,"./layer":66}],68:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../components/component"),_component2=_interopRequireDefault(_component),_layer=require("./layer"),_layer2=_interopRequireDefault(_layer),ModelLayer=function(_Layer){function ModelLayer(){return _classCallCheck(this,ModelLayer),_possibleConstructorReturn(this,Object.getPrototypeOf(ModelLayer).apply(this,arguments))}return _inherits(ModelLayer,_Layer),_createClass(ModelLayer,[{key:"contains",value:function(x,y){return!0}},{key:"onchanged",value:function(before,after,desc){this.invalidate()}},{key:"eventMap",get:function(){return{"(self)":{"(all)":{change:this.onchanged}}}}}]),ModelLayer}(_layer2["default"]);exports["default"]=ModelLayer,_component2["default"].register("model-layer",ModelLayer)},{"../components/component":16,"./layer":66}],69:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_commandChange=require("../../command/command-change"),_commandChange2=_interopRequireDefault(_commandChange),ControlHandler=function(){function ControlHandler(layer){_classCallCheck(this,ControlHandler),this.layer=layer}return _createClass(ControlHandler,[{key:"reset",value:function(){this.active=null}},{key:"contains",value:function(x,y,component,scale){var _this=this,controls=component.controls;return controls?(controls.every(function(control,index){return Math.abs(x-control.x)<=5/scale.x&&Math.abs(y-control.y)<=5/scale.y&&(_this.active={component:component,index:index,handler:control.handler}),!_this.active}),!!this.active):!1}},{key:"draw",value:function(context,component,scale){var controls=component.controls;controls&&controls.forEach(function(point,index){context.beginPath(),context.lineWidth=1/scale.x,context.ellipse(point.x,point.y,6/scale.x,6/scale.y,0,0,2*Math.PI,!0),context.fillStyle="#ff5d72",context.fill(),context.strokeStyle="#fff",context.stroke()})}},{key:"onevent",value:function(event,e){var _active=this.active,handler=_active.handler,component=_active.component,index=_active.index,point=component.transcoordC2S(e.offsetX,e.offsetY);point=component.transcoordS2P(point.x,point.y),handler&&"function"==typeof handler[event]&&handler[event](point,index,component)}},{key:"onmousedown",value:function(e){this.onevent("onmousedown",e)}},{key:"ondragstart",value:function(e){var active=this.active;active.changes=_commandChange2["default"].before([active.component]),this.onevent("ondragstart",e)}},{key:"ondragmove",value:function(e){this.onevent("ondragmove",e)}},{key:"ondragend",value:function(e){this.onevent("ondragend",e);var _active2=this.active,component=_active2.component,changes=_active2.changes;_commandChange2["default"].after(changes,component.app.commander),component.parent&&component.parent.calculateBounds&&component.parent.calculateBounds()}},{key:"selected",get:function(){return this.layer.selected}}]),ControlHandler}();exports["default"]=ControlHandler},{"../../command/command-change":10}],70:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _controlHandler=require("./control-handler");Object.defineProperty(exports,"ControlHandler",{enumerable:!0,get:function(){return _interopRequireDefault(_controlHandler)["default"]}});var _pathHandler=require("./path-handler");Object.defineProperty(exports,"PathHandler",{enumerable:!0,get:function(){return _interopRequireDefault(_pathHandler)["default"]}});var _resizer=require("./resizer");Object.defineProperty(exports,"Resizer",{enumerable:!0,get:function(){return _interopRequireDefault(_resizer)["default"]}});var _rotator=require("./rotator");Object.defineProperty(exports,"Rotator",{enumerable:!0,get:function(){return _interopRequireDefault(_rotator)["default"]}})},{"./control-handler":69,"./path-handler":71,"./resizer":72,"./rotator":73}],71:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_commandChange=require("../../command/command-change"),_commandChange2=_interopRequireDefault(_commandChange),PathHandler=function(){function PathHandler(layer){_classCallCheck(this,PathHandler),this.layer=layer}return _createClass(PathHandler,[{key:"reset",value:function(){this.active=null}},{key:"contains",value:function(x,y,component,scale){var _this=this;return component.mutable?(component.path.every(function(point,index){return Math.abs(x-point.x)<=5/scale.x&&Math.abs(y-point.y)<=5/scale.y&&(_this.active={component:component,index:index}),!_this.active}),!!this.active):!1}},{key:"draw",value:function(context,component,scale){if(component.mutable){var path=component.path,active=this.active;path.forEach(function(point,index){context.beginPath(),context.ellipse(point.x,point.y,6/scale.x,6/scale.y,0,0,2*Math.PI,!0),context.strokeStyle="#656565",context.fillStyle="#fff",active&&active.component===component&&active.index===index&&(context.strokeStyle="#fa7703",active.toFill&&(context.fillStyle="#ffb80c")),context.fill(),context.stroke()})}}},{key:"onmousedown",value:function(e){this.active.toFill=!0}},{key:"ondragstart",value:function(e){var active=this.active;active.changes=_commandChange2["default"].before([active.component])}},{key:"ondragmove",value:function(e){var _active=this.active,component=_active.component,index=_active.index,point=component.transcoordC2S(e.offsetX,e.offsetY);point=component.transcoordS2P(point.x,point.y),component.mutatePath(null,function(path){path[index]=point})}},{key:"ondragend",value:function(e){var _active2=this.active,component=_active2.component,changes=_active2.changes;_commandChange2["default"].after(changes,component.app.commander),component.parent&&component.parent.calculateBounds&&component.parent.calculateBounds()}},{key:"selected",get:function(){return this.layer.selected}}]),PathHandler}();exports["default"]=PathHandler},{"../../command/command-change":10}],72:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function resizeHandler(component,index,point,event){var x,y,_component$bounds=component.bounds,left=_component$bounds.left,top=_component$bounds.top,width=_component$bounds.width,height=_component$bounds.height;switch(index){case LEFT_TOP:x=left,y=top;break;case TOP:x=left+width/2,y=top;break;case RIGHT_TOP:x=left+width,y=top;break;case RIGHT:x=left+width,y=top+height/2;break;case RIGHT_BOTTOM:x=left+width,y=top+height;break;case BOTTOM:x=left+width/2,y=top+height;break;case LEFT_BOTTOM:x=left,y=top+height;break;case LEFT:x=left,y=top+height/2}var old_position={x:x,y:y},new_position=component.transcoordT2S(point.x,point.y),delta_x=new_position.x-old_position.x,delta_y=new_position.y-old_position.y,old_left=left,old_top=top,old_height=height,old_width=width;switch(index){case LEFT_TOP:event.shiftKey?-delta_x>-delta_y?(left+=delta_x,top+=delta_x*(old_height/old_width),width-=delta_x,height-=delta_x*(old_height/old_width)):(left+=delta_y*(old_width/old_height),top+=delta_y,width-=delta_y*(old_width/old_height),height-=delta_y):(left+=delta_x,top+=delta_y,width-=delta_x,height-=delta_y);break;case TOP:top+=delta_y,height-=delta_y;break;case RIGHT_TOP:event.shiftKey?delta_x>-delta_y?(width+=delta_x,top-=delta_x*(old_height/old_width),height+=delta_x*(old_height/old_width)):(width-=delta_y*(old_width/old_height),top+=delta_y,height-=delta_y):(top+=delta_y,width+=delta_x,height-=delta_y);break;case RIGHT:width+=delta_x;break;case RIGHT_BOTTOM:event.shiftKey?delta_x>delta_y?(width+=delta_x,height+=delta_x*(old_height/old_width)):(width+=delta_y*(old_width/old_height),height+=delta_y):(width+=delta_x,height+=delta_y);break;case BOTTOM:height+=delta_y;break;case LEFT_BOTTOM:event.shiftKey?-delta_x>delta_y?(left+=delta_x,width-=delta_x,height-=delta_x*(old_height/old_width)):(left-=delta_y*(old_width/old_height),width+=delta_y*(old_width/old_height),height+=delta_y):(left+=delta_x,width-=delta_x,height+=delta_y);break;case LEFT:left+=delta_x,width-=delta_x}if(component.mutateBounds(function(bounds){return Math.abs(width)<=.001&&(left=old_left,width=old_width),Math.abs(height)<=.001&&(top=old_top,height=old_height),{left:left,top:top,width:width,height:height}}),0>old_width*width)switch(index){case LEFT:index=RIGHT;break;case RIGHT:index=LEFT;break;case LEFT_TOP:index=RIGHT_TOP;break;case RIGHT_TOP:index=LEFT_TOP;break;case LEFT_BOTTOM:index=RIGHT_BOTTOM;break;case RIGHT_BOTTOM:index=LEFT_BOTTOM}if(0>old_height*height)switch(index){case LEFT_TOP:index=LEFT_BOTTOM;break;case RIGHT_TOP:index=RIGHT_BOTTOM;break;case LEFT_BOTTOM:index=LEFT_TOP;break;case RIGHT_BOTTOM:index=RIGHT_TOP;break;case TOP:index=BOTTOM;break;case BOTTOM:index=TOP}return component.parent&&component.parent.calculateBounds&&component.parent.calculateBounds(),index}function getResizeHandles(bounds){var left=bounds.left,top=bounds.top,width=bounds.width,height=bounds.height,centerx=left+width/2,centery=top+height/2,right=left+width,bottom=top+height;return[{x:left,y:top},{x:centerx,y:top},{x:right,y:top},{x:right,y:centery},{x:right,y:bottom},{x:centerx,y:bottom},{x:left,y:bottom},{x:left,y:centery}]}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_commandBounds=require("../../command/command-bounds"),_commandBounds2=_interopRequireDefault(_commandBounds),LEFT_TOP=0,TOP=1,RIGHT_TOP=2,RIGHT=3,RIGHT_BOTTOM=4,BOTTOM=5,LEFT_BOTTOM=6,LEFT=7,Resizer=function(){function Resizer(layer){_classCallCheck(this,Resizer),this.layer=layer}return _createClass(Resizer,[{key:"reset",value:function(){this.active=null}},{key:"contains",value:function(x,y,component,scale){var _this=this;return component.resizable?(getResizeHandles(component.bounds).every(function(handle,index){return Math.abs(x-handle.x)<=5/scale.x&&Math.abs(y-handle.y)<=5/scale.y&&(_this.active={component:component,index:index}),!_this.active}),!!this.active):!1}},{key:"draw",value:function(ctx,component,scale){if(component.resizable){var bounds=component.bounds;ctx.beginPath(),ctx.rect(bounds.left,bounds.top,bounds.width,bounds.height),ctx.setLineDash([3/scale.x,4/scale.y]),ctx.strokeStyle="black",ctx.stroke(),ctx.setLineDash([]);var active=this.active;getResizeHandles(bounds).forEach(function(point,index){ctx.beginPath(),ctx.rect(point.x-5/scale.x,point.y-5/scale.y,12/scale.x,12/scale.y),ctx.setLineDash([0,0]),ctx.strokeStyle="#656565",ctx.stroke(),ctx.fillStyle="#fff",active&&active.component===component&&active.index===index&&(ctx.strokeStyle="#fa7703",active.focus&&(ctx.fillStyle="#ffb80c")),ctx.fill(),ctx.stroke()})}}},{key:"onmousedown",value:function(e){this.active.focus=!0}},{key:"ondragstart",value:function(e){this.active.start_bounds=this.active.component.bounds}},{key:"ondragmove",value:function(e){var _active=this.active,component=_active.component,index=_active.index,point=this.layer.transcoordC2S(e.offsetX,e.offsetY);this.active.index=resizeHandler(component,index,point,e)}},{key:"ondragend",value:function(e){var _active2=this.active,component=_active2.component,start_bounds=_active2.start_bounds,command=new _commandBounds2["default"]({changes:[{component:component,before:start_bounds,after:component.bounds}]});component.app.commander.execute(command,!1)}},{key:"selected",get:function(){return this.layer.selected;
}}]),Resizer}();exports["default"]=Resizer},{"../../command/command-bounds":9}],73:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getRotateHandle(component,scale){if(component.resizable){var bounds=component.bounds;if(component.centerRotatable)return{x:bounds.left+bounds.width/2,y:bounds.top-30/scale.y};var rp=component.rotatePoint;return{x:rp.x,y:rp.y-30/scale.y}}var center=component.center;return{x:center.x,y:center.y-30/scale.y}}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../../components/component"),_commandChange=(_interopRequireDefault(_component),require("../../command/command-change")),_commandChange2=_interopRequireDefault(_commandChange),Rotator=function(){function Rotator(layer){_classCallCheck(this,Rotator),this.layer=layer}return _createClass(Rotator,[{key:"reset",value:function(){this.active=null}},{key:"contains",value:function(x,y,component,scale){if(!component.rotatable)return!1;var handle=getRotateHandle(component,scale);return Math.abs(x-handle.x)<=5/scale.x&&Math.abs(y-handle.y)<=5/scale.y?(this.active={component:component},!0):!1}},{key:"draw",value:function(context,component,scale){if(component.rotatable){context.beginPath();var rh=getRotateHandle(component,scale);context.lineWidth=1.5/scale.x,context.moveTo(rh.x,rh.y+30/scale.y),context.lineTo(rh.x,rh.y),context.strokeStyle="#656565",context.stroke(),context.beginPath(),context.ellipse(rh.x,rh.y,6/scale.x,6/scale.y,0,0,2*Math.PI,!0),context.stroke(),context.fillStyle="#fff",context.fill();var active=this.active;active&&active.component===component&&(context.strokeStyle="#fa7703",context.stroke(),active.toFill&&(context.fillStyle="#ffb80c",context.fill()))}}},{key:"onmousedown",value:function(e){this.active.toFill=!0}},{key:"ondragstart",value:function(e){var active=this.active;active.start_rotation=active.component.get("rotation")}},{key:"ondragmove",value:function(e){var component=this.active.component,point=component.transcoordC2S(e.offsetX,e.offsetY);point=component.transcoordS2P(point.x,point.y),e.shiftKey?component.rotateTo(point,.261799):component.rotateTo(point)}},{key:"ondragend",value:function(e){var _active=this.active,component=_active.component,start_rotation=_active.start_rotation,command=new _commandChange2["default"]({changes:[{component:component,before:{rotation:start_rotation},after:{rotation:component.get("rotation")}}]});component.app.commander.execute(command,!1)}},{key:"selected",get:function(){return this.layer.selected}}]),Rotator}();exports["default"]=Rotator},{"../../command/command-change":10,"../../components/component":16}],74:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../components/component"),_component2=_interopRequireDefault(_component),_group=require("../components/group"),_layer=(_interopRequireDefault(_group),require("./layer")),_layer2=_interopRequireDefault(_layer),_modeler=require("./modeler"),Modeler=_interopRequireWildcard(_modeler),ModelingLayer=function(_Layer){function ModelingLayer(model,context){_classCallCheck(this,ModelingLayer);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(ModelingLayer).call(this,model,context));return _this.modelers=[new Modeler.ControlHandler(_this),new Modeler.PathHandler(_this),new Modeler.Resizer(_this),new Modeler.Rotator(_this)],_this.reversedModelers=_this.modelers.slice().reverse(),_this}return _inherits(ModelingLayer,_Layer),_createClass(ModelingLayer,[{key:"added",value:function(parent){var model_base=this.root.model_layer,translate=model_base.get("translate"),scale=model_base.get("scale");this.set("translate",translate),this.set("scale",scale)}},{key:"contains",value:function(x,y){this.modelers.forEach(function(modeler){return modeler.reset()});for(var components=this.selected,scale=this.get("scale")||{x:1,y:1},i=0;i<components.length;i++)for(var component=components[i],point=component.transcoordT2S(x,y),j=0;j<this.modelers.length;j++){var modeler=this.modelers[j];if(modeler.contains(point.x,point.y,component,scale))return this.currentModeler=modeler,!0}return!1}},{key:"_drawModellers",value:function(ctx,component,scale){for(var ancester=[],parent=component.parent;parent&&"model-layer"!==parent.get("type");)ancester.push(parent),parent=parent.parent;ctx.save(),ancester.reverse().forEach(function(parent){var rotatePoint=parent.rotatePoint;ctx.translate(rotatePoint.x,rotatePoint.y);var parent_scale=parent.get("scale");parent_scale&&ctx.scale(parent_scale.x,parent_scale.y),ctx.rotate(parent.get("rotation")),ctx.translate(-rotatePoint.x,-rotatePoint.y);var bounds=parent.bounds;ctx.translate(bounds.left,bounds.top)});var rotatePoint=component.rotatePoint;ctx.translate(rotatePoint.x,rotatePoint.y);var component_scale=component.get("scale");component_scale&&ctx.scale(component_scale.x,component_scale.y),ctx.rotate(component.get("rotation")),ctx.translate(-rotatePoint.x,-rotatePoint.y),this.reversedModelers.forEach(function(modeler){return modeler.draw(ctx,component,scale)}),ctx.restore()}},{key:"_draw",value:function(ctx){var _this2=this;if(ctx.beginPath(),0!=this.selected.length){var scale=this.get("scale")||{x:1,y:1};this.selected.forEach(function(component){_this2._drawModellers(ctx,component,scale)})}}},{key:"onselected",value:function(before,after){this.invalidate()}},{key:"onchange_model",value:function(before,after,hint){var origin=hint.origin,deliverer=hint.deliverer;origin===deliverer&&(after.translate&&this.set("translate",after.translate),void 0!==after.rotation&&this.set("rotation",after.rotation),after.scale&&this.set("scale",after.scale)),this.invalidate()}},{key:"onmousedown",value:function(e){this.currentModeler.onmousedown(e),this.invalidate()}},{key:"onmouseup",value:function(e){"function"==typeof this.currentModeler.onmouseup&&this.currentModeler.onmouseup(e),this.invalidate()}},{key:"onmouseenter",value:function(e,hint){this.invalidate()}},{key:"onmouseleave",value:function(e,hint){this.invalidate()}},{key:"ondragstart",value:function(e){this.currentModeler.ondragstart(e)}},{key:"ondragmove",value:function(e){this.currentModeler.ondragmove(e),this.invalidate()}},{key:"ondragend",value:function(e){this.currentModeler.ondragend(e),this.invalidate()}},{key:"eventMap",get:function(){return{"(self)":{"(all)":{mousedown:this.onmousedown,mouseup:this.onmouseup,mouseenter:this.onmouseenter,mouseleave:this.onmouseleave,dragstart:this.ondragstart,dragmove:this.ondragmove,dragend:this.ondragend}},"model-layer":{"(all)":{change:this.onchange_model}},"(root)":{"(self)":{selected:this.onselected}}}}}]),ModelingLayer}(_layer2["default"]);exports["default"]=ModelingLayer,_component2["default"].register("modeling-layer",ModelingLayer)},{"../components/component":16,"../components/group":27,"./layer":66,"./modeler":70}],75:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function calcOffsetInTouchEvent(e){var touch=e.touches[0];return{offsetX:touch.pageX-touch.target.offsetLeft,offsetY:touch.pageY-touch.target.offsetTop}}function isComponentContainedInBounds(component,bounds){var sx=bounds.sx,sy=bounds.sy,ex=bounds.ex,ey=bounds.ey,path=component.path;if(!path)return console.log("ALERT","컴포넌트에 get path가 잘못 구현되어있음.",component),!1;var left,right,top,bottom;sx>ex?(left=ex,right=sx):(left=sx,right=ex),sy>ey?(top=ey,bottom=sy):(top=sy,bottom=ey);for(var i=0;i<path.length;i++){var p=component.transcoordS2T(path[i].x,path[i].y);if(left>p.x||right<p.x||top>p.y||bottom<p.y)return!1}return!0}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../components/component"),_component2=_interopRequireDefault(_component),_group=require("../components/group"),_group2=_interopRequireDefault(_group),_layer=require("./layer"),_layer2=_interopRequireDefault(_layer),SelectionLayer=function(_Layer){function SelectionLayer(){return _classCallCheck(this,SelectionLayer),_possibleConstructorReturn(this,Object.getPrototypeOf(SelectionLayer).apply(this,arguments))}return _inherits(SelectionLayer,_Layer),_createClass(SelectionLayer,[{key:"added",value:function(parent){var model_base=this.root.model_layer,translate=model_base.get("translate"),scale=model_base.get("scale");this.set("translate",translate),this.set("scale",scale)}},{key:"contains",value:function(x,y){return!1}},{key:"_draw",value:function(ctx){var selbox=this.selbox;if(selbox){var sx=selbox.sx,sy=selbox.sy,ex=selbox.ex,ey=selbox.ey,scale=this.get("scale")||{x:1,y:1};ctx.beginPath(),ctx.rect(sx,sy,ex-sx,ey-sy),ctx.setLineDash([2/scale.x,4/scale.y]),ctx.lineWidth=1/scale.x,ctx.strokeStyle="black",ctx.stroke()}}},{key:"onchange_model_base",value:function(before,after,hint){after.translate&&this.set("translate",after.translate),after.scale&&this.set("scale",after.scale)}},{key:"_pendingDecision",value:function(e){this.downpoint={x:e.offsetX,y:e.offsetY}}},{key:"_selectGroupItem",value:function(origin,e){for(var idx=this.selected.indexOf(origin),parentOfOrigin=origin.parent;parentOfOrigin.parent instanceof _group2["default"];)parentOfOrigin=parentOfOrigin.parent;var selected=[],foundSibling=!1,foundGroup=!1;if(this.selected.forEach(function(item){var parent=item.parent;if(item===parentOfOrigin)return void(foundGroup=!0);for(;parent.parent instanceof _group2["default"];)parent=parent.parent;parent===parentOfOrigin&&(selected.push(item),foundSibling=!0)}),foundSibling)if(e.shiftKey){if(-1!=idx)return void this._pendingDecision(e);selected.push(origin)}else{if(-1!=idx)return void this._pendingDecision(e);selected=[origin]}else if(foundGroup)return void this._pendingDecision(e);selected.push(parentOfOrigin),this.selected=selected}},{key:"onmousedown_comp",value:function(e,hint){var _this2=this,origin=hint.origin;if(this.downpoint=null,origin.parent instanceof _group2["default"])return void this._selectGroupItem(origin,e);var idx=this.selected.indexOf(origin);if(e.shiftKey){if(-1!=idx)return void this._pendingDecision(e);!function(){var parentOfOrigin=origin.parent,selected=[];_this2.selected.forEach(function(item){var parent=item.parent;parent===parentOfOrigin&&selected.push(item)}),selected.push(origin),_this2.selected=selected}()}else{if(-1!=idx)return;this.selected=[origin]}}},{key:"onmouseup_comp",value:function(e,hint){if(this.downpoint&&this.downpoint.x===e.offsetX&&this.downpoint.y===e.offsetY){var origin=hint.origin,idx=this.selected.indexOf(origin);if(-1!==idx&&e.shiftKey){var selected=this.selected.slice();return idx>-1&&selected.splice(idx,1),void(this.selected=selected)}if(origin.parent instanceof _group2["default"]){var _selected=void 0;if(e.shiftKey)_selected=this.selected.slice(),_selected.push(origin);else{for(var rootGroup=origin.parent;rootGroup.parent instanceof _group2["default"];)rootGroup=rootGroup.parent;_selected=[origin,rootGroup]}return void(this.selected=_selected)}}}},{key:"_gather_selected_in_selbox",value:function(modellayer,x,y){var _this3=this;this.selbox&&!function(){_this3.selbox.ex=x,_this3.selbox.ey=y;var selected=[];modellayer.components.forEach(function(component){isComponentContainedInBounds(component,_this3.selbox)&&selected.push(component)});var old=_this3.selected;if(old.length!==selected.length)_this3.selected=selected;else for(var i=0;i<selected.length;i++)if(old[i]!=selected[i]){_this3.selected=selected;break}}()}},{key:"onmousedown_selbox",value:function(e,hint){0!=this.selected.length&&(this.selected=[])}},{key:"ondragstart_selbox",value:function(e,hint){var _transcoordC2S=this.transcoordC2S(e.offsetX,e.offsetY),x=_transcoordC2S.x,y=_transcoordC2S.y;this.selbox={sx:x,sy:y}}},{key:"ondragmove_selbox",value:function(e,hint){var _transcoordC2S2=this.transcoordC2S(e.offsetX,e.offsetY),x=_transcoordC2S2.x,y=_transcoordC2S2.y,deliverer=hint.deliverer;this._gather_selected_in_selbox(deliverer,x,y),this.invalidate()}},{key:"ondragend_selbox",value:function(e,hint){this.last_pos=null,this.selbox=null,this.invalidate()}},{key:"ontouchstart_selbox",value:function(e,hint){var _calcOffsetInTouchEve=calcOffsetInTouchEvent(e),_transcoordC2S3=(_calcOffsetInTouchEve.offsetX,_calcOffsetInTouchEve.offsetY,this.transcoordC2S(e.offsetX,e.offsetY)),x=_transcoordC2S3.x,y=_transcoordC2S3.y;this.selbox={sx:x,sy:y}}},{key:"ontouchmove_selbox",value:function(e,hint){var _calcOffsetInTouchEve2=calcOffsetInTouchEvent(e),_transcoordC2S4=(_calcOffsetInTouchEve2.offsetX,_calcOffsetInTouchEve2.offsetY,this.transcoordC2S(e.offsetX,e.offsetY)),x=_transcoordC2S4.x,y=_transcoordC2S4.y,deliverer=hint.deliverer;this._gather_selected_in_selbox(deliverer,x,y),this.invalidate()}},{key:"ontouchend_selbox",value:function(e,hint){this.selbox=null,this.invalidate()}},{key:"eventMap",get:function(){return{"model-layer":{"(self)":{mousedown:this.onmousedown_selbox,dragstart:this.ondragstart_selbox,dragmove:this.ondragmove_selbox,dragend:this.ondragend_selbox,touchstart:this.ontouchstart_selbox,touchmove:this.ontouchmove_selbox,touchend:this.ontouchend_selbox,change:this.onchange_model_base},"(child)":{mousedown:this.onmousedown_comp,mouseup:this.onmouseup_comp}}}}}]),SelectionLayer}(_layer2["default"]);exports["default"]=SelectionLayer,_component2["default"].register("selection-layer",SelectionLayer)},{"../components/component":16,"../components/group":27,"./layer":66}],76:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../components/component"),_component2=_interopRequireDefault(_component),_layer=require("./layer"),_layer2=_interopRequireDefault(_layer),_const=require("../const"),Const=_interopRequireWildcard(_const),ShiftLayer=function(_Layer){function ShiftLayer(){return _classCallCheck(this,ShiftLayer),_possibleConstructorReturn(this,Object.getPrototypeOf(ShiftLayer).apply(this,arguments))}return _inherits(ShiftLayer,_Layer),_createClass(ShiftLayer,[{key:"added",value:function(parent){var model_base=this.root.model_layer,translate=model_base.get("translate");this.set("translate",translate)}},{key:"_draw",value:function(ctx){}},{key:"contains",value:function(x,y){return!(this.app.mode!=Const.MODE_SHIFT)}},{key:"onkeydown",value:function(e){32==e.keyCode&&void 0===this.before_mode&&(this.before_mode=this.app.mode,this.app.mode=Const.MODE_SHIFT)}},{key:"onkeyup",value:function(e){32==e.keyCode&&(void 0!=this.before_mode&&(this.app.mode=this.before_mode),delete this.before_mode)}},{key:"ondragstart",value:function(e){this.last_position=this.transcoordC2S(e.offsetX,e.offsetY)}},{key:"ondragmove",value:function(e){var model_base=this.root.model_layer,_transcoordC2S=this.transcoordC2S(e.offsetX,e.offsetY),x=_transcoordC2S.x,y=_transcoordC2S.y;model_base.move({x:x-this.last_position.x,y:y-this.last_position.y}),this.last_position=this.transcoordC2S(e.offsetX,e.offsetY)}},{key:"eventMap",get:function(){return{"(root)":{"(self)":{keydown:this.onkeydown,keyup:this.onkeyup}},"(self)":{"(self)":{dragstart:this.ondragstart,dragmove:this.ondragmove}}}}}]),ShiftLayer}(_layer2["default"]);exports["default"]=ShiftLayer,_component2["default"].register("shift-layer",ShiftLayer)},{"../components/component":16,"../const":43,"./layer":66}],77:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../components/component"),_component2=_interopRequireDefault(_component),_link=require("./link"),_link2=_interopRequireDefault(_link),ArrowStraight=function(_Link){function ArrowStraight(){return _classCallCheck(this,ArrowStraight),_possibleConstructorReturn(this,Object.getPrototypeOf(ArrowStraight).apply(this,arguments))}return _inherits(ArrowStraight,_Link),_createClass(ArrowStraight,[{key:"draw",value:function(ctx){var _model=this.model,_model$fillStyle=_model.fillStyle,fillStyle=void 0===_model$fillStyle?"black":_model$fillStyle,_model$lineWidth=_model.lineWidth,lineWidth=void 0===_model$lineWidth?5:_model$lineWidth,_model$strokeStyle=_model.strokeStyle,strokeStyle=void 0===_model$strokeStyle?"#000000":_model$strokeStyle,_model$lineCap=_model.lineCap,lineCap=void 0===_model$lineCap?"round":_model$lineCap,_model$arrowWidth=_model.arrowWidth,arrowWidth=void 0===_model$arrowWidth?20:_model$arrowWidth,rotation=_model.rotation,center=this.center;ctx.translate(center.x,center.y),ctx.rotate(rotation),ctx.translate(-center.x,-center.y),ctx.beginPath();var from=this.fromComponent.center,to=this.toComponent.center;ctx.moveTo(from.x,from.y),ctx.lineTo(to.x,to.y),ctx.lineCap=lineCap,ctx.lineWidth=lineWidth,ctx.strokeStyle=strokeStyle,ctx.stroke(),ctx.save(),ctx.translate(to.x,to.y);var ang=(from.x-to.x)/(from.y-to.y);ang=Math.atan(ang),to.y-from.y>=0?ctx.rotate(-ang):ctx.rotate(Math.PI-ang),ctx.lineTo(-arrowWidth,2*-arrowWidth),ctx.lineTo(arrowWidth,2*-arrowWidth),ctx.lineTo(0,0),ctx.fillStyle=fillStyle,ctx.fill(),ctx.restore(),ctx.closePath()}}]),ArrowStraight}(_link2["default"]);exports["default"]=ArrowStraight,_component2["default"].register("arrow_straight",ArrowStraight)},{"../components/component":16,"./link":80}],78:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../components/component"),_component2=_interopRequireDefault(_component),_link=require("./link"),_link2=_interopRequireDefault(_link),Curve=function(_Link){function Curve(){return _classCallCheck(this,Curve),_possibleConstructorReturn(this,Object.getPrototypeOf(Curve).apply(this,arguments))}return _inherits(Curve,_Link),_createClass(Curve,[{key:"draw",value:function(ctx){var _model=this.model,cX=_model.cX,cY=_model.cY,lineCap=_model.lineCap,_model$lineWidth=_model.lineWidth,lineWidth=void 0===_model$lineWidth?5:_model$lineWidth,_model$strokeStyle=_model.strokeStyle,strokeStyle=void 0===_model$strokeStyle?"#000000":_model$strokeStyle,from=this.fromComponent.center,to=this.toComponent.center;ctx.beginPath(),ctx.moveTo(from.x,from.y),ctx.quadraticCurveTo(cX,cY,to.x,to.y),ctx.lineCap=lineCap,ctx.lineWidth=lineWidth,ctx.strokeStyle=strokeStyle,ctx.stroke()}}]),Curve}(_link2["default"]);exports["default"]=Curve,_component2["default"].register("curve",Curve)},{"../components/component":16,"./link":80}],79:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _link=require("./link");Object.defineProperty(exports,"Link",{enumerable:!0,get:function(){return _interopRequireDefault(_link)["default"]}});var _straight=require("./straight");Object.defineProperty(exports,"Straight",{enumerable:!0,get:function(){return _interopRequireDefault(_straight)["default"]}});var _right_angle_straight=require("./right_angle_straight");Object.defineProperty(exports,"RightAngleStraight",{enumerable:!0,get:function(){return _interopRequireDefault(_right_angle_straight)["default"]}});var _curve=require("./curve");Object.defineProperty(exports,"Curve",{enumerable:!0,get:function(){return _interopRequireDefault(_curve)["default"]}});var _arrow_straight=require("./arrow_straight");Object.defineProperty(exports,"ArrowStraight",{enumerable:!0,get:function(){return _interopRequireDefault(_arrow_straight)["default"]}})},{"./arrow_straight":77,"./curve":78,"./link":80,"./right_angle_straight":81,"./straight":82}],80:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../components/component"),_component2=_interopRequireDefault(_component),Link=function(_Component){function Link(){return _classCallCheck(this,Link),_possibleConstructorReturn(this,Object.getPrototypeOf(Link).apply(this,arguments))}return _inherits(Link,_Component),_createClass(Link,[{key:"draw",value:function(ctx){var _model=this.model,_model$lineWidth=(_model.fillStyle,_model.lineWidth),lineWidth=void 0===_model$lineWidth?5:_model$lineWidth,_model$strokeStyle=_model.strokeStyle,strokeStyle=void 0===_model$strokeStyle?"#000000":_model$strokeStyle,rotation=(_model.x1,_model.y1,_model.x2,_model.y2,_model.rotation),center=this.center;ctx.translate(center.x,center.y),ctx.rotate(rotation),ctx.translate(-center.x,-center.y),ctx.beginPath();var from=this.fromComponent.center,to=this.toComponent.center;ctx.moveTo(from.x,from.y),ctx.lineTo(to.x,to.y),ctx.lineWidth=lineWidth,ctx.strokeStyle=strokeStyle,ctx.stroke()}},{key:"contains",value:function(x,y){return!1}},{key:"fromComponent",get:function(){return this._fromComponent||(this._fromComponent=this.parent.findById(this.get("from"))),this._fromComponent}},{key:"toComponent",get:function(){return this._toComponent||(this._toComponent=this.parent.findById(this.get("to"))),this._toComponent}},{key:"resizable",get:function(){return!1}},{key:"mutable",get:function(){return!0}},{key:"rotatable",get:function(){return!1}},{key:"path",get:function(){var _model2=this.model,from=_model2.from,to=_model2.to;return[{x:from.x,y:from.y},{x:to.x,y:to.y}]},set:function(path){var from=path[0],to=path[1];this.set({from:{x:from.x,y:from.y},to:{x:to.x,y:to.y}})}}]),Link}(_component2["default"]);exports["default"]=Link,_component2["default"].register("link",Link)},{"../components/component":16}],81:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_component=require("../components/component"),_component2=_interopRequireDefault(_component),_link=require("./link"),_link2=_interopRequireDefault(_link),RightAngleStraight=function(_Link){
function RightAngleStraight(){return _classCallCheck(this,RightAngleStraight),_possibleConstructorReturn(this,Object.getPrototypeOf(RightAngleStraight).apply(this,arguments))}return _inherits(RightAngleStraight,_Link),_createClass(RightAngleStraight,[{key:"draw",value:function(ctx){var _model=this.model,_model$lineWidth=(_model.fillStyle,_model.lineWidth),lineWidth=void 0===_model$lineWidth?5:_model$lineWidth,_model$strokeStyle=_model.strokeStyle,strokeStyle=void 0===_model$strokeStyle?"#000000":_model$strokeStyle,anchor=(_model.rotation,_model.anchor),_model$lineDash=_model.lineDash,lineDash=void 0===_model$lineDash?[0,0]:_model$lineDash,lineCap=_model.lineCap,lineJoin=_model.lineJoin,subType=_model.subType;this.center;ctx.beginPath();var from=this.fromComponent.center,to=this.toComponent.center;switch(anchor||(anchor={},anchor.x=Math.min(from.x,to.x)+Math.abs((from.x-to.x)/2),anchor.y=Math.min(from.y,to.y)+Math.abs((from.y-to.y)/2)),subType){case"v":case"vertical":default:var _p={},_p2={};_p.x=from.x,_p.y=anchor.y,_p2.x=to.x,_p2.y=anchor.y;var points=[from,_p,_p2,to];ctx.moveTo(points[0].x,points[0].y);for(var i=0;i<points.length&&i!==points.length-1;i++)ctx.lineTo(points[i+1].x,points[i+1].y);break;case"h":case"horizontal":var p1={},p2={};p1.x=anchor.x,p1.y=from.y,p2.x=anchor.x,p2.y=to.y;var points=[from,p1,p2,to];ctx.moveTo(points[0].x,points[0].y);for(var _i=0;_i<points.length&&_i!==points.length-1;_i++)ctx.lineTo(points[_i+1].x,points[_i+1].y)}ctx.setLineDash(lineDash),ctx.lineCap=lineCap,ctx.lineJoin=lineJoin,ctx.lineWidth=lineWidth,ctx.strokeStyle=strokeStyle,ctx.stroke()}}]),RightAngleStraight}(_link2["default"]);exports["default"]=RightAngleStraight,_component2["default"].register("right_angle_straight",RightAngleStraight)},{"../components/component":16,"./link":80}],82:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _component=require("../components/component"),_component2=_interopRequireDefault(_component),_link=require("./link"),_link2=_interopRequireDefault(_link),Straight=function(_Link){function Straight(){return _classCallCheck(this,Straight),_possibleConstructorReturn(this,Object.getPrototypeOf(Straight).apply(this,arguments))}return _inherits(Straight,_Link),Straight}(_link2["default"]);exports["default"]=Straight,_component2["default"].register("straight",Straight)},{"../components/component":16,"./link":80}],83:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function compile(model,context){var clazz=components.Component.register(model.type);if(!clazz)return null;var component=new clazz(model,context);return model.components&&component instanceof components.Container&&(model.components.forEach(function(m){var child_component=compile(m,context);child_component&&component.addComponent(child_component)}),model.links&&model.links.forEach(function(m){var child_component=compile(m,context);child_component&&component.addLink(child_component)})),component}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=compile;var _components=require("../components"),components=_interopRequireWildcard(_components),_layer=require("../layer"),_link=(_interopRequireWildcard(_layer),require("../link"));_interopRequireWildcard(_link)},{"../components":29,"../layer":65,"../link":79}],84:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function duplicate(component){var model=_utils.deepClone(component.hierarchy);return"undefined"!=typeof model.id&&delete model.id,_compile2["default"](model,component.app)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=duplicate;var _compile=require("./compile"),_compile2=_interopRequireDefault(_compile),_utils=require("../core/utils")},{"../core/utils":52,"./compile":83}],85:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _compile=require("./compile");Object.defineProperty(exports,"compile",{enumerable:!0,get:function(){return _interopRequireDefault(_compile)["default"]}});var _duplicate=require("./duplicate");Object.defineProperty(exports,"duplicate",{enumerable:!0,get:function(){return _interopRequireDefault(_duplicate)["default"]}});var _selector=require("./selector");Object.defineProperty(exports,"select",{enumerable:!0,get:function(){return _selector.select}}),Object.defineProperty(exports,"match",{enumerable:!0,get:function(){return _selector.match}})},{"./compile":83,"./duplicate":84,"./selector":86}],86:[function(require,module,exports){"use strict";function match_by_id(selector,component,listener,root){return selector.substr(1)==component.get("id")}function match_by_class(selector,component,listener,root){var str_class=component.get("class");if(!str_class)return!1;var classes=str_class.split(" ")||[];return classes.indexOf(selector.substr(1))>=0}function match_by_special(selector,component,listener,root){switch(selector){case"(all)":return!0;case"(child)":return root!==component;case"(self)":return root===component;case"(root)":return!root.parent&&root===component;default:return!1}}function match_by_type(selector,component,listener,root){return selector==component.get("type")}function match(selector,component,listener,root){if("(all)"==selector)return!0;switch(selector.charAt(0)){case"#":return match_by_id(selector,component,listener,root);case".":return match_by_class(selector,component,listener,root);case"(":return match_by_special(selector,component,listener,root);default:return match_by_type(selector,component,listener,root)}}function select_recurse(matcher,selector,component,listener,root,result){return matcher(selector,component,listener,root)&&result.push(component),component.components&&component.components.forEach(function(child){select_recurse(matcher,selector,child,listener,root,result)}),result}function select(selector,component,listener){if("(root)"==selector)return[component];if("(self)"==selector)return[listener];var matcher;switch(selector.charAt(0)){case"#":matcher=match_by_id;break;case".":matcher=match_by_class;break;case"(":matcher=match_by_special;break;default:matcher=match_by_type}return select_recurse(matcher,selector,component,listener,component,[])}Object.defineProperty(exports,"__esModule",{value:!0}),exports.match=match,exports.select=select},{}],87:[function(require,module,exports){"use strict";function compile(style){return style}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=compile},{}],88:[function(require,module,exports){arguments[4][6][0].apply(exports,arguments)},{"./compile":87,dup:6}],89:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function add(models,boundsOrOffset,onto){models instanceof Array||(models=[models]),onto||(onto=this.model_layer);var changes=[];this.selected=models.map(function(model){var _boundsOrOffset$left=boundsOrOffset.left,left=void 0===_boundsOrOffset$left?-1:_boundsOrOffset$left,_boundsOrOffset$top=boundsOrOffset.top,top=void 0===_boundsOrOffset$top?-1:_boundsOrOffset$top,_boundsOrOffset$width=boundsOrOffset.width,width=void 0===_boundsOrOffset$width?-1:_boundsOrOffset$width,_boundsOrOffset$heigh=boundsOrOffset.height,height=void 0===_boundsOrOffset$heigh?-1:_boundsOrOffset$heigh,_boundsOrOffset$x=boundsOrOffset.x,x=void 0===_boundsOrOffset$x?-1:_boundsOrOffset$x,_boundsOrOffset$y=boundsOrOffset.y,y=void 0===_boundsOrOffset$y?-1:_boundsOrOffset$y,component=Model.compile(model);return-1!=left&&-1!=top&&-1!=width&&-1!=height&&(component.bounds={left:left,top:top,width:width,height:height}),(-1!=x||-1!=y)&&component.move({x:x,y:y}),changes.push({component:component,to_container:onto}),component}),this.app.commander.execute(new _commandMigrate2["default"]({changes:changes}))}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=add;var _model=require("../../model"),Model=_interopRequireWildcard(_model),_commandMigrate=require("../../command/command-migrate"),_commandMigrate2=_interopRequireDefault(_commandMigrate)},{"../../command/command-migrate":12,"../../model":85}],90:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _align(type,selected){for(var total_bounds=selected[0].bounds,right=total_bounds.left+total_bounds.width,bottom=total_bounds.top+total_bounds.height,i=0;i<selected.length;i++){var bounds=selected[i].bounds;total_bounds.left=bounds.left>total_bounds.left?total_bounds.left:bounds.left,total_bounds.top=bounds.top>total_bounds.top?total_bounds.top:bounds.top,right=bounds.left+bounds.width>right?bounds.left+bounds.width:right,bottom=bounds.top+bounds.height>bottom?bounds.top+bounds.height:bottom}switch(total_bounds.width=right-total_bounds.left,total_bounds.height=bottom-total_bounds.top,type){case LEFT:for(var _i=0;_i<selected.length;_i++){var _bounds=selected[_i].bounds;selected[_i].bounds={left:total_bounds.left,top:_bounds.top,width:_bounds.width,height:_bounds.height}}break;case CENTER:for(var _i2=0;_i2<selected.length;_i2++){var _bounds2=selected[_i2].bounds;selected[_i2].bounds={left:total_bounds.left+total_bounds.width/2-_bounds2.width/2,top:_bounds2.top,width:_bounds2.width,height:_bounds2.height}}break;case RIGHT:for(var _i3=0;_i3<selected.length;_i3++){var _bounds3=selected[_i3].bounds;selected[_i3].bounds={left:right-_bounds3.width,top:_bounds3.top,width:_bounds3.width,height:_bounds3.height}}break;case TOP:for(var _i4=0;_i4<selected.length;_i4++){var _bounds4=selected[_i4].bounds;selected[_i4].bounds={left:_bounds4.left,top:total_bounds.top,width:_bounds4.width,height:_bounds4.height}}break;case MIDDLE:for(var _i5=0;_i5<selected.length;_i5++){var _bounds5=selected[_i5].bounds;selected[_i5].bounds={left:_bounds5.left,top:total_bounds.top+total_bounds.height/2-_bounds5.height/2,width:_bounds5.width,height:_bounds5.height}}break;case BOTTOM:for(var _i6=0;_i6<selected.length;_i6++){var _bounds6=selected[_i6].bounds;selected[_i6].bounds={left:_bounds6.left,top:bottom-_bounds6.height,width:_bounds6.width,height:_bounds6.height}}break;default:return}}function align(type){if(-1!=ALIGN_COMMANDS.indexOf(type)){var selected=this.selected;if(!(selected.length<=1)){var commander=this.app.commander;_commandChange2["default"].around(selected,commander,function(){_align(type,selected)})}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=align;var _commandChange=require("../../command/command-change"),_commandChange2=_interopRequireDefault(_commandChange),LEFT="left",RIGHT="right",CENTER="center",TOP="top",BOTTOM="bottom",MIDDLE="middle",ALIGN_COMMANDS=[LEFT,RIGHT,CENTER,TOP,MIDDLE,BOTTOM]},{"../../command/command-change":10}],91:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function change(selector,value){var components=this.findAll(selector,this);return components.forEach(function(component){component.set(value)}),components}function undoableChange(changeFunc){var selected=this.selected;0==selected.length&&(selected=[this.model_layer]),this.__blocked_undoable__?changeFunc.call(this):_commandChange2["default"].around(selected,this.app.commander,changeFunc)}function undoableChangeBefore(){var selected=this.selected;return 0==selected.length&&(selected=[this.model_layer]),this.__blocked_undoable__=!0,_commandChange2["default"].before(selected)}function undoableChangeAfter(changes){_commandChange2["default"].after(changes,this.app.commander),this.__blocked_undoable__=!1}function undoableChangeReset(){this.__blocked_undoable__=!1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.change=change,exports.undoableChange=undoableChange,exports.undoableChangeBefore=undoableChangeBefore,exports.undoableChangeAfter=undoableChangeAfter,exports.undoableChangeReset=undoableChangeReset;var _commandChange=require("../../command/command-change"),_commandChange2=_interopRequireDefault(_commandChange)},{"../../command/command-change":10}],92:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function copy(){var selected=this.selected;0!==selected.length&&(count=0,_clipboard2["default"].put(selected.map(function(component){return component.model})))}function cut(){count=0,copy.call(this),_remove2["default"].call(this)}function paste(){var cliped=_clipboard2["default"].get();cliped&&(count++,_add2["default"].call(this,cliped,{x:15*count,y:15*count}))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.copy=copy,exports.cut=cut,exports.paste=paste;var _clipboard=require("../clipboard"),_clipboard2=_interopRequireDefault(_clipboard),_remove=require("./remove"),_remove2=_interopRequireDefault(_remove),_add=require("./add"),_add2=_interopRequireDefault(_add),count=0},{"../clipboard":103,"./add":89,"./remove":98}],93:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function duplicate(){var changes=[],oldSelected=this.selected;this.selected=oldSelected.map(function(component){var clone=Model.duplicate(component);return clone.move({x:20,y:20}),changes.push({component:clone,to_container:component.parent}),clone});var command=new _commandMigrate2["default"]({changes:changes});this.app.commander.execute(command)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=duplicate;var _model=require("../../model"),Model=_interopRequireWildcard(_model),_commandMigrate=require("../../command/command-migrate"),_commandMigrate2=_interopRequireDefault(_commandMigrate)},{"../../command/command-migrate":12,"../../model":85}],94:[function(require,module,exports){"use strict";function fullscreen(target_element){var target_element=this.target_element;target_element.requestFullScreen?target_element.requestFullScreen():target_element.webkitRequestFullScreen?target_element.webkitRequestFullScreen():target_element.mozRequestFullScreen&&target_element.mozRequestFullScreen()}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=fullscreen},{}],95:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function group(){var selected=this.selected;if(!(selected.length<2)){for(var onto,boundsList=[],i=0;i<selected.length;i++){var component=selected[i];if(onto){if(onto!==component.parent)return;boundsList.push(component.bounds)}else onto=component.parent,boundsList.push(component.bounds)}var bounds=_component2["default"].union(boundsList),group_component=Model.compile({type:"group",left:bounds.left,top:bounds.top,width:bounds.width,height:bounds.height}),changes=[{component:group_component,to_container:onto}];this.selected.forEach(function(component){changes.push({component:component,to_container:group_component})}),this.app.commander.execute(new _commandMigrate2["default"]({changes:changes})),this.selected=[group_component]}}function ungroup(){var selected=this.selected;if(0!==selected.length){var components=[],changes=[];this.selected.forEach(function(group){if("group"==group.model.type){var parent=group.parent;group.components.forEach(function(component){components.push(component),changes.push({component:component,to_container:parent})}),changes.push({component:group,to_container:null})}}),this.app.commander.execute(new _commandMigrate2["default"]({changes:changes})),this.selected=components}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.group=group,exports.ungroup=ungroup;var _component=require("../../components/component"),_component2=_interopRequireDefault(_component),_model=require("../../model"),Model=_interopRequireWildcard(_model),_commandMigrate=require("../../command/command-migrate"),_commandMigrate2=_interopRequireDefault(_commandMigrate)},{"../../command/command-migrate":12,"../../components/component":16,"../../model":85}],96:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _align=require("./align");Object.defineProperty(exports,"align",{enumerable:!0,get:function(){return _interopRequireDefault(_align)["default"]}});var _zorder=require("./zorder");Object.defineProperty(exports,"zorder",{enumerable:!0,get:function(){return _interopRequireDefault(_zorder)["default"]}});var _add=require("./add");Object.defineProperty(exports,"add",{enumerable:!0,get:function(){return _interopRequireDefault(_add)["default"]}});var _duplicate=require("./duplicate");Object.defineProperty(exports,"duplicate",{enumerable:!0,get:function(){return _interopRequireDefault(_duplicate)["default"]}});var _remove=require("./remove");Object.defineProperty(exports,"remove",{enumerable:!0,get:function(){return _interopRequireDefault(_remove)["default"]}});var _listener=require("./listener");Object.defineProperty(exports,"on",{enumerable:!0,get:function(){return _listener.on}}),Object.defineProperty(exports,"once",{enumerable:!0,get:function(){return _listener.once}}),Object.defineProperty(exports,"off",{enumerable:!0,get:function(){return _listener.off}});var _fullscreen=require("./fullscreen");Object.defineProperty(exports,"fullscreen",{enumerable:!0,get:function(){return _interopRequireDefault(_fullscreen)["default"]}});var _clipboard=require("./clipboard");Object.defineProperty(exports,"cut",{enumerable:!0,get:function(){return _clipboard.cut}}),Object.defineProperty(exports,"copy",{enumerable:!0,get:function(){return _clipboard.copy}}),Object.defineProperty(exports,"paste",{enumerable:!0,get:function(){return _clipboard.paste}});var _toDataUrl=require("./to-data-url");Object.defineProperty(exports,"toDataURL",{enumerable:!0,get:function(){return _interopRequireDefault(_toDataUrl)["default"]}});var _group=require("./group");Object.defineProperty(exports,"group",{enumerable:!0,get:function(){return _group.group}}),Object.defineProperty(exports,"ungroup",{enumerable:!0,get:function(){return _group.ungroup}});var _symmetry=require("./symmetry");Object.defineProperty(exports,"symmetryX",{enumerable:!0,get:function(){return _symmetry.symmetryX}}),Object.defineProperty(exports,"symmetryY",{enumerable:!0,get:function(){return _symmetry.symmetryY}});var _change=require("./change");Object.defineProperty(exports,"change",{enumerable:!0,get:function(){return _change.change}}),Object.defineProperty(exports,"undoableChange",{enumerable:!0,get:function(){return _change.undoableChange}}),Object.defineProperty(exports,"undoableChangeBefore",{enumerable:!0,get:function(){return _change.undoableChangeBefore}}),Object.defineProperty(exports,"undoableChangeAfter",{enumerable:!0,get:function(){return _change.undoableChangeAfter}}),Object.defineProperty(exports,"undoableChangeReset",{enumerable:!0,get:function(){return _change.undoableChangeReset}})},{"./add":89,"./align":90,"./change":91,"./clipboard":92,"./duplicate":93,"./fullscreen":94,"./group":95,"./listener":97,"./remove":98,"./symmetry":99,"./to-data-url":100,"./zorder":101}],97:[function(require,module,exports){"use strict";function on(event,listener,context){switch(event){case"execute":case"redo":case"undo":case"command-reset":this.app.commander.on(event,listener,context);break;case"selected":this.on(event,listener,context);break;case"mode":this.app.on(event,listener,context)}}function once(event,listener,context){switch(event){case"execute":case"redo":case"undo":case"command-reset":this.app.commander.once(event,listener,context);break;case selected:this.once(event,listener,context);break;case"mode":this.app.once(event,listener,context)}}function off(event,listener,context){switch(event){case"execute":case"redo":case"undo":case"command-reset":this.app.commander.off(event,listener,context);break;case"selected":this.off(event,listener,context);break;case"mode":this.app.off(event,listener,context)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.on=on,exports.once=once,exports.off=off},{}],98:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function remove(){var changes=[],oldSelected=this.selected;this.selected=[],oldSelected.forEach(function(component){changes.push({component:component,to_container:null})}),this.app.commander.execute(new _commandMigrate2["default"]({changes:changes}))}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=remove;var _commandMigrate=require("../../command/command-migrate"),_commandMigrate2=_interopRequireDefault(_commandMigrate)},{"../../command/command-migrate":12}],99:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _symmetryX(){var selected=this.selected;if(0!=selected.length){var boundsList=selected.map(function(component){return component.bounds}),bounds=_component2["default"].union(boundsList),x=bounds.left+bounds.width/2;selected.map(function(component){component.symmetryX(x)})}}function _symmetryY(){var selected=this.selected;if(0!=selected.length){var boundsList=selected.map(function(component){return component.bounds}),bounds=_component2["default"].union(boundsList),y=bounds.top+bounds.height/2;selected.map(function(component){component.symmetryY(y)})}}function symmetryX(){_commandChange2["default"].around(this.selected,this.app.commander,_symmetryX,this)}function symmetryY(){_commandChange2["default"].around(this.selected,this.app.commander,_symmetryY,this)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.symmetryX=symmetryX,exports.symmetryY=symmetryY;var _component=require("../../components/component"),_component2=_interopRequireDefault(_component),_commandChange=require("../../command/command-change"),_commandChange2=_interopRequireDefault(_commandChange)},{"../../command/command-change":10,"../../components/component":16}],100:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function toDataURL(type,encoderOptions){if(this.model_layer){var canvas=document.createElement("canvas");canvas.width=this.model_layer.get("width")||800,canvas.height=this.model_layer.get("height")||600;var translate=this.model_layer.get("translate"),scale=this.model_layer.get("scale");this.model_layer.set("translate",{x:0,y:0}),this.model_layer.set("scale",{x:1,y:1}),this.model_layer.draw(canvas.getContext("2d"));var dataUrl=canvas.toDataURL(type,encoderOptions);return this.model_layer.set("translate",translate),this.model_layer.set("scale",scale),canvas.remove(),dataUrl}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=toDataURL;var _model=require("../../model");_interopRequireWildcard(_model)},{"../../model":85}],101:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function zorder(type){var selected=this.selected;if(!(0==selected.length||selected.length>1)){var component=selected[0],parent=component.parent,index=parent.indexOf(component),changes=[];switch(type){case"forward":changes.push({component:component,from_container:parent,to_container:parent,from_index:index,to_index:index+1});break;case"backward":changes.push({component:component,from_container:parent,to_container:parent,from_index:index,to_index:index-1});break;case"front":changes.push({component:component,from_container:parent,to_container:parent,from_index:index,to_index:parent.components.length});break;case"back":changes.push({component:component,from_container:parent,to_container:parent,from_index:index,to_index:0});break;default:return}var command=new _commandMigrate2["default"]({changes:changes});this.app.commander.execute(command)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=zorder;var _commandMigrate=require("../../command/command-migrate"),_commandMigrate2=_interopRequireDefault(_commandMigrate)},{"../../command/command-migrate":12}],102:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function calcPPI(w,h,d,opt){w>0||(w=1),h>0||(h=1),opt||(opt="d");var dpi=("d"==opt?Math.sqrt(w*w+h*h):"w"==opt?w:h)/d;return dpi>0?Math.round(dpi):0}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_core=require("../core"),core=_interopRequireWildcard(_core),_commandManager=require("../command/command-manager"),_commandManager2=_interopRequireDefault(_commandManager),_config=require("./config"),_config2=_interopRequireDefault(_config),_const=require("../const"),Const=_interopRequireWildcard(_const),ApplicationContext=function(){function ApplicationContext(){_classCallCheck(this,ApplicationContext),this._commander=new _commandManager2["default"],this.screen=_config2["default"].screen(),this.DPPX=_config2["default"].dppx(),this._mode=Const.MODE_VIEW}return _createClass(ApplicationContext,[{key:"dispose",value:function(){this.commander.dispose()}},{key:"calcScreen",value:function(){var physical_resolution={width:screen.width*this.DPPX,height:screen.height*this.DPPX};this._PPI=calcPPI(physical_resolution.width,physical_resolution.height,this.screen),this._PPM=this._PPI/25.4}},{key:"commander",get:function(){return this._commander}},{key:"screen",get:function(){return this._screen},set:function(screen){this._screen=screen,this.calcScreen()}},{key:"DPPX",get:function(){return this._dppx},set:function(dppx){this._dppx=dppx,this.calcScreen()}},{key:"PPI",get:function(){return this._PPI}},{key:"PPM",get:function(){return this._PPM}},{key:"mode",get:function(){return this._mode},set:function(mode){var before=this._mode;before!==mode&&(this._mode=mode,this.trigger("mode",mode,before))}}]),ApplicationContext}();exports["default"]=ApplicationContext,core.mixin(ApplicationContext.prototype,core.event.withEvent)},{"../command/command-manager":11,"../const":43,"../core":46,"./config":104}],103:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}Object.defineProperty(exports,"__esModule",{value:!0});var _core=require("../core"),core=_interopRequireWildcard(_core),_utils=require("../core/utils"),clipboard=null,trigger={};core.mixin(trigger,core.event.withEvent),exports["default"]={put:function(models){models instanceof Array?clipboard=models.map(function(model){var clone=_utils.deepClone(model);return delete clone.id,clone}):(clipboard=_utils.deepClone(models),delete clipboard.id),trigger.trigger("clipboard-put",clipboard)},get:function(){return clipboard instanceof Array?clipboard.map(function(model){return _utils.deepClone(model)}):_utils.deepClone(clipboard)},reset:function(){clipboard=null,trigger.trigger("clipboard-reset")}}},{"../core":46,"../core/utils":52}],104:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _screen=13.3;if("undefined"!=typeof window)var _dppx=window.devicePixelRatio||(window.matchMedia&&window.matchMedia("(min-resolution: 2dppx), (-webkit-min-device-pixel-ratio: 1.5),(-moz-min-device-pixel-ratio: 1.5),(min-device-pixel-ratio: 1.5)").matches?2:1)||1;else var _dppx=1;exports["default"]={screen:function(size){return"undefined"!=typeof size&&(_screen=size),_screen},dppx:function(_dppx2){return"undefined"!=typeof _dppx2&&(_dppx=_dppx2),_dppx}}},{}],105:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function create(_ref){var target=_ref.target,model=_ref.model,style=_ref.style,_ref$layers=_ref.layers,layers=void 0===_ref$layers?[]:_ref$layers,_ref$handlers=_ref.handlers,handlers=void 0===_ref$handlers?[]:_ref$handlers,target_element=null;if("string"==typeof target){if(target_element=document.getElementById(target),!target_element)throw"target element '"+target+"' is not exist";if(target_element.firstChild)throw"target element '"+target+"' already has children"}else target_element=target;var root=new _rootContainer2["default"]({target_element:target_element,model:model,style:style,layers:layers,handlers:handlers},new _applicationContext2["default"]);return new _scene2["default"](root)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=create;var _rootContainer=require("../components/root-container"),_rootContainer2=_interopRequireDefault(_rootContainer),_applicationContext=require("./application-context"),_applicationContext2=_interopRequireDefault(_applicationContext),_scene=require("./scene"),_scene2=_interopRequireDefault(_scene)},{"../components/root-container":38,"./application-context":102,"./scene":109}],106:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj
}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventMap=exports.Link=exports.Layer=exports.clipboard=exports.unregister=exports.register=exports.create=exports.config=void 0;var _config=require("./config");Object.defineProperty(exports,"config",{enumerable:!0,get:function(){return _config.config}});var _create=require("./create");Object.defineProperty(exports,"create",{enumerable:!0,get:function(){return _interopRequireDefault(_create)["default"]}});var _register=require("./register");Object.defineProperty(exports,"register",{enumerable:!0,get:function(){return _register.register}}),Object.defineProperty(exports,"unregister",{enumerable:!0,get:function(){return _register.unregister}});var _clipboard=require("./clipboard");Object.defineProperty(exports,"clipboard",{enumerable:!0,get:function(){return _interopRequireDefault(_clipboard)["default"]}});var _layer=require("../layer/layer");Object.defineProperty(exports,"Layer",{enumerable:!0,get:function(){return _interopRequireDefault(_layer)["default"]}});var _link=require("../link/link");Object.defineProperty(exports,"Link",{enumerable:!0,get:function(){return _interopRequireDefault(_link)["default"]}});var _eventMap=require("../event-map/event-map");Object.defineProperty(exports,"EventMap",{enumerable:!0,get:function(){return _interopRequireDefault(_eventMap)["default"]}});var _const=require("../const");Object.keys(_const).forEach(function(key){"default"!==key&&Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _const[key]}})});var _components=require("../components/");Object.keys(_components).forEach(function(key){"default"!==key&&Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _components[key]}})});var _polyfill=require("./polyfill");_interopRequireDefault(_polyfill)},{"../components/":29,"../const":43,"../event-map/event-map":56,"../layer/layer":66,"../link/link":80,"./clipboard":103,"./config":104,"./create":105,"./polyfill":107,"./register":108}],107:[function(require,module,exports){"use strict";"function"!=typeof Object.assign&&!function(){Object.assign=function(target){if(void 0===target||null===target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),index=1;index<arguments.length;index++){var source=arguments[index];if(void 0!==source&&null!==source)for(var nextKey in source)source.hasOwnProperty(nextKey)&&(output[nextKey]=source[nextKey])}return output}}(),void 0==CanvasRenderingContext2D.prototype.ellipse&&(CanvasRenderingContext2D.prototype.ellipse=function(cx,cy,rx,ry,rot,aStart,aEnd){this.save(),this.translate(cx,cy),this.rotate(rot),this.translate(-rx,-ry),this.scale(rx,ry),this.arc(1,1,1,aStart,aEnd,!1),this.restore()})},{}],108:[function(require,module,exports){"use strict";function register(type,module){return{}}function unregister(type){return{}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.register=register,exports.unregister=unregister},{}],109:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_api=require("./api"),API=_interopRequireWildcard(_api),_animate2=require("../animation/animate"),_animate3=_interopRequireDefault(_animate2),_variableManager=require("../variable/variable-manager"),_variableManager2=_interopRequireDefault(_variableManager),_utils=require("../core/utils"),Scene=function(){function Scene(container){_classCallCheck(this,Scene),this._container=container,this._model_layer=container.model_layer,this.app=container.app,this.variable_manager=new _variableManager2["default"](container.content_model.variables,function(target){return container.model_layer.findAll(target)})}return _createClass(Scene,[{key:"add",value:function(){return API.add.apply(this._container,arguments)}},{key:"duplicate",value:function(){return API.duplicate.apply(this._container,arguments)}},{key:"remove",value:function(){return API.remove.apply(this._container,arguments)}},{key:"animate",value:function(){return _animate3["default"].apply(this,arguments)}},{key:"fullscreen",value:function(){return API.fullscreen.apply(this._container,arguments)}},{key:"variable",value:function(name,value){return"undefined"==typeof value?this.variable_manager.get(name):void this.variable_manager.set(name,value)}},{key:"resize",value:function(){this._container.resize()}},{key:"dispose",value:function(){return this._container.dispose()}},{key:"select",value:function(selector){for(var _model_layer,_len=arguments.length,others=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)others[_key-1]=arguments[_key];return this._container.selected=(_model_layer=this._model_layer).findAll.apply(_model_layer,[selector].concat(others)),this.selected}},{key:"undo",value:function(){this.app.commander.undo()}},{key:"redo",value:function(){this.app.commander.redo()}},{key:"cut",value:function(){return API.cut.apply(this._container,arguments)}},{key:"copy",value:function(){return API.copy.apply(this._container,arguments)}},{key:"paste",value:function(){return API.paste.apply(this._container,arguments)}},{key:"undoableChange",value:function(){return API.undoableChange.apply(this._container,arguments)}},{key:"undoableChangeBefore",value:function(){return API.undoableChangeBefore.apply(this._container,arguments)}},{key:"undoableChangeAfter",value:function(){return API.undoableChangeAfter.apply(this._container,arguments)}},{key:"undoableChangeReset",value:function(){return API.undoableChangeReset.apply(this._container,arguments)}},{key:"change",value:function(){return API.change.apply(this._model_layer,arguments)}},{key:"findAll",value:function(){return this._model_layer.findAll.apply(this._model_layer,arguments)}},{key:"findFirst",value:function(){return this._model_layer.findFirst.apply(this._model_layer,arguments)}},{key:"findById",value:function(){return this._model_layer.findById.apply(this._model_layer,arguments)}},{key:"serialize",value:function(){return this._model_layer.serialize.apply(this._model_layer,arguments)}},{key:"align",value:function(){return API.align.apply(this._container,arguments)}},{key:"zorder",value:function(){return API.zorder.apply(this._container,arguments)}},{key:"symmetryX",value:function(){return API.symmetryX.apply(this._container,arguments)}},{key:"symmetryY",value:function(){return API.symmetryY.apply(this._container,arguments)}},{key:"on",value:function(){return API.on.apply(this._container,arguments)}},{key:"once",value:function(){return API.once.apply(this._container,arguments)}},{key:"off",value:function(){return API.off.apply(this._container,arguments)}},{key:"toDataURL",value:function(){return API.toDataURL.apply(this._container,arguments)}},{key:"group",value:function(){return API.group.apply(this._container,arguments)}},{key:"ungroup",value:function(){return API.ungroup.apply(this._container,arguments)}},{key:"scale",get:function(){return this._model_layer.get("scale")},set:function(scale){this._model_layer.set("scale",scale)}},{key:"translate",get:function(){return this._model_layer.get("translate")},set:function(translate){this._model_layer.set("translate",translate)}},{key:"screen",get:function(){return this.app.screen},set:function(size){this.app.screen=size,this._container.resize()}},{key:"dppx",get:function(){return this.app.DPPX},set:function(dppx){app.DPPX=dppx,this._container.resize()}},{key:"selected",get:function(){return this._container.selected.slice()}},{key:"commander",get:function(){return this.app.commander}},{key:"model",get:function(){return _utils.deepClone(this._model_layer.hierarchy)},set:function(model){model&&(this._container.content_model=model)}},{key:"root",get:function(){return this._model_layer}},{key:"mode",get:function(){return this.app.mode},set:function(mode){void 0!==mode&&(this.app.mode=mode)}}]),Scene}();exports["default"]=Scene},{"../animation/animate":2,"../core/utils":52,"../variable/variable-manager":111,"./api":96}],110:[function(require,module,exports){"use strict";function value(value){return value}function map(value){return this.param?(value=String(value),this.param.hasOwnProperty(value)?this.param[value]:this.param["default"]):void 0}function range(value,type){var param=this.param;if(param){for(var _range in param){var _range$split=_range.split("~"),_range$split2=_slicedToArray(_range$split,2),from=_range$split2[0],to=_range$split2[1];if("number"===type&&(from=parseFloat(from),to=parseFloat(to)),value>=from&&to>=value)return param[_range]}return param["default"]}}function radian(value){return value*Math.PI/180}function build(script){var evaluator;return eval("evaluator = function(value, type) {"+script+"}"),evaluator}function buildEvaluator(owner,rule,param){switch(rule){case"value":return value.bind(owner);case"map":return map.bind(owner);case"range":return range.bind(owner);case"radian":return radian.bind(owner);case"eval":return build(param).bind(owner);default:return value.bind(owner)}}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();exports["default"]=buildEvaluator},{}],111:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_variable=require("./variable"),_variable2=_interopRequireDefault(_variable),VariableManager=function(){function VariableManager(model,finder){_classCallCheck(this,VariableManager),this.finder=finder,this.model=model}return _createClass(VariableManager,[{key:"set",value:function(name,value){var variable=this._variables[name];variable&&(variable.value=value)}},{key:"get",value:function(name){var variable=this._variables[name];if(variable)return variable.value}},{key:"finder",set:function(finder){this._finder=finder},get:function(){return this._finder}},{key:"model",set:function(model){if(this._model=model,this._variables={},model instanceof Array)for(var i=0;i<model.length;i++){var variable=model[i];this._variables[variable.key]=new _variable2["default"](variable,this.finder)}else for(var name in model)this._variables[name]=new _variable2["default"](model[name],this.finder)},get:function(){return this._model}}]),VariableManager}();exports["default"]=VariableManager},{"./variable":113}],112:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_evaluator=require("./evaluator"),_evaluator2=_interopRequireDefault(_evaluator),VariableMapping=function(){function VariableMapping(model){_classCallCheck(this,VariableMapping),this.model=model}return _createClass(VariableMapping,[{key:"model",get:function(){return this._model},set:function(model){var rule=(model.target,model.property,model.rule),param=model.param;this._model=model,this.evaluator=_evaluator2["default"](this,rule,param)}},{key:"target",get:function(){return this.model.target}},{key:"property",get:function(){return this.model.property}},{key:"param",get:function(){return this.model.param}}]),VariableMapping}();exports["default"]=VariableMapping},{"./evaluator":110}],113:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_variableMapping=require("./variable-mapping"),_variableMapping2=_interopRequireDefault(_variableMapping),Variable=function(){function Variable(model,finder){_classCallCheck(this,Variable),this._finder=finder,this.model=model}return _createClass(Variable,[{key:"finder",get:function(){return this._finder}},{key:"model",get:function(){return this._model},set:function(model){this._model=model,this._name=model.name,this._type=model.type,this._value=model.value,this._mappings=(model.mappings||[]).map(function(mapping){return new _variableMapping2["default"](mapping)})}},{key:"name",get:function(){return this._name}},{key:"type",get:function(){return this._type}},{key:"mappings",get:function(){return this._mappings}},{key:"value",get:function(){return this._value},set:function(val){var _this=this;this._value=val,this.mappings.forEach(function(mapping){var value=mapping.evaluator(_this.value,_this.type),components=_this.finder(mapping.target);components.forEach(function(component){return component.set(mapping.property,value)})})}}]),Variable}();exports["default"]=Variable},{"./variable-mapping":112}]},{},[1]);